{"meta":{"version":1,"warehouse":"1.0.3"},"models":{"Asset":[{"_id":"themes/apollo/source/scss/apollo.scss","path":"scss/apollo.scss","modified":1},{"_id":"themes/apollo/source/font/sourcesanspro.woff2","path":"font/sourcesanspro.woff2","modified":1},{"_id":"themes/apollo/source/font/sourcesanspro.woff","path":"font/sourcesanspro.woff","modified":1},{"_id":"themes/apollo/source/favicon.png","path":"favicon.png","modified":1},{"_id":"themes/apollo/source/css/apollo.css","path":"css/apollo.css","modified":1},{"_id":"themes/apollo/source/avatar2.jpg","path":"avatar2.jpg","modified":1},{"_id":"themes/apollo/source/avatar1.jpg","path":"avatar1.jpg","modified":1},{"_id":"themes/apollo/source/avatar.jpg","path":"avatar.jpg","modified":1},{"_id":"source/CNAME_","path":"CNAME_","modified":1},{"_id":"source/uploads/avatar.jpg","path":"uploads/avatar.jpg","modified":1},{"_id":"source/images/QQ20180617-174124@2x.png","path":"images/QQ20180617-174124@2x.png","modified":1},{"_id":"source/images/QQ20180617-173851@2x.png","path":"images/QQ20180617-173851@2x.png","modified":1},{"_id":"source/images/QQ20180617-173229@2x.png","path":"images/QQ20180617-173229@2x.png","modified":1},{"_id":"source/images/QQ20180617-165142@2x.png","path":"images/QQ20180617-165142@2x.png","modified":1},{"_id":"source/images/QQ20180617-165008@2x.png","path":"images/QQ20180617-165008@2x.png","modified":1},{"_id":"source/images/QQ20180617-164649@2x.png","path":"images/QQ20180617-164649@2x.png","modified":1},{"_id":"source/images/Building Faster in Xcode_.png","path":"images/Building Faster in Xcode_.png","modified":1},{"_id":"source/images/Building Faster in Xcode.png","path":"images/Building Faster in Xcode.png","modified":1},{"_id":"source/images/15292356504822.jpg","path":"images/15292356504822.jpg","modified":1},{"_id":"source/images/15292355397528.jpg","path":"images/15292355397528.jpg","modified":1},{"_id":"source/images/15292355026463.jpg","path":"images/15292355026463.jpg","modified":1},{"_id":"source/images/15292354967107.jpg","path":"images/15292354967107.jpg","modified":1},{"_id":"source/images/15292354795777.jpg","path":"images/15292354795777.jpg","modified":1},{"_id":"source/images/15292352697835.jpg","path":"images/15292352697835.jpg","modified":1},{"_id":"source/images/15292351447821.jpg","path":"images/15292351447821.jpg","modified":1},{"_id":"source/images/15292346898606.jpg","path":"images/15292346898606.jpg","modified":1},{"_id":"source/images/15292346436023.jpg","path":"images/15292346436023.jpg","modified":1},{"_id":"source/images/15292313838157.jpg","path":"images/15292313838157.jpg","modified":1},{"_id":"source/images/15292313035255.jpg","path":"images/15292313035255.jpg","modified":1},{"_id":"source/images/15292312680309.jpg","path":"images/15292312680309.jpg","modified":1},{"_id":"source/images/15292312542417.jpg","path":"images/15292312542417.jpg","modified":1},{"_id":"source/images/15292312274443.jpg","path":"images/15292312274443.jpg","modified":1},{"_id":"source/images/15292308090026.jpg","path":"images/15292308090026.jpg","modified":1},{"_id":"source/images/15292305743843.jpg","path":"images/15292305743843.jpg","modified":1},{"_id":"source/images/15292305166448.jpg","path":"images/15292305166448.jpg","modified":1},{"_id":"source/images/15292304507458.jpg","path":"images/15292304507458.jpg","modified":1},{"_id":"source/images/15292304002286.jpg","path":"images/15292304002286.jpg","modified":1},{"_id":"source/images/15292302723971.jpg","path":"images/15292302723971.jpg","modified":1},{"_id":"source/images/15292300070030.jpg","path":"images/15292300070030.jpg","modified":1},{"_id":"source/images/15292297716350.jpg","path":"images/15292297716350.jpg","modified":1},{"_id":"source/images/15292296942668.jpg","path":"images/15292296942668.jpg","modified":1},{"_id":"source/images/15292295109399.jpg","path":"images/15292295109399.jpg","modified":1},{"_id":"source/images/15292294983715.jpg","path":"images/15292294983715.jpg","modified":1},{"_id":"source/images/15292294774311.jpg","path":"images/15292294774311.jpg","modified":1},{"_id":"source/images/15292294609151.jpg","path":"images/15292294609151.jpg","modified":1},{"_id":"source/images/15292293472562.jpg","path":"images/15292293472562.jpg","modified":1}],"Cache":[{"_id":"source/_posts/408-building-faster-in-xcode.md","shasum":"6bdfa5f94d2ff7bb9ec9a7ffb86a9f4bd97c133d","modified":1529238689059},{"_id":"source/CNAME_","shasum":"cf3446bacd3f04cf9f93fc86cd2af1c9edfbfeba","modified":1483417736000},{"_id":"source/_posts/Runtime-tabBarItem.md","shasum":"28a23b2719daf90bbf83e081322e4bc4c2dd2102","modified":1483417736000},{"_id":"source/_posts/RSA-SHA.md","shasum":"421b13651b5adb305a43bd2f200397a05c7d212b","modified":1483417736000},{"_id":"source/_posts/Socket.md","shasum":"c765fb52da056befb6ba062fae3a9d3d9db119d4","modified":1483417736000},{"_id":"source/_posts/YYKit-pthread.md","shasum":"411fad792112b8b25ed9d6eaf3e21c027f24d3f2","modified":1483417736000},{"_id":"source/_posts/YYCache-analyzing.md","shasum":"791644c72e2bb437ca279b1598510374dbb2c1dc","modified":1483417736000},{"_id":"source/_posts/alfred-use.md","shasum":"efa00c4d42bd82f0eac0130105cf761f4e08d650","modified":1483440615000},{"_id":"source/_posts/git-commands.md","shasum":"19235aaff01a31b9f7824c13a55bce2b663bcad5","modified":1488982359000},{"_id":"source/_posts/sketch-makeicons.md","shasum":"5ada769f420a87c13c1afe220922676e09ff6c0c","modified":1483417736000},{"_id":"source/_posts/xctool-package.md","shasum":"add599511f6d00f3d8031a2f3f75684ec1093a6a","modified":1483417736000},{"_id":"source/about/index.md","shasum":"f659e89ebbd7d656208371abfca5401de89e1e09","modified":1452924437000},{"_id":"source/categories/index.md","shasum":"283a947e797500aa6f9398ecfdcce410670b9a2d","modified":1452924164000},{"_id":"source/_posts/æ‰§ç€.md","shasum":"7daa87a86c5d59312293588c3f9a49d2e12a2c57","modified":1483417736000},{"_id":"source/images/15292304002286.jpg","shasum":"96d880ec6a1b33e702cd108322eef8769cf2fa3b","modified":1529230400245},{"_id":"source/instagram/index.md","shasum":"ce39a108289ee00c6c55d4c50e628f99bc26de18","modified":1452920289000},{"_id":"source/tags/index.md","shasum":"b5a8983835c5e8b3f6b50413ef22f325c4e75f35","modified":1452924126000},{"_id":"source/uploads/avatar.jpg","shasum":"cd576a77b0e3fc0cd4bda8f35afc9a23755a890d","modified":1452919442000},{"_id":"source/images/15292300070030.jpg","shasum":"09a161f4db7202243203b098381fb436ef9f19c9","modified":1529230007028},{"_id":"source/images/15292297716350.jpg","shasum":"0e14e584d22cf1fc1616d480b958a8ec7d2eac75","modified":1529229771665},{"_id":"source/images/15292302723971.jpg","shasum":"873fdecbc750f19d62e9f10afe7188c540f9e82f","modified":1529230272429},{"_id":"source/images/15292304507458.jpg","shasum":"0ae73db16f7c42494003e9556c70193deffbe10b","modified":1529230450769},{"_id":"source/images/15292305166448.jpg","shasum":"7cafbb0c917255df3b9e0add77b41fc0311436bc","modified":1529230516676},{"_id":"source/images/15292352697835.jpg","shasum":"ddb983842e858dd7a4159d9938455d2980174f20","modified":1529235269810},{"_id":"source/images/15292354795777.jpg","shasum":"d6a61cb4b99c40d3deb82da3200816cc02e1348e","modified":1529235479591},{"_id":"source/images/15292355026463.jpg","shasum":"d6a61cb4b99c40d3deb82da3200816cc02e1348e","modified":1529235502660},{"_id":"source/images/15292355397528.jpg","shasum":"27d0b007e24920ef2f4edaddc31c6ce4a0802f67","modified":1529235539774},{"_id":"source/images/15292354967107.jpg","shasum":"d6a61cb4b99c40d3deb82da3200816cc02e1348e","modified":1529235496725},{"_id":"source/images/QQ20180617-164649@2x.png","shasum":"e95741841ccda49acb917ed6e0d74e89bbf1130e","modified":1529225212973},{"_id":"source/images/QQ20180617-165142@2x.png","shasum":"c40b1c948fe84ebd067c20741ea3858afc44d72d","modified":1529225505186},{"_id":"source/images/Building Faster in Xcode_.png","shasum":"34a762a7f7bc95b625191003d9f84a6d7c5c85c0","modified":1529236413420},{"_id":"source/images/QQ20180617-173229@2x.png","shasum":"681c018a5d44326088e0cc7c3623beb88238c422","modified":1529227951715},{"_id":"source/images/15292305743843.jpg","shasum":"e38eebecccd6e15e9b0617caa71757b5c37b309d","modified":1529230574439},{"_id":"source/images/15292308090026.jpg","shasum":"719de20193c265e8ccbce9dd7a94b80a422c509b","modified":1529230809034},{"_id":"source/images/15292312274443.jpg","shasum":"860430047f83b249a036877b25874489e922ef2c","modified":1529231227497},{"_id":"source/images/15292313035255.jpg","shasum":"d185e2fae935fc8dc966b7a0969d441e4578a701","modified":1529231303569},{"_id":"source/images/15292312680309.jpg","shasum":"a5a3b666064dbcb791ce9224b67984dc61aaa844","modified":1529231268076},{"_id":"source/images/15292313838157.jpg","shasum":"6bd466fa053510b6757f503c36530da9ac87c2f1","modified":1529231383863},{"_id":"source/images/Building Faster in Xcode.png","shasum":"19d960b50ead78bb203de75775158384dc8b561b","modified":1529236325415},{"_id":"source/images/QQ20180617-165008@2x.png","shasum":"7f4d0a04e60de6f34bc5bd589da1d946ffb02af0","modified":1529225424242},{"_id":"source/images/15292346436023.jpg","shasum":"cde509a8dd7dcf11fba9f084dafed6787e7b2187","modified":1529234643657},{"_id":"source/images/15292346898606.jpg","shasum":"1fa3444ff8537a759caf374e941c6af1760ba7d3","modified":1529234689926},{"_id":"source/images/15292295109399.jpg","shasum":"7ecb63bbd02ac478a1911afe6d4da12d44ad74c0","modified":1529229511008},{"_id":"source/images/QQ20180617-173851@2x.png","shasum":"51ff09c50d0b4ba9c7b99cb02e9e7c2989ae7303","modified":1529228332726},{"_id":"themes/apollo/README.md","shasum":"fb6fbe42172a35cbdaa540a777cc4bc02add2278","modified":1472093882000},{"_id":"themes/apollo/LICENSE","shasum":"6e31ac9076bfc8f09ae47977419eee4edfb63e5b","modified":1460861213000},{"_id":"themes/apollo/_config.yml","shasum":"f1d158863424415031900df2d3c6a72f1af8b096","modified":1472109690000},{"_id":"themes/apollo/doc/doc-en.md","shasum":"d6d9756b2085cdd8ee51eb5594427e2abf170e94","modified":1460861213000},{"_id":"themes/apollo/gulpfile.js","shasum":"857a026b6643a2cd52c65d4ae0dc7fe9618206ee","modified":1460861213000},{"_id":"themes/apollo/doc/doc-zh.md","shasum":"d43c1f6bff66426744a2c6f031d19ff09cdeb2d1","modified":1460861213000},{"_id":"themes/apollo/languages/en.yml","shasum":"40292f2a48e4e6361132033a47c516cb33127b6c","modified":1460861213000},{"_id":"themes/apollo/languages/zh-cn.yml","shasum":"9e4b03e14c094000257ea254fd660dde4c7af63c","modified":1460861213000},{"_id":"themes/apollo/layout/archive.jade","shasum":"62797414355bf4474092bc3a32726c8340820ffb","modified":1460861213000},{"_id":"themes/apollo/layout/index.jade","shasum":"55f2f1b4b5364a0e09cb18e1112664c6415fb881","modified":1460861213000},{"_id":"themes/apollo/layout/mixins/paginator.jade","shasum":"f4ee2fb61a32e199b48cf93771749edc8a007391","modified":1460861213000},{"_id":"themes/apollo/layout/partial/comment.jade","shasum":"ff0a2c269c2434da2ac5529872f1d6184a71f96d","modified":1460861213000},{"_id":"themes/apollo/layout/mixins/post.jade","shasum":"cd9447e9b0ad22213e6a17d9a9b948f9f998f921","modified":1462975735000},{"_id":"themes/apollo/layout/partial/copyright.jade","shasum":"217f8b17054e5079f2d30bb7e2e4e36c0f2161b7","modified":1472093882000},{"_id":"themes/apollo/layout/partial/head.jade","shasum":"d062dafabfe65198e5cf2ddb0e47d909885aa950","modified":1472093882000},{"_id":"themes/apollo/layout/partial/nav.jade","shasum":"c35d3061da4b053b73150d9741c542d660798270","modified":1460861213000},{"_id":"themes/apollo/layout/partial/layout.jade","shasum":"eb15573ff66bdbb110ac77cf360b740170cee738","modified":1462975735000},{"_id":"themes/apollo/layout/partial/scripts.jade","shasum":"cf3339de8979b5f75a3011f0f6b5451091b77dc8","modified":1472093882000},{"_id":"themes/apollo/package.json","shasum":"4d13f5f859db7d008f49251543a8f610b2ecabd5","modified":1472093882000},{"_id":"themes/apollo/layout/post.jade","shasum":"245c26244c075c3632d1545c3b228ee9d112f15d","modified":1462975735000},{"_id":"themes/apollo/source/_avatar.jpg","shasum":"cd576a77b0e3fc0cd4bda8f35afc9a23755a890d","modified":1472093983000},{"_id":"themes/apollo/source/avatar1.jpg","shasum":"a9cdcb22d1e74d5480323e19d1983de5a6873b8c","modified":1472093983000},{"_id":"themes/apollo/source/css/apollo.css","shasum":"2cfd049bcbad8a9a68c13299a92e993d5c92d029","modified":1472093882000},{"_id":"themes/apollo/source/favicon.png","shasum":"bd1854baae82d46b0d96212c1bedca1313056383","modified":1472100967000},{"_id":"themes/apollo/source/avatar.jpg","shasum":"b22e7fed252896bf3f7d3fa0e63b889b8fbf5311","modified":1472133412000},{"_id":"themes/apollo/source/scss/_partial/base.scss","shasum":"fe20c16c18ab76b843d0aab2e1a5cc4f5d6d64c7","modified":1472093882000},{"_id":"themes/apollo/source/font/sourcesanspro.woff2","shasum":"da65f527a8da65d5eb6721626d28cfdb46ab104a","modified":1472093882000},{"_id":"themes/apollo/source/scss/_partial/archive-post-list.scss","shasum":"d2f740a7d48349b7536777c795f82ab740836d0f","modified":1462975735000},{"_id":"themes/apollo/source/font/sourcesanspro.woff","shasum":"a6722c9b6439b7a020a9be3d3178970757a9265c","modified":1472093882000},{"_id":"themes/apollo/source/scss/_partial/copyright.scss","shasum":"1309667e3000037170cfbb5b8c9c65f4ffcf6814","modified":1462975735000},{"_id":"themes/apollo/source/scss/_partial/footer.scss","shasum":"094aca6e52f11b139ac7980ca03fa7b9d8fc7b2f","modified":1460861213000},{"_id":"themes/apollo/source/scss/_partial/header.scss","shasum":"153bde88bf8ffeae4ffd813d8cc694dd83d33d94","modified":1460861213000},{"_id":"themes/apollo/source/scss/_partial/home-post-list.scss","shasum":"6b5c59f3d2295944f934aee2c1156012a3306d5d","modified":1462975735000},{"_id":"themes/apollo/source/scss/_partial/mq.scss","shasum":"b5eb0fb35fb275cbb6452b5d98702d461af3e6d5","modified":1460861213000},{"_id":"themes/apollo/source/scss/_partial/normalize.scss","shasum":"fd0b27bed6f103ea95b08f698ea663ff576dbcf1","modified":1460861213000},{"_id":"themes/apollo/source/scss/_partial/post.scss","shasum":"ae780828148f79e5069b480e3576f1fea1246866","modified":1472093882000},{"_id":"themes/apollo/source/scss/apollo.scss","shasum":"153bbf882c1f6f65bb4510999b51812e20016ca7","modified":1472093882000},{"_id":"source/images/QQ20180617-174124@2x.png","shasum":"2d3ac4f46e1cab4aac468a934ae2b3256830d4d6","modified":1529228523424},{"_id":"source/images/15292351447821.jpg","shasum":"3e201bbb577f91fded02350db317392af149fc0b","modified":1529235148880},{"_id":"source/images/15292294774311.jpg","shasum":"58ec71c0110c6f7e985df4eec63540575c44ed15","modified":1529229477530},{"_id":"source/images/15292294983715.jpg","shasum":"58ec71c0110c6f7e985df4eec63540575c44ed15","modified":1529229498499},{"_id":"source/images/15292293472562.jpg","shasum":"58ec71c0110c6f7e985df4eec63540575c44ed15","modified":1529229347357},{"_id":"source/images/15292294609151.jpg","shasum":"58ec71c0110c6f7e985df4eec63540575c44ed15","modified":1529229461007},{"_id":"source/images/15292312542417.jpg","shasum":"488d273ef04998c64533247eecb18541daa2f934","modified":1529231256041},{"_id":"themes/apollo/source/avatar2.jpg","shasum":"0555d723637c4da77dbe6722d26f262802d1dcd0","modified":1472093983000},{"_id":"source/images/15292356504822.jpg","shasum":"bc18c6d66b26c7daa94456f20e3f419d4fb78906","modified":1529235652372},{"_id":"source/images/15292296942668.jpg","shasum":"5455f1fe6a3a3d22f8480b2f71f1a0ac7b6d1ce4","modified":1529229696072},{"_id":"public/scss/apollo.scss","modified":1529239320170,"shasum":"153bbf882c1f6f65bb4510999b51812e20016ca7"},{"_id":"public/font/sourcesanspro.woff2","modified":1529239320177,"shasum":"da65f527a8da65d5eb6721626d28cfdb46ab104a"},{"_id":"public/font/sourcesanspro.woff","modified":1529239320180,"shasum":"a6722c9b6439b7a020a9be3d3178970757a9265c"},{"_id":"public/favicon.png","modified":1529239320184,"shasum":"bd1854baae82d46b0d96212c1bedca1313056383"},{"_id":"public/css/apollo.css","modified":1529239320187,"shasum":"2cfd049bcbad8a9a68c13299a92e993d5c92d029"},{"_id":"public/avatar2.jpg","modified":1529239320190,"shasum":"0555d723637c4da77dbe6722d26f262802d1dcd0"},{"_id":"public/avatar1.jpg","modified":1529239320193,"shasum":"a9cdcb22d1e74d5480323e19d1983de5a6873b8c"},{"_id":"public/avatar.jpg","modified":1529239320196,"shasum":"b22e7fed252896bf3f7d3fa0e63b889b8fbf5311"},{"_id":"public/CNAME_","modified":1529239320198,"shasum":"cf3446bacd3f04cf9f93fc86cd2af1c9edfbfeba"},{"_id":"public/uploads/avatar.jpg","modified":1529239320201,"shasum":"cd576a77b0e3fc0cd4bda8f35afc9a23755a890d"},{"_id":"public/images/QQ20180617-174124@2x.png","modified":1529239320206,"shasum":"2d3ac4f46e1cab4aac468a934ae2b3256830d4d6"},{"_id":"public/images/QQ20180617-173851@2x.png","modified":1529239320213,"shasum":"51ff09c50d0b4ba9c7b99cb02e9e7c2989ae7303"},{"_id":"public/images/QQ20180617-173229@2x.png","modified":1529239320221,"shasum":"681c018a5d44326088e0cc7c3623beb88238c422"},{"_id":"public/images/QQ20180617-165142@2x.png","modified":1529239320223,"shasum":"c40b1c948fe84ebd067c20741ea3858afc44d72d"},{"_id":"public/images/QQ20180617-165008@2x.png","modified":1529239320231,"shasum":"7f4d0a04e60de6f34bc5bd589da1d946ffb02af0"},{"_id":"public/images/QQ20180617-164649@2x.png","modified":1529239320234,"shasum":"e95741841ccda49acb917ed6e0d74e89bbf1130e"},{"_id":"public/images/Building Faster in Xcode_.png","modified":1529239320238,"shasum":"34a762a7f7bc95b625191003d9f84a6d7c5c85c0"},{"_id":"public/images/Building Faster in Xcode.png","modified":1529239320243,"shasum":"19d960b50ead78bb203de75775158384dc8b561b"},{"_id":"public/images/15292356504822.jpg","modified":1529239320250,"shasum":"bc18c6d66b26c7daa94456f20e3f419d4fb78906"},{"_id":"public/images/15292355397528.jpg","modified":1529239320254,"shasum":"27d0b007e24920ef2f4edaddc31c6ce4a0802f67"},{"_id":"public/images/15292355026463.jpg","modified":1529239320258,"shasum":"d6a61cb4b99c40d3deb82da3200816cc02e1348e"},{"_id":"public/images/15292354967107.jpg","modified":1529239320262,"shasum":"d6a61cb4b99c40d3deb82da3200816cc02e1348e"},{"_id":"public/images/15292354795777.jpg","modified":1529239320265,"shasum":"d6a61cb4b99c40d3deb82da3200816cc02e1348e"},{"_id":"public/images/15292352697835.jpg","modified":1529239320271,"shasum":"ddb983842e858dd7a4159d9938455d2980174f20"},{"_id":"public/images/15292351447821.jpg","modified":1529239320276,"shasum":"3e201bbb577f91fded02350db317392af149fc0b"},{"_id":"public/images/15292346898606.jpg","modified":1529239320281,"shasum":"1fa3444ff8537a759caf374e941c6af1760ba7d3"},{"_id":"public/images/15292346436023.jpg","modified":1529239320292,"shasum":"cde509a8dd7dcf11fba9f084dafed6787e7b2187"},{"_id":"public/images/15292313838157.jpg","modified":1529239320296,"shasum":"6bd466fa053510b6757f503c36530da9ac87c2f1"},{"_id":"public/images/15292313035255.jpg","modified":1529239320302,"shasum":"d185e2fae935fc8dc966b7a0969d441e4578a701"},{"_id":"public/images/15292312680309.jpg","modified":1529239320304,"shasum":"a5a3b666064dbcb791ce9224b67984dc61aaa844"},{"_id":"public/images/15292312542417.jpg","modified":1529239320309,"shasum":"488d273ef04998c64533247eecb18541daa2f934"},{"_id":"public/images/15292312274443.jpg","modified":1529239320313,"shasum":"860430047f83b249a036877b25874489e922ef2c"},{"_id":"public/images/15292308090026.jpg","modified":1529239320316,"shasum":"719de20193c265e8ccbce9dd7a94b80a422c509b"},{"_id":"public/images/15292305743843.jpg","modified":1529239320319,"shasum":"e38eebecccd6e15e9b0617caa71757b5c37b309d"},{"_id":"public/images/15292305166448.jpg","modified":1529239320323,"shasum":"7cafbb0c917255df3b9e0add77b41fc0311436bc"},{"_id":"public/images/15292304507458.jpg","modified":1529239320325,"shasum":"0ae73db16f7c42494003e9556c70193deffbe10b"},{"_id":"public/images/15292304002286.jpg","modified":1529239320327,"shasum":"96d880ec6a1b33e702cd108322eef8769cf2fa3b"},{"_id":"public/images/15292302723971.jpg","modified":1529239320329,"shasum":"873fdecbc750f19d62e9f10afe7188c540f9e82f"},{"_id":"public/images/15292300070030.jpg","modified":1529239320332,"shasum":"09a161f4db7202243203b098381fb436ef9f19c9"},{"_id":"public/images/15292297716350.jpg","modified":1529239320335,"shasum":"0e14e584d22cf1fc1616d480b958a8ec7d2eac75"},{"_id":"public/images/15292296942668.jpg","modified":1529239320340,"shasum":"5455f1fe6a3a3d22f8480b2f71f1a0ac7b6d1ce4"},{"_id":"public/images/15292295109399.jpg","modified":1529239320345,"shasum":"7ecb63bbd02ac478a1911afe6d4da12d44ad74c0"},{"_id":"public/images/15292294983715.jpg","modified":1529239320349,"shasum":"58ec71c0110c6f7e985df4eec63540575c44ed15"},{"_id":"public/images/15292294774311.jpg","modified":1529239320353,"shasum":"58ec71c0110c6f7e985df4eec63540575c44ed15"},{"_id":"public/images/15292294609151.jpg","modified":1529239320358,"shasum":"58ec71c0110c6f7e985df4eec63540575c44ed15"},{"_id":"public/images/15292293472562.jpg","modified":1529239320365,"shasum":"58ec71c0110c6f7e985df4eec63540575c44ed15"},{"_id":"public/tags/index.html","modified":1529239320662,"shasum":"1c4d826af807172c35b354c70504abe05e52ab57"},{"_id":"public/instagram/index.html","modified":1529239320854,"shasum":"044669f9f757d88dff2b1ada5a267830a372e09d"},{"_id":"public/categories/index.html","modified":1529239321050,"shasum":"d05f534f171d5b185cafff1f57174595de80badf"},{"_id":"public/about/index.html","modified":1529239321211,"shasum":"1c5d7b03a12db6247fdd91acc516787ed32227bd"},{"_id":"public/2018/06/17/408-building-faster-in-xcode/index.html","modified":1529239321356,"shasum":"e02801a25f7c1d169068a9b7b4dc642faf73f213"},{"_id":"public/2017/02/25/git-commands/index.html","modified":1529239321450,"shasum":"d55f53bba364339110660a1960b0b7d56d7ea5f8"},{"_id":"public/2017/01/03/alfred-use/index.html","modified":1529239321516,"shasum":"8a47214fad4cda0657eaef89a77907c92fc1af4f"},{"_id":"public/2016/09/26/sketch-makeicons/index.html","modified":1529239321577,"shasum":"7dbd32cb504f1dd2564cb7358194c5bf138ca60d"},{"_id":"public/2016/08/25/æ‰§ç€/index.html","modified":1529239321637,"shasum":"54f5913359a3d4c94b9e9eebb32475f52131deb9"},{"_id":"public/2016/07/18/YYCache-analyzing/index.html","modified":1529239321699,"shasum":"74ff42ae4d350501d3594ef7f8d81a2bdfdbb849"},{"_id":"public/2016/06/21/YYKit-pthread/index.html","modified":1529239321788,"shasum":"100f46e61e808a0205dcef2b36b1d98b57e39aa7"},{"_id":"public/2016/05/11/Runtime-tabBarItem/index.html","modified":1529239321871,"shasum":"165fdba5f5ea8ada0485511db0568ba6eddcd174"},{"_id":"public/2016/02/13/xctool-package/index.html","modified":1529239321953,"shasum":"eeeeb202316e22afea24258079510575ad8e4ce0"},{"_id":"public/2016/01/16/Socket/index.html","modified":1529239322045,"shasum":"de8deb9af9f921d21fba50036e829f4368117bbc"},{"_id":"public/2016/01/12/RSA-SHA/index.html","modified":1529239322129,"shasum":"5a6435dbf3b02fdd1c9235ef81cfb5e294bbd2ea"},{"_id":"public/archives/index.html","modified":1529239322214,"shasum":"b97a171c4b64b9ab0c284e0d2de91a058fb1308b"},{"_id":"public/archives/2016/index.html","modified":1529239322301,"shasum":"ffa88abb8ae4399f94b61f5405342f5ef0a44964"},{"_id":"public/archives/2016/01/index.html","modified":1529239322363,"shasum":"8259b69cee8a7cfe9644f536cddc338547df1f38"},{"_id":"public/archives/2016/02/index.html","modified":1529239322426,"shasum":"8fef0729db5c20f96783162cf6fd293847fa5229"},{"_id":"public/archives/2016/05/index.html","modified":1529239322489,"shasum":"cd2a94370165333ff9af9af856fc0734c2cd2a39"},{"_id":"public/archives/2016/06/index.html","modified":1529239322553,"shasum":"85505857008d6b9fe7ee91583bfdea2acde64792"},{"_id":"public/archives/2016/07/index.html","modified":1529239322606,"shasum":"a6e1476a9e9e4b719d46c4619ac37d7cf9c632e8"},{"_id":"public/archives/2016/08/index.html","modified":1529239322667,"shasum":"c6cd042794a2bff4b5ff8e66f463e905582ae015"},{"_id":"public/archives/2016/09/index.html","modified":1529239322729,"shasum":"2ab261fa7407ac90a22cc4eec38ceaebe74d9744"},{"_id":"public/archives/2017/index.html","modified":1529239322793,"shasum":"84eb7775a229775111f1b463a7a71000f5a1f5b2"},{"_id":"public/archives/2017/01/index.html","modified":1529239322847,"shasum":"26bd316277965541be0bf2e92a63802f4c0812f2"},{"_id":"public/archives/2017/02/index.html","modified":1529239322909,"shasum":"89692089a7969b0a5a7b0316aac0ed2b5770a37d"},{"_id":"public/archives/2018/index.html","modified":1529239322968,"shasum":"8a513736ef092c7e8c0476fc3b7796b88aa5ab79"},{"_id":"public/archives/2018/06/index.html","modified":1529239323028,"shasum":"8a513736ef092c7e8c0476fc3b7796b88aa5ab79"},{"_id":"public/categories/iOS/index.html","modified":1529239323085,"shasum":"02b2ac62c62d6c6921b30c1cbbf372caa3d0d001"},{"_id":"public/atom.xml","modified":1529239323088,"shasum":"0e20cd57046cff7fc4f44d487311cc46b0d21192"},{"_id":"public/index.html","modified":1529239323154,"shasum":"da9231e972289decbef1047c774bc4f9b1051ef9"},{"_id":"public/page/2/index.html","modified":1529239323214,"shasum":"a5cc13dc90ecc44ed02a472b1aaee81162ad7f42"},{"_id":"public/sitemap.xml","modified":1529239323216,"shasum":"8ff3fefda4956e39ca058d170c9e79824ed1a62c"},{"_id":"public/tags/XCTOOL/index.html","modified":1529239323278,"shasum":"8fef0729db5c20f96783162cf6fd293847fa5229"},{"_id":"public/tags/SHELL/index.html","modified":1529239323339,"shasum":"8fef0729db5c20f96783162cf6fd293847fa5229"},{"_id":"public/tags/LINUXå‘½ä»¤/index.html","modified":1529239323396,"shasum":"8fef0729db5c20f96783162cf6fd293847fa5229"},{"_id":"public/tags/GIT/index.html","modified":1529239323457,"shasum":"89692089a7969b0a5a7b0316aac0ed2b5770a37d"},{"_id":"public/tags/Tool/index.html","modified":1529239323528,"shasum":"26bd316277965541be0bf2e92a63802f4c0812f2"},{"_id":"public/tags/YYKit/index.html","modified":1529239323609,"shasum":"1ef2891e3007646263e7a8e5606700e22c32098b"},{"_id":"public/tags/pthread/index.html","modified":1529239323681,"shasum":"85505857008d6b9fe7ee91583bfdea2acde64792"},{"_id":"public/tags/YYCache/index.html","modified":1529239323756,"shasum":"a6e1476a9e9e4b719d46c4619ac37d7cf9c632e8"},{"_id":"public/tags/SOCKET/index.html","modified":1529239323810,"shasum":"94b7690c02c39dcb7114d900f72a28dc3637b122"},{"_id":"public/tags/HTTP/index.html","modified":1529239323868,"shasum":"94b7690c02c39dcb7114d900f72a28dc3637b122"},{"_id":"public/tags/TCP/index.html","modified":1529239323927,"shasum":"94b7690c02c39dcb7114d900f72a28dc3637b122"},{"_id":"public/tags/UDP/index.html","modified":1529239323981,"shasum":"94b7690c02c39dcb7114d900f72a28dc3637b122"},{"_id":"public/tags/RSAåŠ å¯†/index.html","modified":1529239324042,"shasum":"4bfc8f19a032cd193ac91d80c1bd84220dfc0097"},{"_id":"public/tags/SHAç­¾å/index.html","modified":1529239324099,"shasum":"4bfc8f19a032cd193ac91d80c1bd84220dfc0097"},{"_id":"public/tags/WWDC/index.html","modified":1529239324159,"shasum":"8a513736ef092c7e8c0476fc3b7796b88aa5ab79"}],"Category":[{"name":"iOS","_id":"cjiitluek000655cg4rjufc52"}],"Data":[],"Page":[{"title":"tags","date":"2016-01-16T06:00:56.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2016-01-16 14:00:56\ntype: \"tags\"\n---\n","updated":"2016-01-16T06:02:06.000Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cjiitludt000055cgmo5jh4kx"},{"layout":"post","slug":"instagram","title":"ç›¸å†Œ","noDate":"true","_content":"\n<div class=\"instagram\" data-client-id=\"119e030b1722460e96852704153c0d16\" data-user-id=\"1260660358\">\n    <a href=\"http://instagram.com/panxianyue\" target=\"_blank\" class=\"open-ins\">å›¾ç‰‡æ¥è‡ªinstagramï¼Œæ­£åœ¨åŠ è½½ä¸­â€¦</a>\n</div>\n<script src=\"/js/jquery.lazyload.js\"></script>\n<script src=\"/js/instagram.js\"></script>","source":"instagram/index.md","raw":"---\nlayout: post\nslug: \"instagram\"\ntitle: \"ç›¸å†Œ\"\nnoDate: \"true\"\n---\n\n<div class=\"instagram\" data-client-id=\"119e030b1722460e96852704153c0d16\" data-user-id=\"1260660358\">\n    <a href=\"http://instagram.com/panxianyue\" target=\"_blank\" class=\"open-ins\">å›¾ç‰‡æ¥è‡ªinstagramï¼Œæ­£åœ¨åŠ è½½ä¸­â€¦</a>\n</div>\n<script src=\"/js/jquery.lazyload.js\"></script>\n<script src=\"/js/instagram.js\"></script>","date":"2016-04-17T02:43:09.000Z","updated":"2016-01-16T04:58:09.000Z","path":"instagram/index.html","comments":1,"_id":"cjiitludx000155cg0i4l4xpc"},{"title":"categories","date":"2016-01-16T06:02:26.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2016-01-16 14:02:26\ntype: \"categories\"\n---\n","updated":"2016-01-16T06:02:44.000Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cjiitlue8000255cg71xliynj"},{"title":"about","date":"2016-01-16T06:07:17.000Z","_content":"","source":"about/index.md","raw":"---\ntitle: about\ndate: 2016-01-16 14:07:17\n---\n","updated":"2016-01-16T06:07:17.000Z","path":"about/index.html","comments":1,"layout":"page","_id":"cjiitlue9000355cg21z52two"}],"Post":[{"title":"æ‰§ç€","date":"2016-08-25T13:16:00.000Z","_content":"æœ‰äº›ä¸œè¥¿æ˜æ˜ä¸€æ–‡ä¸å€¼ï¼Œå´ä¸èˆå¾—ä¸¢æ‰ï¼Œ<br>\næœ‰æ—¶å€™æ‰¾ä¸ç€è¿˜ä¼šæ€¥å¾—åç«‹ä¸å®‰ã€‚<br>\né—®é¢˜æ˜¯å®ƒä»¬è¶Šæ¥è¶Šæ—§ï¼Œè¶Šæ¥è¶Šè€ï¼Œè€Œæˆ‘å·²ç»æ¸æ¸ä¸æ•¢çœ‹å®ƒä»¬ã€‚<br>\nå®ƒä»¬è£…åœ¨ç›’å­é‡Œï¼Œæ”¾åœ¨è§’è½é‡Œï¼Œåƒä¸€éƒ¨éƒ¨ç”µå½±ï¼Œ<br>\néšæ—¶éƒ½èƒ½è®©æˆ‘é‡æ–°çœ‹åˆ°ä¸€åœºå¤§é›¨ï¼Œ<br>\nä¸€æ¬¡åˆ†ç¦»ï¼Œä¸€æ¯å’–å•¡ï¼Œä¸€ä¸ªæ‹¥æŠ±â€¦â€¦<br>\n\n<!--more-->","source":"_posts/æ‰§ç€.md","raw":"---\ntitle: æ‰§ç€\ndate: 2016-08-25 21:16:00\ntags:\n---\næœ‰äº›ä¸œè¥¿æ˜æ˜ä¸€æ–‡ä¸å€¼ï¼Œå´ä¸èˆå¾—ä¸¢æ‰ï¼Œ<br>\næœ‰æ—¶å€™æ‰¾ä¸ç€è¿˜ä¼šæ€¥å¾—åç«‹ä¸å®‰ã€‚<br>\né—®é¢˜æ˜¯å®ƒä»¬è¶Šæ¥è¶Šæ—§ï¼Œè¶Šæ¥è¶Šè€ï¼Œè€Œæˆ‘å·²ç»æ¸æ¸ä¸æ•¢çœ‹å®ƒä»¬ã€‚<br>\nå®ƒä»¬è£…åœ¨ç›’å­é‡Œï¼Œæ”¾åœ¨è§’è½é‡Œï¼Œåƒä¸€éƒ¨éƒ¨ç”µå½±ï¼Œ<br>\néšæ—¶éƒ½èƒ½è®©æˆ‘é‡æ–°çœ‹åˆ°ä¸€åœºå¤§é›¨ï¼Œ<br>\nä¸€æ¬¡åˆ†ç¦»ï¼Œä¸€æ¯å’–å•¡ï¼Œä¸€ä¸ªæ‹¥æŠ±â€¦â€¦<br>\n\n<!--more-->","slug":"æ‰§ç€","published":1,"updated":"2017-01-03T04:28:56.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjiitluec000455cgos0zoe3r"},{"title":"åˆ©ç”¨XCToolå®ç°è‡ªåŠ¨åŒ–æ‰“åŒ…","date":"2016-02-13T05:17:21.000Z","_content":"\nä¸€ä¸ªä¸ä¼šå·æ‡’çš„ç¨‹åºå‘˜ä¸æ˜¯ä¸€ä¸ªå¥½ç¨‹åºå‘˜ã€‚æ¯æ¬¡ç¼–è¯‘æ‰“åŒ…éƒ½è¦èŠ±å¥½é•¿çš„æ—¶é—´ï¼Œçœ‹äº†æœ¬ç¯‡åšå®¢åï¼Œå°±å¯ä»¥å¸®è¿™äº›æ— èŠçš„äº‹æƒ…äº¤ç»™XCToolæ¥åšï¼Œæˆ‘ä»¬å–å–èŒ¶ï¼Œæ’©æ’©å¦¹å°±è¡Œã€‚\n<!--more-->\n\n\n# XCTool\n\nxctoolæ˜¯Facebookå¼€æºçš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ¥ä»£æ›¿è‹¹æœçš„xcodebuildå·¥å…·ã€‚\n\nåŠŸèƒ½å¦‚ä¸‹ï¼š\n\n* åƒxcodeä¸€æ ·èƒ½å¤Ÿç¼–è¯‘ç¨‹åº\n* ç¼–è¯‘çš„ç»“æœèƒ½å¤Ÿä»¥ç»“æ„åŒ–çš„å½¢å¼è¾“å‡º\n* ç¼–è¯‘å†…å®¹è¾“å‡ºå½©è‰²ä¸”æ–¹ä¾¿é˜…è¯»\n\n\n## å®‰è£…XCTool\n\næœ€ç®€å•çš„åŠæ³•å°±æ˜¯ç”¨homebrewå®‰è£…xctoolï¼Œè¿™è¾¹å°±ä¸ä»‹ç»å¦‚ä½•å®‰è£…homebrewäº†ã€‚\n\n` brew install xctool`\n\næ³¨ï¼šåœ¨ç”¨brewå®‰è£…xctoolçš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°can not install with HEAD errorï¼Œå½“æ—¶å°è¯•å¾ˆå¤šåŠæ³•éƒ½æ²¡æœ‰æå®šï¼Œåƒå¸äº†é‡è£…... ç»ˆæè§£å†³æ–¹æ¡ˆï¼šç›´æ¥åˆ é™¤/usr/localé‡Œé¢é‡Œé¢æ‰€æœ‰çš„æ–‡ä»¶ï¼Œ*è¿™è¾¹ä¼šå¯¼è‡´ä½ ä¹‹å‰å®‰è£…çš„ä¸€äº›æ’ä»¶ä¼šè¢«åˆ é™¤ï¼ŒåƒCocoaPods*ã€‚\n\n## ç¼–è¯‘\n\n`xctool -workspace ${project_path}/${project_name}.xcworkspace -scheme ${project_name} archive -archivePath ${project_path}/build/Debug-iphoneos/${project_name}_Debug.xcarchive -configuration ${build_Mode} || exit\n`\n \n# XcodeBuild\n\nshellé‡Œé¢ä¼šåˆ©ç”¨xcodebuildè¿›è¡Œæ‰“åŒ…ã€æ¸…ç†å·¥ç¨‹\n\n## æ‰“åŒ…\n`xcodebuild -exportArchive -archivePath ${project_path}/build/Debug-iphoneos/${project_name}_Debug.xcarchive -exportPath ${buildExportPath}/debug.ipa -exportFormat ipa \\\n-exportProvisioningProfile \"${profile_name}\" || exit`\n\n## æ¸…ç†å·¥ç¨‹\n`xcodebuild clean -configuration ${build_Mode} || exit`\n\n\n# Linuxå‘½ä»¤\nshellé‡Œé¢ä¼šæ¶‰åŠåˆ°ä¸€äº›Linuxå‘½ä»¤ï¼š\n\n`echo \"è¾“å‡ºå†…å®¹\"`\n\n`echo 'è¾“å‡ºå†…å®¹'`\n\nè¾“å‡ºä½ æƒ³è¦è¾“å‡ºçš„ä¸œè¥¿ï¼Œ*â€˜ â€™è¡¨ç¤ºè¦è¾“å‡ºçš„å†…å®¹ä¸ºçº¯å­—ç¬¦ä¸²ï¼Œä¸å¯å¼•ç”¨å˜é‡ï¼Œâ€œâ€è¡¨ç¤ºè¾“å‡ºçš„å†…å®¹å¯åŒ…å«å˜é‡*\n\n`cd ..`\n\nå›é€€ä¸Šä¸€çº§ç›®å½•\n\n`makdir`\n\næ–°å»ºä¸€ä¸ªç›®å½•\n\n`rm -rf \"content\"`\n\n\nåˆ é™¤æ–‡ä»¶å¤¹é‡Œé¢çš„æ‰€æœ‰å†…å®¹\n\n**ä»¥ä¸Šå†…å®¹çº¯å±è™šæ„ï¼Œè‹¥ä¸æ„Ÿå…´è¶£ï¼Œå®Œå…¨å¯ä»¥è·³è¿‡ï¼Œç›´å¥”ä½¿ç”¨~**\n\n\n# ä½¿ç”¨æ•™ç¨‹\n\n\n1. å°†ipa_buildè¿™ä¸ªæ–‡ä»¶å¤¹ç§»åˆ°å’Œ.xcodeprojæˆ–.xcworkspaceåŒä¸€çº§ç›®å½•\n\n2. æ‰“å¼€build_debugæˆ–è€…build_releaseæ–‡ä»¶ï¼Œæ›¿æ¢profile_nameå­—æ®µï¼Œæ›¿æ¢ä¸ºä½ è¦æ‰“åŒ…é¡¹ç›®çš„profile name\n\n3. æ‰“å¼€ä½ çš„å­—æ®µ  `cd è„šæœ¬æ‰€åœ¨çš„ç›®å½•` -> `chmod 777 build_debug.sh (ä»…ç¬¬ä¸€æ¬¡çš„æ—¶å€™éœ€è¦)` -> `./build_debug.sh`\n\n4. æŸ¥çœ‹ä½ çš„æ¡Œé¢å³å¯ä»¥æŸ¥çœ‹å¯¼å‡ºçš„IPAåŒ…\n\n<p>\n> æ„Ÿè°¢å¤§å®¶èŠ±è´¹æ—¶é—´æ¥æŸ¥çœ‹è¿™ç¯‡blogï¼Œéœ€è¦ä¸‹è½½shellçš„åŒå­¦è¯·çŒ›æˆ³[Git](https://github.com/PanXianyue/ipa_build)ã€‚","source":"_posts/xctool-package.md","raw":"---\ntitle: åˆ©ç”¨XCToolå®ç°è‡ªåŠ¨åŒ–æ‰“åŒ…\ndate: 2016-02-13 13:17:21\ncategories: iOS\ntags: [XCTOOL, SHELL, LINUXå‘½ä»¤]\n---\n\nä¸€ä¸ªä¸ä¼šå·æ‡’çš„ç¨‹åºå‘˜ä¸æ˜¯ä¸€ä¸ªå¥½ç¨‹åºå‘˜ã€‚æ¯æ¬¡ç¼–è¯‘æ‰“åŒ…éƒ½è¦èŠ±å¥½é•¿çš„æ—¶é—´ï¼Œçœ‹äº†æœ¬ç¯‡åšå®¢åï¼Œå°±å¯ä»¥å¸®è¿™äº›æ— èŠçš„äº‹æƒ…äº¤ç»™XCToolæ¥åšï¼Œæˆ‘ä»¬å–å–èŒ¶ï¼Œæ’©æ’©å¦¹å°±è¡Œã€‚\n<!--more-->\n\n\n# XCTool\n\nxctoolæ˜¯Facebookå¼€æºçš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ¥ä»£æ›¿è‹¹æœçš„xcodebuildå·¥å…·ã€‚\n\nåŠŸèƒ½å¦‚ä¸‹ï¼š\n\n* åƒxcodeä¸€æ ·èƒ½å¤Ÿç¼–è¯‘ç¨‹åº\n* ç¼–è¯‘çš„ç»“æœèƒ½å¤Ÿä»¥ç»“æ„åŒ–çš„å½¢å¼è¾“å‡º\n* ç¼–è¯‘å†…å®¹è¾“å‡ºå½©è‰²ä¸”æ–¹ä¾¿é˜…è¯»\n\n\n## å®‰è£…XCTool\n\næœ€ç®€å•çš„åŠæ³•å°±æ˜¯ç”¨homebrewå®‰è£…xctoolï¼Œè¿™è¾¹å°±ä¸ä»‹ç»å¦‚ä½•å®‰è£…homebrewäº†ã€‚\n\n` brew install xctool`\n\næ³¨ï¼šåœ¨ç”¨brewå®‰è£…xctoolçš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°can not install with HEAD errorï¼Œå½“æ—¶å°è¯•å¾ˆå¤šåŠæ³•éƒ½æ²¡æœ‰æå®šï¼Œåƒå¸äº†é‡è£…... ç»ˆæè§£å†³æ–¹æ¡ˆï¼šç›´æ¥åˆ é™¤/usr/localé‡Œé¢é‡Œé¢æ‰€æœ‰çš„æ–‡ä»¶ï¼Œ*è¿™è¾¹ä¼šå¯¼è‡´ä½ ä¹‹å‰å®‰è£…çš„ä¸€äº›æ’ä»¶ä¼šè¢«åˆ é™¤ï¼ŒåƒCocoaPods*ã€‚\n\n## ç¼–è¯‘\n\n`xctool -workspace ${project_path}/${project_name}.xcworkspace -scheme ${project_name} archive -archivePath ${project_path}/build/Debug-iphoneos/${project_name}_Debug.xcarchive -configuration ${build_Mode} || exit\n`\n \n# XcodeBuild\n\nshellé‡Œé¢ä¼šåˆ©ç”¨xcodebuildè¿›è¡Œæ‰“åŒ…ã€æ¸…ç†å·¥ç¨‹\n\n## æ‰“åŒ…\n`xcodebuild -exportArchive -archivePath ${project_path}/build/Debug-iphoneos/${project_name}_Debug.xcarchive -exportPath ${buildExportPath}/debug.ipa -exportFormat ipa \\\n-exportProvisioningProfile \"${profile_name}\" || exit`\n\n## æ¸…ç†å·¥ç¨‹\n`xcodebuild clean -configuration ${build_Mode} || exit`\n\n\n# Linuxå‘½ä»¤\nshellé‡Œé¢ä¼šæ¶‰åŠåˆ°ä¸€äº›Linuxå‘½ä»¤ï¼š\n\n`echo \"è¾“å‡ºå†…å®¹\"`\n\n`echo 'è¾“å‡ºå†…å®¹'`\n\nè¾“å‡ºä½ æƒ³è¦è¾“å‡ºçš„ä¸œè¥¿ï¼Œ*â€˜ â€™è¡¨ç¤ºè¦è¾“å‡ºçš„å†…å®¹ä¸ºçº¯å­—ç¬¦ä¸²ï¼Œä¸å¯å¼•ç”¨å˜é‡ï¼Œâ€œâ€è¡¨ç¤ºè¾“å‡ºçš„å†…å®¹å¯åŒ…å«å˜é‡*\n\n`cd ..`\n\nå›é€€ä¸Šä¸€çº§ç›®å½•\n\n`makdir`\n\næ–°å»ºä¸€ä¸ªç›®å½•\n\n`rm -rf \"content\"`\n\n\nåˆ é™¤æ–‡ä»¶å¤¹é‡Œé¢çš„æ‰€æœ‰å†…å®¹\n\n**ä»¥ä¸Šå†…å®¹çº¯å±è™šæ„ï¼Œè‹¥ä¸æ„Ÿå…´è¶£ï¼Œå®Œå…¨å¯ä»¥è·³è¿‡ï¼Œç›´å¥”ä½¿ç”¨~**\n\n\n# ä½¿ç”¨æ•™ç¨‹\n\n\n1. å°†ipa_buildè¿™ä¸ªæ–‡ä»¶å¤¹ç§»åˆ°å’Œ.xcodeprojæˆ–.xcworkspaceåŒä¸€çº§ç›®å½•\n\n2. æ‰“å¼€build_debugæˆ–è€…build_releaseæ–‡ä»¶ï¼Œæ›¿æ¢profile_nameå­—æ®µï¼Œæ›¿æ¢ä¸ºä½ è¦æ‰“åŒ…é¡¹ç›®çš„profile name\n\n3. æ‰“å¼€ä½ çš„å­—æ®µ  `cd è„šæœ¬æ‰€åœ¨çš„ç›®å½•` -> `chmod 777 build_debug.sh (ä»…ç¬¬ä¸€æ¬¡çš„æ—¶å€™éœ€è¦)` -> `./build_debug.sh`\n\n4. æŸ¥çœ‹ä½ çš„æ¡Œé¢å³å¯ä»¥æŸ¥çœ‹å¯¼å‡ºçš„IPAåŒ…\n\n<p>\n> æ„Ÿè°¢å¤§å®¶èŠ±è´¹æ—¶é—´æ¥æŸ¥çœ‹è¿™ç¯‡blogï¼Œéœ€è¦ä¸‹è½½shellçš„åŒå­¦è¯·çŒ›æˆ³[Git](https://github.com/PanXianyue/ipa_build)ã€‚","slug":"xctool-package","published":1,"updated":"2017-01-03T04:28:56.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjiitluei000555cg5w1v96dh"},{"title":"Sketch--makeicons","date":"2016-09-26T09:05:53.000Z","_content":"\nä¸€æšä¸åŠ¡æ­£ä¸šçš„iOSå·¥ç¨‹å¸ˆ\n<!--more-->\n\n## makeiconswithsketch\n\n![](http://7xq5ax.com1.z0.glb.clouddn.com/sketch-symbol)\n\n\n<p>\n## ç›¸å…³é“¾æ¥\n* **Sketch Toolbox**:http://sketchtoolbox.com/\n* **creativemarket**:https://creativemarket.com/\n* **Sketchä¸­æ–‡æ‰‹å†Œ**:http://www.sketchcn.com/sketch-chinese-user-manual.html\n* **dribbble**:https://dribbble.com/shots\n\n> æ¨¡ä»¿[Allenæœè¾‰](http://weibo.com/wangchaohui?from=myfollow_all&is_all=1#1474879197597)å®ç°äº†ä¸€éï¼ŒSo goodï¼åˆå­¦è®¾è®¡ï¼Œæœ‰ä»€ä¹ˆä¸è¶³ä¹‹å¤„è¿˜æœ›æŒ‡å¯¼ã€‚\n> èµ„æºæ”¾åœ¨[git](https://github.com/PanXianyue/BlogDemo/tree/master/Sketch)ä¸Šï¼Œæ–¹ä¾¿ç®¡ç†ã€‚","source":"_posts/sketch-makeicons.md","raw":"---\ntitle: Sketch--makeicons\ndate: 2016-09-26 17:05:53\ntags:\n---\n\nä¸€æšä¸åŠ¡æ­£ä¸šçš„iOSå·¥ç¨‹å¸ˆ\n<!--more-->\n\n## makeiconswithsketch\n\n![](http://7xq5ax.com1.z0.glb.clouddn.com/sketch-symbol)\n\n\n<p>\n## ç›¸å…³é“¾æ¥\n* **Sketch Toolbox**:http://sketchtoolbox.com/\n* **creativemarket**:https://creativemarket.com/\n* **Sketchä¸­æ–‡æ‰‹å†Œ**:http://www.sketchcn.com/sketch-chinese-user-manual.html\n* **dribbble**:https://dribbble.com/shots\n\n> æ¨¡ä»¿[Allenæœè¾‰](http://weibo.com/wangchaohui?from=myfollow_all&is_all=1#1474879197597)å®ç°äº†ä¸€éï¼ŒSo goodï¼åˆå­¦è®¾è®¡ï¼Œæœ‰ä»€ä¹ˆä¸è¶³ä¹‹å¤„è¿˜æœ›æŒ‡å¯¼ã€‚\n> èµ„æºæ”¾åœ¨[git](https://github.com/PanXianyue/BlogDemo/tree/master/Sketch)ä¸Šï¼Œæ–¹ä¾¿ç®¡ç†ã€‚","slug":"sketch-makeicons","published":1,"updated":"2017-01-03T04:28:56.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjiitluep000e55cgl11awjvk"},{"title":"gitå‘½ä»¤","date":"2017-02-25T09:33:33.000Z","_content":"\nå¸¸ç”¨gitå‘½ä»¤æ¢³ç†ç¯‡\n<!--more-->\n\n\n> é˜®ä¸€å³°è¿™ç¯‡[å¸¸ç”¨å‘½ä»¤æ¸…å•][1]æ¸…æ™°çš„æ€»ç»“äº†å¸¸ç”¨çš„å‘½ä»¤ï¼Œè¿™è¾¹æˆ‘å°±ä¸åœ¨èµ˜è¿°äº†ï¼Œè¿™è¾¹ä¸»è¦è¡¥å……å¹¶æ•´ç†ä¸ªäººçš„ä¸€äº›å‘½ä»¤\n\n### æ¸…å•\n\n`$ git commit --amend -m [message]`\n \\# ä½¿ç”¨ä¸€æ¬¡æ–°çš„commitï¼Œä»£æ›¿ä¸Šä¸€æ¬¡çš„æäº¤\n\\# **å¦‚æœä»£ç æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œåˆ™ç”¨æ¥æ”¹å†™ä¸Šä¸€æ¬¡commitçš„æäº¤ä¿¡æ¯**\n\n`$ git commit --amend [file1] [file2] ...`\n \\# é‡æ–°åšä¸Šæ¬¡çš„commitï¼Œ å¹¶åŒ…æ‹¬æŒ‡å®šæ–‡ä»¶çš„æ–°å˜åŒ–\n\n`$ git branch [branch] [commit]`\n\\# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼ŒæŒ‡å‘æŒ‡å®šcommit\n\n`$ git branch --set-upstream [branch] [remote-branch]`\n\\# å»ºç«‹è¿½è¸ªå…³ç³»ï¼Œåœ¨ç°æœ‰åˆ†æ”¯ä¸æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯ä¹‹é—´\n\n`$ git cherry-pick [commit]`\n\\# é€‰æ‹©ä¸€ä¸ªcommitï¼Œåˆå¹¶è¿›å½“å‰åˆ†æ”¯\n\n`$ git push -u [remote] [branch]`\n\\# æ¨é€åˆ°remoteä»“åº“ä¸‹çš„branchåˆ†æ”¯ï¼Œå¹¶å½“å‰åˆ†æ”¯trackingåˆ°remoteä»“åº“ä¸‹çš„branchåˆ†æ”¯\n\n`$ git push <remote> <local branch name>:<remote branch to push into>`\n\\# ä¸Šä¼ æœ¬åœ°çš„åˆ†æ”¯åˆ°è¿œç¨‹çš„åˆ†æ”¯\n\n`$ git reflog/git log -g`\n\\# æŸ¥çœ‹æ‰€æœ‰çš„å†å²æ“ä½œï¼Œè¿™ä¸ªå‘½åæ¯”è¾ƒå®ç”¨ã€‚æ¯”å¦‚æ–°æ¥çš„åŒäº‹ç»å¸¸è¯¯æ“ä½œgitå¯¼è‡´ä¸æƒ³å‘ç”Ÿçš„ç»“æœï¼Œè¿™ä¸ªæ—¶å€™ä½ å¯ä»¥ä½¿ç”¨git reflogæŸ¥çœ‹å…¶è¿›è¡Œçš„æ‰€æœ‰æ“ä½œï¼Œç„¶åè¿›è¡Œreset\n\n### å¸¸è§é—®é¢˜\n\n- gitæ¯æ¬¡è¦æ±‚ä½ è¾“å…¥å¯†ç ï¼ŒEnter passphrase for key '/Users/XY/.ssh/id\\_rsa':ï¼Ÿ  \n\tç›´æ¥æ•²`ssh-add`ç„¶åè¾“å…¥å¯†ç å³å¯ï¼Œ è¯¦æƒ…[ç‚¹å‡»][2]\n\n\n- git rebase å†²çª?\n\t1. è§£å†³ä¸€ä¸ªè¡¥ä¸çš„åº”ç”¨å†²çªåï¼Œæ ‡è®°å†²çªå·²è§£å†³ git add -u\n\t2. ç»§ç»­rebase Â  git rebase â€”continue\n\t3. pushåˆ°è¿œç«¯å°±okäº†ï¼Œaddåä¸éœ€è¦commit\n\t4. git rebase â€”about æ”¾å¼ƒrebase  \n\t\tgit rebase â€”skip Â  å¿½ç•¥æœ¬åœ°å†²çªçš„è¡¥ä¸\n\n\n- git fetch å’Œ git pull åŒºåˆ«ï¼Ÿ  \n\tpull = fetch + mergeï¼Œgit pull ç›¸å½“äº git fetch åŠ ä¸Šä¸€ä¸ªgit mergeçš„æ“ä½œ  \n\tgit fetch åˆ›å»ºå¹¶æ›´æ–°æ‰€æœ‰è¿œç«¯åˆ†æ”¯çš„æœ¬åœ°è¿œç«¯åˆ†æ”¯ï¼Œåˆ›å»ºè¿œç«¯åˆ†æ”¯æ—¶ï¼Œä¼šè‡ªåŠ¨è·å–æ–°åŠ å…¥çš„åˆ†æ”¯ï¼Œè¿™ä¸ªæ“ä½œå¹¶ä¸ä¼šæ”¹å˜æœ¬åœ°çš„å·¥ä½œåŒºï¼Œè¯¦æƒ…[ç‚¹å‡»][3]\n\n- git revert å’Œ git reset åŒºåˆ«ï¼Ÿ  \n\trevertï¼šé€šè¿‡åˆ›å»ºä¸€æ¬¡æ–°çš„ commit æ¥æ’¤é”€ä¸€æ¬¡ commit æ‰€åšå‡ºçš„ä¿®æ”¹ã€‚è¿™ç§æ’¤é”€çš„æ–¹å¼æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒå¹¶ä¸ä¿®æ”¹ commit history  \n\t  \n\tresetï¼šè¿˜åŸindexçš„çŠ¶æ€æˆ–è€…ä¿®æ”¹æœ¬åœ°åˆ†æ”¯HEADçš„ä½ç½®ã€‚æ¯”å¦‚ï¼Œ æŸä¸ªæäº¤ä¹‹åçš„ä»£ç éƒ½ä¸è¦äº†ï¼Œå°±å¯ä»¥åœ¨æœ¬åœ°ç›´æ¥resetè‡³æŒ‡å®šçš„commit  \n\tè¡¥å……ï¼š  \n\t `git reset --soft`  \n\t\\# staged snapshot å’Œ working directory éƒ½æœªè¢«æ”¹å˜  \n\t`git reset --mixed`  \n\t\\# staged snapshot è¢«æ›´æ–°ï¼Œ working directory æœªè¢«æ›´æ”¹  \n\t`git reset --hard`  \n\t\\# staged snapshot å’Œ working directory éƒ½å°†å›é€€  \n\tè¿™äº›æ ‡è®°ç»å¸¸å’ŒHEADä¸€èµ·ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œgit reset --mixed HEADå¯æ’¤é”€æ‰€æœ‰ç¼“å­˜æ”¹åŠ¨ï¼Œä½†æ˜¯ä¿ç•™ä»–ä»¬åœ¨å·¥ä½œç›®å½•ä¸‹ã€‚git reset --hard HEADå¯å½»åº•åˆ é™¤æ²¡æœ‰æäº¤çš„æ”¹åŠ¨  \n\n\n### ç›—ç”¨ä¸€ä¸‹ğŸ˜‚  \n![][image-1]\n\n[1]:\thttp://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html\n[2]:\thttp://unix.stackexchange.com/questions/12195/how-to-avoid-being-asked-passphrase-each-tim%E2%80%A6\n[3]:\thttp://stackoverflow.com/questions/292357/what-is-the-difference-between-git-pull-and-git-fetch\n\n[image-1]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/e55477eejw1f07e4ffienj21cv2funfq.jpg","source":"_posts/git-commands.md","raw":"---\ntitle: gitå‘½ä»¤\ndate: 2017-02-25 17:33:33\ntags: [GIT]\n---\n\nå¸¸ç”¨gitå‘½ä»¤æ¢³ç†ç¯‡\n<!--more-->\n\n\n> é˜®ä¸€å³°è¿™ç¯‡[å¸¸ç”¨å‘½ä»¤æ¸…å•][1]æ¸…æ™°çš„æ€»ç»“äº†å¸¸ç”¨çš„å‘½ä»¤ï¼Œè¿™è¾¹æˆ‘å°±ä¸åœ¨èµ˜è¿°äº†ï¼Œè¿™è¾¹ä¸»è¦è¡¥å……å¹¶æ•´ç†ä¸ªäººçš„ä¸€äº›å‘½ä»¤\n\n### æ¸…å•\n\n`$ git commit --amend -m [message]`\n \\# ä½¿ç”¨ä¸€æ¬¡æ–°çš„commitï¼Œä»£æ›¿ä¸Šä¸€æ¬¡çš„æäº¤\n\\# **å¦‚æœä»£ç æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œåˆ™ç”¨æ¥æ”¹å†™ä¸Šä¸€æ¬¡commitçš„æäº¤ä¿¡æ¯**\n\n`$ git commit --amend [file1] [file2] ...`\n \\# é‡æ–°åšä¸Šæ¬¡çš„commitï¼Œ å¹¶åŒ…æ‹¬æŒ‡å®šæ–‡ä»¶çš„æ–°å˜åŒ–\n\n`$ git branch [branch] [commit]`\n\\# æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼ŒæŒ‡å‘æŒ‡å®šcommit\n\n`$ git branch --set-upstream [branch] [remote-branch]`\n\\# å»ºç«‹è¿½è¸ªå…³ç³»ï¼Œåœ¨ç°æœ‰åˆ†æ”¯ä¸æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯ä¹‹é—´\n\n`$ git cherry-pick [commit]`\n\\# é€‰æ‹©ä¸€ä¸ªcommitï¼Œåˆå¹¶è¿›å½“å‰åˆ†æ”¯\n\n`$ git push -u [remote] [branch]`\n\\# æ¨é€åˆ°remoteä»“åº“ä¸‹çš„branchåˆ†æ”¯ï¼Œå¹¶å½“å‰åˆ†æ”¯trackingåˆ°remoteä»“åº“ä¸‹çš„branchåˆ†æ”¯\n\n`$ git push <remote> <local branch name>:<remote branch to push into>`\n\\# ä¸Šä¼ æœ¬åœ°çš„åˆ†æ”¯åˆ°è¿œç¨‹çš„åˆ†æ”¯\n\n`$ git reflog/git log -g`\n\\# æŸ¥çœ‹æ‰€æœ‰çš„å†å²æ“ä½œï¼Œè¿™ä¸ªå‘½åæ¯”è¾ƒå®ç”¨ã€‚æ¯”å¦‚æ–°æ¥çš„åŒäº‹ç»å¸¸è¯¯æ“ä½œgitå¯¼è‡´ä¸æƒ³å‘ç”Ÿçš„ç»“æœï¼Œè¿™ä¸ªæ—¶å€™ä½ å¯ä»¥ä½¿ç”¨git reflogæŸ¥çœ‹å…¶è¿›è¡Œçš„æ‰€æœ‰æ“ä½œï¼Œç„¶åè¿›è¡Œreset\n\n### å¸¸è§é—®é¢˜\n\n- gitæ¯æ¬¡è¦æ±‚ä½ è¾“å…¥å¯†ç ï¼ŒEnter passphrase for key '/Users/XY/.ssh/id\\_rsa':ï¼Ÿ  \n\tç›´æ¥æ•²`ssh-add`ç„¶åè¾“å…¥å¯†ç å³å¯ï¼Œ è¯¦æƒ…[ç‚¹å‡»][2]\n\n\n- git rebase å†²çª?\n\t1. è§£å†³ä¸€ä¸ªè¡¥ä¸çš„åº”ç”¨å†²çªåï¼Œæ ‡è®°å†²çªå·²è§£å†³ git add -u\n\t2. ç»§ç»­rebase Â  git rebase â€”continue\n\t3. pushåˆ°è¿œç«¯å°±okäº†ï¼Œaddåä¸éœ€è¦commit\n\t4. git rebase â€”about æ”¾å¼ƒrebase  \n\t\tgit rebase â€”skip Â  å¿½ç•¥æœ¬åœ°å†²çªçš„è¡¥ä¸\n\n\n- git fetch å’Œ git pull åŒºåˆ«ï¼Ÿ  \n\tpull = fetch + mergeï¼Œgit pull ç›¸å½“äº git fetch åŠ ä¸Šä¸€ä¸ªgit mergeçš„æ“ä½œ  \n\tgit fetch åˆ›å»ºå¹¶æ›´æ–°æ‰€æœ‰è¿œç«¯åˆ†æ”¯çš„æœ¬åœ°è¿œç«¯åˆ†æ”¯ï¼Œåˆ›å»ºè¿œç«¯åˆ†æ”¯æ—¶ï¼Œä¼šè‡ªåŠ¨è·å–æ–°åŠ å…¥çš„åˆ†æ”¯ï¼Œè¿™ä¸ªæ“ä½œå¹¶ä¸ä¼šæ”¹å˜æœ¬åœ°çš„å·¥ä½œåŒºï¼Œè¯¦æƒ…[ç‚¹å‡»][3]\n\n- git revert å’Œ git reset åŒºåˆ«ï¼Ÿ  \n\trevertï¼šé€šè¿‡åˆ›å»ºä¸€æ¬¡æ–°çš„ commit æ¥æ’¤é”€ä¸€æ¬¡ commit æ‰€åšå‡ºçš„ä¿®æ”¹ã€‚è¿™ç§æ’¤é”€çš„æ–¹å¼æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒå¹¶ä¸ä¿®æ”¹ commit history  \n\t  \n\tresetï¼šè¿˜åŸindexçš„çŠ¶æ€æˆ–è€…ä¿®æ”¹æœ¬åœ°åˆ†æ”¯HEADçš„ä½ç½®ã€‚æ¯”å¦‚ï¼Œ æŸä¸ªæäº¤ä¹‹åçš„ä»£ç éƒ½ä¸è¦äº†ï¼Œå°±å¯ä»¥åœ¨æœ¬åœ°ç›´æ¥resetè‡³æŒ‡å®šçš„commit  \n\tè¡¥å……ï¼š  \n\t `git reset --soft`  \n\t\\# staged snapshot å’Œ working directory éƒ½æœªè¢«æ”¹å˜  \n\t`git reset --mixed`  \n\t\\# staged snapshot è¢«æ›´æ–°ï¼Œ working directory æœªè¢«æ›´æ”¹  \n\t`git reset --hard`  \n\t\\# staged snapshot å’Œ working directory éƒ½å°†å›é€€  \n\tè¿™äº›æ ‡è®°ç»å¸¸å’ŒHEADä¸€èµ·ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œgit reset --mixed HEADå¯æ’¤é”€æ‰€æœ‰ç¼“å­˜æ”¹åŠ¨ï¼Œä½†æ˜¯ä¿ç•™ä»–ä»¬åœ¨å·¥ä½œç›®å½•ä¸‹ã€‚git reset --hard HEADå¯å½»åº•åˆ é™¤æ²¡æœ‰æäº¤çš„æ”¹åŠ¨  \n\n\n### ç›—ç”¨ä¸€ä¸‹ğŸ˜‚  \n![][image-1]\n\n[1]:\thttp://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html\n[2]:\thttp://unix.stackexchange.com/questions/12195/how-to-avoid-being-asked-passphrase-each-tim%E2%80%A6\n[3]:\thttp://stackoverflow.com/questions/292357/what-is-the-difference-between-git-pull-and-git-fetch\n\n[image-1]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/e55477eejw1f07e4ffienj21cv2funfq.jpg","slug":"git-commands","published":1,"updated":"2017-03-08T14:12:39.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjiitlues000f55cg9a2ws6i4"},{"title":"Alfred","date":"2017-01-03T04:30:11.000Z","_content":"\nä¸€æ¬¾ä½ ç”¨ä¸Šå°±çˆ±ä¸é‡Šæ‰‹çš„è½¯ä»¶\n<!--more-->\n\n\n## å¸¸ç”¨å‘½ä»¤\n\n`open` : å…³é”®å­—ç”¨æ¥æ‰“å¼€æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹ \n`find` : å…³é”®å­—ç”¨æ¥æŸ¥è¯¢æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹çš„ä½ç½® \n`in` : å…³é”®å­—ç”¨æ¥æŸ¥æ‰¾æ–‡æœ¬æ–‡ä»¶å†…å«æœ‰æŸ¥è¯¢æ–‡å­—çš„æ–‡ä»¶ï¼ˆè¿™ä¸ªåŠŸèƒ½å¾ˆå¼ºå¤§å•Šï¼‰ \n`tags` :å…³é”®å­—ç”¨æ¥æŸ¥è¯¢å«æœ‰æŸ¥è¯¢tagsçš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹ \n\n![][image-1]\n`/` : æ¥ç›´æ¥å®šä½åˆ°æ ¹ç›®å½•æˆ–è€…ä½¿ç”¨ \n`~` : æ¥ç›´æ¥å®šä½åˆ°å½“å‰ç”¨æˆ·çš„homeç›®å½• \n**åœ¨æ–‡ä»¶å®šä½å·¥å…·ä¸­æˆ‘ä»¬å¯ä»¥è®¾ç½®æ˜¯å¦ä½¿ç”¨å·¦å³å»ºæ¥ä½œä¸ºå‰è¿›æˆ–è€…åé€€åŠŸèƒ½Â **\n\n`screensaver` : å±å¹•ä¿æŠ¤ç¨‹åº\n`trash` : æ˜¾ç¤ºå›æ”¶ç«™\n`emptytrash` : æ¸…ç©ºå›æ”¶ç«™\n`logout` : ç™»å‡º\n`sleep` : ç¡çœ \n`lock` : é”å®š\n`restart` : é‡å¯\n`shutdown` : å…³æœº\n`hideÂ ` : éšè—\n`quitÂ ` : å…³é—­\n`forcequitÂ ` : å¼ºåˆ¶å…³é—­\n`quitallÂ ` : å…³é—­æ‰€æœ‰åº”ç”¨ç¨‹åº \n`>` : å…³é”®å­—å’Œä½¿ç”¨çš„é»˜è®¤æ§åˆ¶å°ç¨‹åº \n`di` : å…³é”®å­—æ¥æŸ¥è¯¢ä¸­è‹±å­—å…¸ \n\n### Quick Search\n![][image-2]\n\nå¯ç”¨äº†Quick Searché€‰é¡¹åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€™å•å¼•å·æˆ–è€…spaceç©ºæ ¼å¿«é€Ÿå¯ç”¨æ‰“å¼€æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹åŠŸèƒ½ç±»ä¼¼äºä½¿ç”¨openå…³é”®å­—\n\n### Buffer\n![][image-3]\nè¿™ä¸ªåŠŸèƒ½éå¸¸çš„å®ç”¨ï¼Œä¸ªäººè¡¨ç¤ºå¾ˆå–œæ¬¢ï¼Œèƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦çš„æé«˜æ•ˆç‡ã€‚å°†æŸ¥æ‰¾åˆ°çš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹åŠ å…¥åˆ°ç¼“å­˜ä¸­ï¼Œç„¶åå°±å¯ä»¥å¯¹æœç´¢åˆ°çš„ç»“æœåšæ‰¹é‡å¤„ç†äº†ã€‚è¿™é‡Œçš„è®¾ç½®ä¹Ÿå¾ˆç®€å•ä¸»è¦å°±æ˜¯æ˜¯å¦å¯ç”¨ç¼“å­˜åŠŸèƒ½å’Œç¼“å­˜åŠŸèƒ½çš„å‡ ä¸ªå¿«æ·é”®ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®ä½¿ç”¨å®Œåæ˜¯å¦æ¸…ç©ºç¼“å­˜ç­‰è®¾ç½®ã€‚ \n\n![][image-4]\n**é€šè¿‡optioné”® + â¬†ï¸æ¥å°†é€‰ä¸­çš„æ–‡ä»¶å¤¹æˆ–è€…æ–‡ä»¶åŠ å…¥åˆ°ç¼“å­˜ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚æœå­˜åœ¨ç¼“å­˜çš„è¯Alfredæœç´¢ç•Œé¢ä¸Šä¼šå‡ºç°é€‰ä¸­æ–‡ä»¶çš„å°å›¾æ ‡**\n\n![][image-5]\n**é€šè¿‡optioné”® + â¡ï¸æ¥æ‰¹é‡å¤„ç†ç¼“å­˜ä¸­çš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥æ‰“å¼€ã€å‘é‚®ä»¶ã€æ‹·è´ã€ç§»åŠ¨ã€åˆ é™¤ï¼ˆæ˜¯ä¸æ˜¯æ„Ÿè§‰åˆ°è¿™ä¸ªåŠŸèƒ½å°±æ˜¯ä»£æ›¿é¼ æ ‡é€‰ä¸­æ–‡ä»¶ç„¶åå³é”®çš„åŠŸèƒ½Â )**\n\n\n### 1Password\nä½¿ç”¨1på…³é”®å­—æ¥æŸ¥è¯¢å¯†ç åº“ \n![][image-6]\n\n![][image-7]\n\n> å¾ˆå®¹æ˜“å¿˜è®°ï¼Œç´¢æ€§å°±å°†ç¬”è®°æ•´ç†æˆblogäº†ã€‚åç»­æœ‰æ—¶é—´å†è¿›è¡Œæ‰©å±•ï¼Œä¸è¶³ä¹‹å¤„è¿˜æœ›è§è°…ã€‚\n\n\n\n[image-1]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/alfread-1.png\n[image-2]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/Alfred-Quick%20Search.png\n[image-3]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/Alfred-buffer.png\n[image-4]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/Alfred-search.png\n[image-5]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/Alfred-buffer2.png\n[image-6]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/Alfred-1p.png\n[image-7]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/Alfred-1p-search.png","source":"_posts/alfred-use.md","raw":"\n---\ntitle: Alfred\ndate: 2017-01-03 12:30:11\ntags: [Tool]\n---\n\nä¸€æ¬¾ä½ ç”¨ä¸Šå°±çˆ±ä¸é‡Šæ‰‹çš„è½¯ä»¶\n<!--more-->\n\n\n## å¸¸ç”¨å‘½ä»¤\n\n`open` : å…³é”®å­—ç”¨æ¥æ‰“å¼€æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹ \n`find` : å…³é”®å­—ç”¨æ¥æŸ¥è¯¢æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹çš„ä½ç½® \n`in` : å…³é”®å­—ç”¨æ¥æŸ¥æ‰¾æ–‡æœ¬æ–‡ä»¶å†…å«æœ‰æŸ¥è¯¢æ–‡å­—çš„æ–‡ä»¶ï¼ˆè¿™ä¸ªåŠŸèƒ½å¾ˆå¼ºå¤§å•Šï¼‰ \n`tags` :å…³é”®å­—ç”¨æ¥æŸ¥è¯¢å«æœ‰æŸ¥è¯¢tagsçš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹ \n\n![][image-1]\n`/` : æ¥ç›´æ¥å®šä½åˆ°æ ¹ç›®å½•æˆ–è€…ä½¿ç”¨ \n`~` : æ¥ç›´æ¥å®šä½åˆ°å½“å‰ç”¨æˆ·çš„homeç›®å½• \n**åœ¨æ–‡ä»¶å®šä½å·¥å…·ä¸­æˆ‘ä»¬å¯ä»¥è®¾ç½®æ˜¯å¦ä½¿ç”¨å·¦å³å»ºæ¥ä½œä¸ºå‰è¿›æˆ–è€…åé€€åŠŸèƒ½Â **\n\n`screensaver` : å±å¹•ä¿æŠ¤ç¨‹åº\n`trash` : æ˜¾ç¤ºå›æ”¶ç«™\n`emptytrash` : æ¸…ç©ºå›æ”¶ç«™\n`logout` : ç™»å‡º\n`sleep` : ç¡çœ \n`lock` : é”å®š\n`restart` : é‡å¯\n`shutdown` : å…³æœº\n`hideÂ ` : éšè—\n`quitÂ ` : å…³é—­\n`forcequitÂ ` : å¼ºåˆ¶å…³é—­\n`quitallÂ ` : å…³é—­æ‰€æœ‰åº”ç”¨ç¨‹åº \n`>` : å…³é”®å­—å’Œä½¿ç”¨çš„é»˜è®¤æ§åˆ¶å°ç¨‹åº \n`di` : å…³é”®å­—æ¥æŸ¥è¯¢ä¸­è‹±å­—å…¸ \n\n### Quick Search\n![][image-2]\n\nå¯ç”¨äº†Quick Searché€‰é¡¹åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€™å•å¼•å·æˆ–è€…spaceç©ºæ ¼å¿«é€Ÿå¯ç”¨æ‰“å¼€æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹åŠŸèƒ½ç±»ä¼¼äºä½¿ç”¨openå…³é”®å­—\n\n### Buffer\n![][image-3]\nè¿™ä¸ªåŠŸèƒ½éå¸¸çš„å®ç”¨ï¼Œä¸ªäººè¡¨ç¤ºå¾ˆå–œæ¬¢ï¼Œèƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦çš„æé«˜æ•ˆç‡ã€‚å°†æŸ¥æ‰¾åˆ°çš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹åŠ å…¥åˆ°ç¼“å­˜ä¸­ï¼Œç„¶åå°±å¯ä»¥å¯¹æœç´¢åˆ°çš„ç»“æœåšæ‰¹é‡å¤„ç†äº†ã€‚è¿™é‡Œçš„è®¾ç½®ä¹Ÿå¾ˆç®€å•ä¸»è¦å°±æ˜¯æ˜¯å¦å¯ç”¨ç¼“å­˜åŠŸèƒ½å’Œç¼“å­˜åŠŸèƒ½çš„å‡ ä¸ªå¿«æ·é”®ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®ä½¿ç”¨å®Œåæ˜¯å¦æ¸…ç©ºç¼“å­˜ç­‰è®¾ç½®ã€‚ \n\n![][image-4]\n**é€šè¿‡optioné”® + â¬†ï¸æ¥å°†é€‰ä¸­çš„æ–‡ä»¶å¤¹æˆ–è€…æ–‡ä»¶åŠ å…¥åˆ°ç¼“å­˜ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚æœå­˜åœ¨ç¼“å­˜çš„è¯Alfredæœç´¢ç•Œé¢ä¸Šä¼šå‡ºç°é€‰ä¸­æ–‡ä»¶çš„å°å›¾æ ‡**\n\n![][image-5]\n**é€šè¿‡optioné”® + â¡ï¸æ¥æ‰¹é‡å¤„ç†ç¼“å­˜ä¸­çš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥æ‰“å¼€ã€å‘é‚®ä»¶ã€æ‹·è´ã€ç§»åŠ¨ã€åˆ é™¤ï¼ˆæ˜¯ä¸æ˜¯æ„Ÿè§‰åˆ°è¿™ä¸ªåŠŸèƒ½å°±æ˜¯ä»£æ›¿é¼ æ ‡é€‰ä¸­æ–‡ä»¶ç„¶åå³é”®çš„åŠŸèƒ½Â )**\n\n\n### 1Password\nä½¿ç”¨1på…³é”®å­—æ¥æŸ¥è¯¢å¯†ç åº“ \n![][image-6]\n\n![][image-7]\n\n> å¾ˆå®¹æ˜“å¿˜è®°ï¼Œç´¢æ€§å°±å°†ç¬”è®°æ•´ç†æˆblogäº†ã€‚åç»­æœ‰æ—¶é—´å†è¿›è¡Œæ‰©å±•ï¼Œä¸è¶³ä¹‹å¤„è¿˜æœ›è§è°…ã€‚\n\n\n\n[image-1]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/alfread-1.png\n[image-2]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/Alfred-Quick%20Search.png\n[image-3]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/Alfred-buffer.png\n[image-4]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/Alfred-search.png\n[image-5]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/Alfred-buffer2.png\n[image-6]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/Alfred-1p.png\n[image-7]:\thttp://7xq5ax.com1.z0.glb.clouddn.com/Alfred-1p-search.png","slug":"alfred-use","published":1,"updated":"2017-01-03T10:50:15.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjiitluev000i55cghs04ml91"},{"title":"YYKitæºç åˆ†æ---pthread","date":"2016-06-21T09:43:18.000Z","_content":"\nå¤§å®¶éƒ½çŸ¥é“ibiremeçš„[YYKit](https://github.com/ibireme/YYKit)å¾ˆå¼ºå¤§ï¼Œä¸ªäººä¹Ÿç‰¹åˆ«ä½©æœibiremeã€‚å¤§ç¥å¸¸å¸¸æ•™å¯¼æˆ‘ä»¬è¿™æ ·çš„å°ç™½è¯´ï¼šå¤šè¯»æºç èƒ½å¤Ÿå¤§å¹…åº¦çš„æé«˜åŠŸåŠ›ã€‚ <p>æ¯å½“é¡¹ç›®ä¸Šçº¿åï¼Œéœ€æ±‚è¿˜æ²¡æœ‰ä¸‹æ¥æ—¶ï¼Œéƒ½ä¼šæœ‰ä¸€æ®µé—²æš‡æ—¶é—´ã€‚è¿™æ®µæ—¶é—´å­¦ä¹ æ˜¯æä½³çš„ã€‚YYKitè¿™ä¸ªæ¡†æ¶åˆšå¼€å§‹çœ‹çš„æ—¶å€™å°±é‡åˆ°pthreadè¿™ä¸ªç©æ„ï¼Œä¹‹å‰å¾ˆå°‘æ¥è§¦ã€‚åœ¨æ­¤ï¼Œè®°å½•è‡ªå·±çš„æ‰€å­¦æ‰€å¾—ï¼Œå¹¶åˆ†äº«ç»™å¤§å®¶ã€‚\n<!--more-->\n\n\n## å…ˆæ¥çœ‹ä¸‹YYå®šä¹‰çš„å®\n```\nstatic inline void pthread_mutex_init_recursive(pthread_mutex_t *mutex, bool recursive) {\n#define YYMUTEX_ASSERT_ON_ERROR(x_) do { \\\n__unused volatile int res = (x_); \\\nassert(res == 0); \\\n} while (0)\n    assert(mutex != NULL);\n    if (!recursive) {\n        YYMUTEX_ASSERT_ON_ERROR(pthread_mutex_init(mutex, NULL));\n    } else {\n        pthread_mutexattr_t attr;\n        \n        YYMUTEX_ASSERT_ON_ERROR(pthread_mutexattr_init (&attr));\n        YYMUTEX_ASSERT_ON_ERROR(pthread_mutexattr_settype (&attr, PTHREAD_MUTEX_RECURSIVE));\n        YYMUTEX_ASSERT_ON_ERROR(pthread_mutex_init (mutex, &attr));\n        YYMUTEX_ASSERT_ON_ERROR(pthread_mutexattr_destroy (&attr));\n    }\n#undef YYMUTEX_ASSERT_ON_ERROR\n}   \n```\nå¤§ç¥çš„ä»£ç éƒ½æ˜¯æ™¦æ¶©éš¾æ‡‚çš„ï¼Œçœ‹åˆ°è¿™æ®µä»£ç ååŠ³èµ„çªç„¶äº§ç”Ÿäº†å¥½å‡ ä¸ªé—®é¢˜ï¼š\n\n- è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥å¹²å˜›çš„å‘¢ï¼Ÿ\n- pthread_mutex_tæ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ\n- pthread_mutexattr_tæ˜¯ç”¨æ¥é…ç½®pthread_mutex_tçš„å—ï¼Ÿ\n\n## è§£è¯»\n#### åŠŸèƒ½\nå…¶å®å°±æ˜¯åˆ›å»ºä¸ªäº’æ–¥çº¿ç¨‹ï¼Œå¹¶æ²¡æœ‰æƒ³è±¡ä¸­çš„å¯æ€•\n#### pthread_mutex_t\n`int pthread_mutex_init(pthread_mutex_t * __restrict,\n\t\tconst pthread_mutexattr_t * __restrict);` æ˜¯ç”¨è¿™ä¸ªå‡½æ•°åˆ›å»ºå‡ºæ¥çš„ã€‚å‡½æ•°æ˜¯ä»¥åŠ¨æ€çš„æ–¹å¼åˆ›å»ºäº’æ–¥é”çš„ï¼Œå‚æ•°attræŒ‡å®šäº†æ–°å»ºäº’æ–¥é”çš„å±æ€§ã€‚<br>`recursive`è¿™ä¸ª`bool`å€¼ä¸ºfalseæ—¶ï¼Œatträ¸ºç©ºï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„äº’æ–¥é”å±æ€§ï¼Œé»˜è®¤å±æ€§ä¸ºå¿«é€Ÿäº’æ–¥é”ã€‚<br>`recursive`è¿™ä¸ª`bool`å€¼ä¸ºtrueæ—¶ï¼Œé…ç½®äº’æ–¥é”å±æ€§åˆ›å»ºç›¸åº”çš„äº’æ–¥é”ã€‚\n#### YYMUTEX_ASSERT_ON_ERROR\næ–­è¨€æ¥è¿›è¡Œæ£€æŸ¥é”™è¯¯ï¼Œæ‰€æœ‰æ“ä½œè¿”å›é0æ—¶ï¼Œè¡¨ç¤ºæœ‰å¼‚å¸¸é”™è¯¯å‘ç”Ÿ\n#### Mutex type attributes\n**PTHREAD_MUTEX_NORMAL**ï¼šä¸è¿›è¡Œdeadlock detectionï¼ˆæ­»é”æ£€æµ‹ï¼‰ã€‚å½“è¿›è¡Œrelockæ—¶ï¼Œè¿™ä¸ªmutexå°±å¯¼è‡´deadlockã€‚å¯¹ä¸€ä¸ªæ²¡æœ‰è¿›è¡Œlockæˆ–è€…å·²ç»unlockçš„å¯¹è±¡è¿›è¡Œunlockæ“ä½œï¼Œç»“æœä¹Ÿæ˜¯æœªçŸ¥çš„ã€‚<br>**PTHREAD_MUTEX_ERRORCHECK**ï¼šå’ŒPTHREAD_MUTEX_NORMALç›¸æ¯”ï¼ŒPTHREAD_MUTEX_ERRORCHECKä¼šè¿›è¡Œé”™è¯¯æ£€æµ‹ï¼Œä»¥ä¸Šé”™è¯¯è¡Œä¸ºéƒ½ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚<br>**PTHREAD_MUTEX_RECURSIVE**ï¼šå’Œsemaphoreï¼ˆä¿¡å·é‡ï¼‰æœ‰ä¸ªç±»ä¼¼çš„ä¸œè¥¿ï¼Œmutexä¼šæœ‰ä¸ªé”ä½æ¬¡æ•°çš„æ¦‚å¿µï¼Œç¬¬ä¸€æ¬¡é”ä½mutexçš„æ—¶å€™ï¼Œé”ä½æ¬¡æ•°è®¾ç½®ä¸º1ï¼Œæ¯ä¸€æ¬¡ä¸€ä¸ªçº¿ç¨‹unlockè¿™ä¸ªmutexæ—¶ï¼Œé”ä½æ¬¡æ•°å°±ä¼šå‡1ã€‚å½“é”ä½æ¬¡æ•°ä¸º0æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å°±å¯ä»¥è·å¾—è¯¥mutexé”äº†ã€‚åŒæ ·ï¼Œå¯¹ä¸€ä¸ªæ²¡æœ‰è¿›è¡Œlockæˆ–è€…å·²ç»unlockçš„å¯¹è±¡è¿›è¡Œunlockæ“ä½œï¼Œå°†è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚<br>**PTHREAD_MUTEX_DEFAULT**ï¼šé»˜è®¤PTHREAD_MUTEX_NORMALã€‚\n\n## å†çœ‹çœ‹YYå¦‚ä½•ä½¿ç”¨è¯¥å®\n```\n- (YYImageFrame *)frameAtIndex:(NSUInteger)index decodeForDisplay:(BOOL)decodeForDisplay {\n    YYImageFrame *result = nil;\n    pthread_mutex_lock(&_lock);\n    result = [self _frameAtIndex:index decodeForDisplay:decodeForDisplay];\n    pthread_mutex_unlock(&_lock);\n    return result;\n}\n```\n**è¿™è¾¹ä¸ºäº†é˜²æ­¢å¤šçº¿ç¨‹èµ„æºæŠ¢å¤ºçš„é—®é¢˜ï¼Œå…ˆè¿›è¡Œlockä¸‹ï¼Œç­‰æ•°æ®æ“ä½œå®Œæ¯•åé‡Šæ”¾unlockï¼Œæœ‰æ²¡æœ‰ä¸€ç§è±ç„¶å¼€æœ—çš„æ„Ÿè§‰å‘¢<br>å¹³æ—¶æˆ‘ä»¬åœ¨å¤šçº¿ç¨‹æ“ä½œçš„æ—¶å€™ä¹Ÿå¯ä»¥ä½¿ç”¨NSLockã€synchronizedæ¥è¿›è¡ŒåŠ é”ï¼Œyyä½¿ç”¨äº†æ›´åŠ åå‘åº•å±‚çš„pthread**\n\n## pthread_tå’ŒNSThread\nä¸¤è€…éƒ½æ˜¯ç”¨æ¥æ“ä½œçº¿ç¨‹çš„å¯¹è±¡ï¼Œå¹³æ—¶æˆ‘ä»¬ä½¿ç”¨ä¸Šå±‚çš„NSThreadæ¯”è¾ƒå¤šï¼Œåƒ[NSThread mainThread]è·å–ä¸»çº¿ç¨‹ï¼Œ[NSThread currentThread] è·å–å½“å‰çº¿ç¨‹ã€‚pthread_tå’ŒNSThreadæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼ŒåŒæ ·å¯ä»¥é€šè¿‡pthread_main_thread_np() ã€pthread_self()æ¥è·å–ã€‚NSThreadåªæ˜¯å¯¹pthread_tçš„ä¸€å±‚å°è£…è€Œå·²ã€‚\n\n## å®æˆ˜\n- å£°æ˜å‡½æ•°\n\n```\nvoid *func(void *argu) {\n    char *m = (char *)argu;\n\n    pthread_mutex_lock(&mutex);\n    while (*m != '\\0') {\n        printf(\"%c\", *m);\n        fflush(stdout);\n        sleep(3);\n        m++;\n    }\n    printf(\"\\n\");\n    pthread_mutex_unlock(&mutex);\n    return 0;\n}\n```\n\n- mutexä½¿ç”¨ \n\n```\n    int rc1, rc2;\n    \n    char *str1 = \"Hi\";\n    char *str2 = \"Boy!\";\n    \n    pthread_t thread1, thread2;\n    pthread_mutex_init(&mutex, NULL);\n\n    if ((rc1 = pthread_create(&thread1, NULL, func, str1))) {\n        fprintf(stdout, \"thread1 creat fail : %d \\n!\", rc1);\n    }\n    if ((rc2 = pthread_create(&thread2, NULL, func, str2))) {\n        fprintf(stdout, \"thread2 creat fail : %d \\n!\", rc2);\n    }\n\n    // https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man3/pthread_join.3.html#//apple_ref/c/func/pthread_join\n    // ç­‰å¾…ä¸€ä¸ªçº¿ç¨‹çš„ç»“æŸï¼Œå½“å‡½æ•°è¿”å›æ—¶ï¼Œè¢«ç­‰å¾…çš„çº¿ç¨‹èµ„æºè¢«æ”¶å›ã€‚è‹¥çº¿ç¨‹å·²ç»è¢«æ”¶å›ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°ä¼šç«‹å³è¿”å›\n    pthread_join(thread1, NULL);\n    pthread_join(thread2, NULL);\n\n\tprintf(\"è¿™è¾¹åªæœ‰çº¿ç¨‹è¢«å›æ”¶åæ‰ä¼šæ‰§è¡Œï¼\");\n```\n- å¯ä»¥å¸®pthread_mutex_lock(&mutex)å’Œpthread_mutex_unlock(&mutex)æ³¨é‡Šæ‰çœ‹ä¸‹æ‰“å°<p>\n\n> æ„Ÿè°¢å¤§å®¶èŠ±è´¹æ—¶é—´æ¥æŸ¥çœ‹è¿™ç¯‡blogï¼Œéœ€è¦ä¸‹è½½demoçš„åŒå­¦è¯·çŒ›æˆ³[Git](https://github.com/PanXianyue/BlogDemo)ã€‚","source":"_posts/YYKit-pthread.md","raw":"---\ntitle: YYKitæºç åˆ†æ---pthread\ndate: 2016-06-21 17:43:18\ncategories: iOS\ntags: [YYKit, pthread]\n---\n\nå¤§å®¶éƒ½çŸ¥é“ibiremeçš„[YYKit](https://github.com/ibireme/YYKit)å¾ˆå¼ºå¤§ï¼Œä¸ªäººä¹Ÿç‰¹åˆ«ä½©æœibiremeã€‚å¤§ç¥å¸¸å¸¸æ•™å¯¼æˆ‘ä»¬è¿™æ ·çš„å°ç™½è¯´ï¼šå¤šè¯»æºç èƒ½å¤Ÿå¤§å¹…åº¦çš„æé«˜åŠŸåŠ›ã€‚ <p>æ¯å½“é¡¹ç›®ä¸Šçº¿åï¼Œéœ€æ±‚è¿˜æ²¡æœ‰ä¸‹æ¥æ—¶ï¼Œéƒ½ä¼šæœ‰ä¸€æ®µé—²æš‡æ—¶é—´ã€‚è¿™æ®µæ—¶é—´å­¦ä¹ æ˜¯æä½³çš„ã€‚YYKitè¿™ä¸ªæ¡†æ¶åˆšå¼€å§‹çœ‹çš„æ—¶å€™å°±é‡åˆ°pthreadè¿™ä¸ªç©æ„ï¼Œä¹‹å‰å¾ˆå°‘æ¥è§¦ã€‚åœ¨æ­¤ï¼Œè®°å½•è‡ªå·±çš„æ‰€å­¦æ‰€å¾—ï¼Œå¹¶åˆ†äº«ç»™å¤§å®¶ã€‚\n<!--more-->\n\n\n## å…ˆæ¥çœ‹ä¸‹YYå®šä¹‰çš„å®\n```\nstatic inline void pthread_mutex_init_recursive(pthread_mutex_t *mutex, bool recursive) {\n#define YYMUTEX_ASSERT_ON_ERROR(x_) do { \\\n__unused volatile int res = (x_); \\\nassert(res == 0); \\\n} while (0)\n    assert(mutex != NULL);\n    if (!recursive) {\n        YYMUTEX_ASSERT_ON_ERROR(pthread_mutex_init(mutex, NULL));\n    } else {\n        pthread_mutexattr_t attr;\n        \n        YYMUTEX_ASSERT_ON_ERROR(pthread_mutexattr_init (&attr));\n        YYMUTEX_ASSERT_ON_ERROR(pthread_mutexattr_settype (&attr, PTHREAD_MUTEX_RECURSIVE));\n        YYMUTEX_ASSERT_ON_ERROR(pthread_mutex_init (mutex, &attr));\n        YYMUTEX_ASSERT_ON_ERROR(pthread_mutexattr_destroy (&attr));\n    }\n#undef YYMUTEX_ASSERT_ON_ERROR\n}   \n```\nå¤§ç¥çš„ä»£ç éƒ½æ˜¯æ™¦æ¶©éš¾æ‡‚çš„ï¼Œçœ‹åˆ°è¿™æ®µä»£ç ååŠ³èµ„çªç„¶äº§ç”Ÿäº†å¥½å‡ ä¸ªé—®é¢˜ï¼š\n\n- è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥å¹²å˜›çš„å‘¢ï¼Ÿ\n- pthread_mutex_tæ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ\n- pthread_mutexattr_tæ˜¯ç”¨æ¥é…ç½®pthread_mutex_tçš„å—ï¼Ÿ\n\n## è§£è¯»\n#### åŠŸèƒ½\nå…¶å®å°±æ˜¯åˆ›å»ºä¸ªäº’æ–¥çº¿ç¨‹ï¼Œå¹¶æ²¡æœ‰æƒ³è±¡ä¸­çš„å¯æ€•\n#### pthread_mutex_t\n`int pthread_mutex_init(pthread_mutex_t * __restrict,\n\t\tconst pthread_mutexattr_t * __restrict);` æ˜¯ç”¨è¿™ä¸ªå‡½æ•°åˆ›å»ºå‡ºæ¥çš„ã€‚å‡½æ•°æ˜¯ä»¥åŠ¨æ€çš„æ–¹å¼åˆ›å»ºäº’æ–¥é”çš„ï¼Œå‚æ•°attræŒ‡å®šäº†æ–°å»ºäº’æ–¥é”çš„å±æ€§ã€‚<br>`recursive`è¿™ä¸ª`bool`å€¼ä¸ºfalseæ—¶ï¼Œatträ¸ºç©ºï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„äº’æ–¥é”å±æ€§ï¼Œé»˜è®¤å±æ€§ä¸ºå¿«é€Ÿäº’æ–¥é”ã€‚<br>`recursive`è¿™ä¸ª`bool`å€¼ä¸ºtrueæ—¶ï¼Œé…ç½®äº’æ–¥é”å±æ€§åˆ›å»ºç›¸åº”çš„äº’æ–¥é”ã€‚\n#### YYMUTEX_ASSERT_ON_ERROR\næ–­è¨€æ¥è¿›è¡Œæ£€æŸ¥é”™è¯¯ï¼Œæ‰€æœ‰æ“ä½œè¿”å›é0æ—¶ï¼Œè¡¨ç¤ºæœ‰å¼‚å¸¸é”™è¯¯å‘ç”Ÿ\n#### Mutex type attributes\n**PTHREAD_MUTEX_NORMAL**ï¼šä¸è¿›è¡Œdeadlock detectionï¼ˆæ­»é”æ£€æµ‹ï¼‰ã€‚å½“è¿›è¡Œrelockæ—¶ï¼Œè¿™ä¸ªmutexå°±å¯¼è‡´deadlockã€‚å¯¹ä¸€ä¸ªæ²¡æœ‰è¿›è¡Œlockæˆ–è€…å·²ç»unlockçš„å¯¹è±¡è¿›è¡Œunlockæ“ä½œï¼Œç»“æœä¹Ÿæ˜¯æœªçŸ¥çš„ã€‚<br>**PTHREAD_MUTEX_ERRORCHECK**ï¼šå’ŒPTHREAD_MUTEX_NORMALç›¸æ¯”ï¼ŒPTHREAD_MUTEX_ERRORCHECKä¼šè¿›è¡Œé”™è¯¯æ£€æµ‹ï¼Œä»¥ä¸Šé”™è¯¯è¡Œä¸ºéƒ½ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚<br>**PTHREAD_MUTEX_RECURSIVE**ï¼šå’Œsemaphoreï¼ˆä¿¡å·é‡ï¼‰æœ‰ä¸ªç±»ä¼¼çš„ä¸œè¥¿ï¼Œmutexä¼šæœ‰ä¸ªé”ä½æ¬¡æ•°çš„æ¦‚å¿µï¼Œç¬¬ä¸€æ¬¡é”ä½mutexçš„æ—¶å€™ï¼Œé”ä½æ¬¡æ•°è®¾ç½®ä¸º1ï¼Œæ¯ä¸€æ¬¡ä¸€ä¸ªçº¿ç¨‹unlockè¿™ä¸ªmutexæ—¶ï¼Œé”ä½æ¬¡æ•°å°±ä¼šå‡1ã€‚å½“é”ä½æ¬¡æ•°ä¸º0æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å°±å¯ä»¥è·å¾—è¯¥mutexé”äº†ã€‚åŒæ ·ï¼Œå¯¹ä¸€ä¸ªæ²¡æœ‰è¿›è¡Œlockæˆ–è€…å·²ç»unlockçš„å¯¹è±¡è¿›è¡Œunlockæ“ä½œï¼Œå°†è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚<br>**PTHREAD_MUTEX_DEFAULT**ï¼šé»˜è®¤PTHREAD_MUTEX_NORMALã€‚\n\n## å†çœ‹çœ‹YYå¦‚ä½•ä½¿ç”¨è¯¥å®\n```\n- (YYImageFrame *)frameAtIndex:(NSUInteger)index decodeForDisplay:(BOOL)decodeForDisplay {\n    YYImageFrame *result = nil;\n    pthread_mutex_lock(&_lock);\n    result = [self _frameAtIndex:index decodeForDisplay:decodeForDisplay];\n    pthread_mutex_unlock(&_lock);\n    return result;\n}\n```\n**è¿™è¾¹ä¸ºäº†é˜²æ­¢å¤šçº¿ç¨‹èµ„æºæŠ¢å¤ºçš„é—®é¢˜ï¼Œå…ˆè¿›è¡Œlockä¸‹ï¼Œç­‰æ•°æ®æ“ä½œå®Œæ¯•åé‡Šæ”¾unlockï¼Œæœ‰æ²¡æœ‰ä¸€ç§è±ç„¶å¼€æœ—çš„æ„Ÿè§‰å‘¢<br>å¹³æ—¶æˆ‘ä»¬åœ¨å¤šçº¿ç¨‹æ“ä½œçš„æ—¶å€™ä¹Ÿå¯ä»¥ä½¿ç”¨NSLockã€synchronizedæ¥è¿›è¡ŒåŠ é”ï¼Œyyä½¿ç”¨äº†æ›´åŠ åå‘åº•å±‚çš„pthread**\n\n## pthread_tå’ŒNSThread\nä¸¤è€…éƒ½æ˜¯ç”¨æ¥æ“ä½œçº¿ç¨‹çš„å¯¹è±¡ï¼Œå¹³æ—¶æˆ‘ä»¬ä½¿ç”¨ä¸Šå±‚çš„NSThreadæ¯”è¾ƒå¤šï¼Œåƒ[NSThread mainThread]è·å–ä¸»çº¿ç¨‹ï¼Œ[NSThread currentThread] è·å–å½“å‰çº¿ç¨‹ã€‚pthread_tå’ŒNSThreadæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼ŒåŒæ ·å¯ä»¥é€šè¿‡pthread_main_thread_np() ã€pthread_self()æ¥è·å–ã€‚NSThreadåªæ˜¯å¯¹pthread_tçš„ä¸€å±‚å°è£…è€Œå·²ã€‚\n\n## å®æˆ˜\n- å£°æ˜å‡½æ•°\n\n```\nvoid *func(void *argu) {\n    char *m = (char *)argu;\n\n    pthread_mutex_lock(&mutex);\n    while (*m != '\\0') {\n        printf(\"%c\", *m);\n        fflush(stdout);\n        sleep(3);\n        m++;\n    }\n    printf(\"\\n\");\n    pthread_mutex_unlock(&mutex);\n    return 0;\n}\n```\n\n- mutexä½¿ç”¨ \n\n```\n    int rc1, rc2;\n    \n    char *str1 = \"Hi\";\n    char *str2 = \"Boy!\";\n    \n    pthread_t thread1, thread2;\n    pthread_mutex_init(&mutex, NULL);\n\n    if ((rc1 = pthread_create(&thread1, NULL, func, str1))) {\n        fprintf(stdout, \"thread1 creat fail : %d \\n!\", rc1);\n    }\n    if ((rc2 = pthread_create(&thread2, NULL, func, str2))) {\n        fprintf(stdout, \"thread2 creat fail : %d \\n!\", rc2);\n    }\n\n    // https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man3/pthread_join.3.html#//apple_ref/c/func/pthread_join\n    // ç­‰å¾…ä¸€ä¸ªçº¿ç¨‹çš„ç»“æŸï¼Œå½“å‡½æ•°è¿”å›æ—¶ï¼Œè¢«ç­‰å¾…çš„çº¿ç¨‹èµ„æºè¢«æ”¶å›ã€‚è‹¥çº¿ç¨‹å·²ç»è¢«æ”¶å›ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°ä¼šç«‹å³è¿”å›\n    pthread_join(thread1, NULL);\n    pthread_join(thread2, NULL);\n\n\tprintf(\"è¿™è¾¹åªæœ‰çº¿ç¨‹è¢«å›æ”¶åæ‰ä¼šæ‰§è¡Œï¼\");\n```\n- å¯ä»¥å¸®pthread_mutex_lock(&mutex)å’Œpthread_mutex_unlock(&mutex)æ³¨é‡Šæ‰çœ‹ä¸‹æ‰“å°<p>\n\n> æ„Ÿè°¢å¤§å®¶èŠ±è´¹æ—¶é—´æ¥æŸ¥çœ‹è¿™ç¯‡blogï¼Œéœ€è¦ä¸‹è½½demoçš„åŒå­¦è¯·çŒ›æˆ³[Git](https://github.com/PanXianyue/BlogDemo)ã€‚","slug":"YYKit-pthread","published":1,"updated":"2017-01-03T04:28:56.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjiitluey000l55cg71u0ckei"},{"title":"YYKitæºç åˆ†æ---YYCache","date":"2016-07-18T14:47:35.000Z","_content":"[YYCache](https://github.com/ibireme/YYCache)æ˜¯ç”¨äºObjective-Cä¸­ç”¨äºç¼“å­˜çš„ç¬¬ä¸‰æ–¹æ¡†æ¶ã€‚æ­¤æ–‡ä¸»è¦ç”¨æ¥è®²è§£è¯¥æ¡†æ¶çš„å®ç°ç»†èŠ‚ï¼Œæ€§èƒ½åˆ†æã€è®¾è®¡æ€è·¯ibiremeå·²ç»è®²å¾—å¾ˆæ¸…æ¥šäº†ï¼Œæˆ‘è¿™è¾¹å°±ä¸åœ¨åˆ†æäº†ã€‚\n\n<!--more-->\n\n## æ–‡ä»¶ç»“æ„\n![](http://7xq5ax.com1.z0.glb.clouddn.com/yycache-tree.png)\n1. YYCacheï¼šåŒæ—¶å®ç°å†…å­˜ç¼“å­˜å’Œç£ç›˜ç¼“å­˜ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„\n2. YYMemoryCacheï¼šå®ç°å†…å­˜ç¼“å­˜ï¼Œæ‰€æœ‰çš„APIéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸å…¶ä»–ç¼“å­˜æ–¹å¼æ¯”è¾ƒä¸åŒçš„æ˜¯å†…éƒ¨åˆ©ç”¨LRUæ·˜æ±°ç®—æ³•ï¼ˆåé¢ä¼šä»‹ç»ï¼‰æ¥æé«˜æ€§èƒ½\n3. YYDiskCacheï¼šå®ç°ç£ç›˜ç¼“å­˜ï¼Œæ‰€æœ‰çš„APIéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå†…éƒ¨ä¹Ÿé‡‡ç”¨äº†LRUæ·˜æ±°ç®—æ³•ï¼Œä¸»è¦SQLiteå’Œæ–‡ä»¶å­˜å‚¨ä¸¤ç§æ–¹å¼\n4. YYKVStorageï¼šå®ç°ç£ç›˜å­˜å‚¨ï¼Œä¸æ¨èç›´æ¥ä½¿ç”¨è¯¥ç±»ï¼Œè¯¥ç±»ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„\n\n## LRU\nLRU(Least recently usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨)ç®—æ³•ï¼Œæ ¹æ®è®¿é—®çš„å†å²è®°å½•æ¥å¯¹æ•°æ®è¿›è¡Œæ·˜æ±°\n<p>\n![](http://7xq5ax.com1.z0.glb.clouddn.com/lru.png)\n<p>\nç®€å•çš„æ¥è¯´3ç‚¹ï¼š\n\n1. æœ‰æ–°æ•°æ®åŠ å…¥æ—¶æ·»åŠ åˆ°é“¾è¡¨çš„å¤´éƒ¨\n2. æ¯å½“ç¼“å­˜å‘½ä¸­ï¼ˆå³ç¼“å­˜æ•°æ®è¢«è®¿é—®ï¼‰ï¼Œåˆ™å°†æ•°æ®ç§»åˆ°é“¾è¡¨å¤´éƒ¨\n3. å½“é“¾è¡¨æ»¡çš„æ—¶å€™ï¼Œå°†é“¾è¡¨å°¾éƒ¨çš„æ•°æ®ä¸¢å¼ƒ\n\n**åœ¨YYMemoryCacheä¸­ä½¿ç”¨æ¥åŒå‘é“¾è¡¨å’ŒNSDictionaryå®ç°äº†LRUæ·˜æ±°ç®—æ³•ï¼Œåé¢ä¼šä»‹ç»**\n\n## å…³äºé”\nYYCache ä½¿ç”¨åˆ°ä¸¤ç§é”\n\n1. OSSpinLock ï¼šè‡ªæ—‹é”ï¼Œä¸Šä¸€ç¯‡åšå®¢ä¹ŸæåŠåˆ°[pthread_mutex](http://iipanda.com/2016/06/21/YYKit-pthread/) \n2. dispatch_semaphoreï¼šä¿¡å·é‡ï¼Œå½“ä¿¡å·é‡ä¸º1çš„æ—¶å€™å……å½“é”æ¥ç”¨\n\n**å†…å­˜ç¼“å­˜ç”¨çš„pthread_mutexï¼šç”±äºpthread_mutexç›¸å½“äºdo whileå¿™ç­‰ï¼Œç­‰å¾…æ—¶ä¼šæ¶ˆè€—å¤§é‡çš„CPUèµ„æº<br>ç£ç›˜ç¼“å­˜ä½¿ç”¨çš„dispatch_semaphoreï¼šä¼˜åŠ¿åœ¨äºç­‰å¾…æ—¶ä¸ä¼šæ¶ˆè€—CPUèµ„æº**\n> ç®€å•çš„ç§‘æ™®å°±åˆ°è¿™ï¼Œç°åœ¨æ¥å¼€å§‹æºç çš„æ¢ç´¢\n\n## _YYLinkedMap\n```\n@interface _YYLinkedMapNode : NSObject {\n    @package\n    __unsafe_unretained _YYLinkedMapNode *_prev; // retained by dic\n    __unsafe_unretained _YYLinkedMapNode *_next; // retained by dic\n    id _key;\n    id _value;\n    NSUInteger _cost;\n    NSTimeInterval _time;\n}\n@end\n```\n**_YYLinkedMapNode**ï¼šé“¾è¡¨çš„èŠ‚ç‚¹<br>\n\\_prevã€\\_nextï¼šåˆ†åˆ«è¡¨ç¤ºæŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹ã€ä¸‹ä¸€ä¸ªèŠ‚ç‚¹<br>\n\\_keyï¼šç¼“å­˜çš„key<br>\n\\_valueï¼šç¼“å­˜å¯¹è±¡<br>\n\\_costï¼šå†…å­˜æ¶ˆè€—<br>\n\\_timeï¼šç¼“å­˜æ—¶é—´<br>\n\n```\n@interface _YYLinkedMap : NSObject {\n    @package\n    CFMutableDictionaryRef _dic; // do not set object directly\n    NSUInteger _totalCost;\n    NSUInteger _totalCount;\n    _YYLinkedMapNode *_head; // MRUï¼ˆæœ€è¿‘æœ€å¸¸ä½¿ç”¨ç®—æ³•ï¼‰, do not change it directly\n    _YYLinkedMapNode *_tail; // LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•-æ¸…é™¤è¾ƒä¸å¸¸ä½¿ç”¨æ•°æ®ï¼‰, do not change it directly\n    BOOL _releaseOnMainThread;\n    BOOL _releaseAsynchronously;\n}\n\n```\n**_YYLinkedMap**ï¼šé“¾è¡¨<br>\n\\_dicï¼šç”¨æ¥ä¿å­˜èŠ‚ç‚¹<br>\n\\_totalCostï¼šæ€»ç¼“å­˜å¼€é”€<br>\n\\_headã€\\_tailï¼šå¤´èŠ‚ç‚¹ã€å°¾èŠ‚ç‚¹<br>\n\\_releaseOnMainThreadï¼šæ˜¯å¦åœ¨ä¸»çº¿ç¨‹é‡Šæ”¾\\_YYLinkedMapNode<br>\n\\_releaseAsynchronouslyï¼šæ˜¯å¦å¼‚æ­¥é‡Šæ”¾\\_YYLinkedMapNode<br>\n\n\n**åŒå‘é“¾è¡¨**<br>\n![](http://7xq5ax.com1.z0.glb.clouddn.com/LinkedMap@1x.png)\n\n1. æ’å…¥èŠ‚ç‚¹åˆ°å¤´éƒ¨\n2. å°†é™¤ä¸¤è¾¹çš„èŠ‚ç‚¹ç§»åˆ°å¤´éƒ¨\n3. ç§»é™¤é™¤ä¸¤è¾¹çš„èŠ‚ç‚¹\n4. ç§»é™¤å°¾éƒ¨èŠ‚ç‚¹\n5. ç§»é™¤æ‰€æœ‰èŠ‚ç‚¹\n\nçœ‹ä¸‹ç§»é™¤æ‰€æœ‰èŠ‚ç‚¹çš„ä»£ç ï¼š\n\n```\n- (void)removeAll {\n    _totalCost = 0;\n    _totalCount = 0;\n    _head = nil;\n    _tail = nil;\n    if (CFDictionaryGetCount(_dic) > 0) {\n        CFMutableDictionaryRef holder = _dic;\n        _dic = CFDictionaryCreateMutable(CFAllocatorGetDefault(), 0, &kCFTypeDictionaryKeyCallBacks, &kCFTypeDictionaryValueCallBacks);\n        \n        if (_releaseAsynchronously) {\n            dispatch_queue_t queue = _releaseOnMainThread ? dispatch_get_main_queue() : YYMemoryCacheGetReleaseQueue();\n            dispatch_async(queue, ^{\n                CFRelease(holder); // hold and release in specified queue\n            });\n        } else if (_releaseOnMainThread && !pthread_main_np()) {\n            dispatch_async(dispatch_get_main_queue(), ^{\n                CFRelease(holder); // hold and release in specified queue\n            });\n        } else {\n            CFRelease(holder);\n        }\n    }\n}\n\n\n```\n\n\n\nè¿™è¾¹é€šè¿‡åŒå‘é“¾è¡¨æ¥å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œå’ŒNSDictionaryå®ç°äº†LRUæ·˜æ±°ç®—æ³•ã€‚æ—¶é—´å¤æ‚åº¦0ï¼ˆ1ï¼‰ï¼Œ5ç§æ“ä½œåŸºæœ¬ä¸Šéƒ½æ˜¯å¯¹å¤´å°¾èŠ‚ç‚¹å’Œé“¾è¡¨èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹å’Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œæ“ä½œã€‚\n\n\n## YYMemoryCache\nè¿™è¾¹ä»‹ç»ä¸¤ä¸ªä¸»è¦çš„æ“ä½œï¼šæ·»åŠ ç¼“å­˜ï¼ŒæŸ¥æ‰¾ç¼“å­˜<p>\n\n- **æ·»åŠ ç¼“å­˜**\n\n```\n- (void)setObject:(id)object forKey:(id)key withCost:(NSUInteger)cost {\n    if (!key) return;\n    if (!object) {\n        // ç¼“å­˜å¯¹è±¡ä¸ºnilï¼Œç›´æ¥ç§»é™¤\n        [self removeObjectForKey:key];\n        return;\n    }\n    // ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ•°æ®æ“ä½œå‰è¿›è¡ŒåŠ é”\n    pthread_mutex_lock(&_lock);\n    // æŸ¥æ‰¾ç¼“å­˜\n    _YYLinkedMapNode *node = CFDictionaryGetValue(_lru->_dic, (__bridge const void *)(key));\n    // å½“å‰æ—¶é—´\n    NSTimeInterval now = CACurrentMediaTime();\n    if (node) {\n        // ç¼“å­˜å¯¹è±¡å·²å­˜åœ¨ï¼Œæ›´æ–°æ•°æ®ï¼Œå¹¶ç§»åˆ°æ ˆé¡¶\n        _lru->_totalCost -= node->_cost;\n        _lru->_totalCost += cost;\n        node->_cost = cost;\n        node->_time = now;\n        node->_value = object;\n        [_lru bringNodeToHead:node];\n    } else {\n        // ç¼“å­˜å¯¹è±¡ä¸å­˜åœ¨ï¼Œæ·»åŠ æ•°æ®ï¼Œå¹¶ç§»åˆ°æ ˆé¡¶\n        node = [_YYLinkedMapNode new];\n        node->_cost = cost;\n        node->_time = now;\n        node->_key = key;\n        node->_value = object;\n        [_lru insertNodeAtHead:node];\n    }\n    // åˆ¤æ–­å½“å‰çš„ç¼“å­˜è¿›è¡Œæ˜¯å¦è¶…å‡ºäº†è®¾å®šå€¼ï¼Œè‹¥è¶…å‡ºåˆ™è¿›è¡Œæ•´ç†\n    if (_lru->_totalCost > _costLimit) {\n        dispatch_async(_queue, ^{\n            [self trimToCost:_costLimit];\n        });\n    }\n    \n    // æ¯æ¬¡æ·»åŠ æ•°æ®ä»…æœ‰ä¸€ä¸ªï¼Œæ•°é‡ä¸Šè¶…å‡ºæ—¶ï¼Œç›´æ¥ç§»é™¤å°¾éƒ¨é‚£ä¸ªobjectå³å¯\n    if (_lru->_totalCount > _countLimit) {\n        _YYLinkedMapNode *node = [_lru removeTailNode];\n        if (_lru->_releaseAsynchronously) {\n            dispatch_queue_t queue = _lru->_releaseOnMainThread ? dispatch_get_main_queue() : YYMemoryCacheGetReleaseQueue();\n            dispatch_async(queue, ^{\n                [node class]; //hold and release in queue\n            });\n        } else if (_lru->_releaseOnMainThread && !pthread_main_np()) {\n            dispatch_async(dispatch_get_main_queue(), ^{\n                [node class]; //hold and release in queue\n            });\n        }\n    }\n    // æ“ä½œç»“æŸï¼Œè§£é”\n    pthread_mutex_unlock(&_lock);\n}\n\n```\n\n- **å¼‚æ­¥çº¿ç¨‹é‡Šæ”¾**\n![](http://7xq5ax.com1.z0.glb.clouddn.com/%E5%BC%82%E6%AD%A5%E9%87%8A%E6%94%BE.png)\né‡Œé¢å¾ˆå¤šéƒ½ç”¨åˆ°ç±»ä¼¼çš„æ–¹æ³•ï¼Œå°†ä¸€ä¸ªå¯¹è±¡åœ¨å¼‚æ­¥çº¿ç¨‹ä¸­é‡Šæ”¾ï¼Œæ¥åˆ†æä¸‹ï¼š<br>\n\n\n\t\t- p\n\t\t1. é¦–å…ˆé€šè¿‡nodeæ¥å¯¹å…¶è¿›è¡ŒæŒæœ‰ï¼Œä»¥è‡³äºä¸ä¼šåœ¨æ–¹æ³•è°ƒç”¨ç»“æŸçš„æ—¶å€™è¢«é”€æ¯\n\t\t2. æˆ‘è¦è¦åœ¨å…¶ä»–çº¿ç¨‹ä¸­è¿›è¡Œé”€æ¯ï¼Œæ‰€ä»¥å°†é”€æ¯æ“ä½œæ”¾åœ¨blockä¸­ï¼Œblockå°±ä¼šå¯¹å…¶è¿›è¡ŒæŒæœ‰\n\t\t3. è¿™è¾¹åœ¨blockä¸­éšä¾¿è°ƒç”¨äº†ä¸ªæ–¹æ³•ï¼Œä¿è¯ç¼–è¯‘å™¨ä¸ä¼šä¼˜åŒ–æ‰è¿™ä¸ªæ“ä½œ\n\t\t4. å½“blockç»“æŸåï¼Œnodeæ²¡æœ‰è¢«æŒæœ‰çš„æ—¶å€™ï¼Œå°±ä¼šåœ¨å½“å‰çº¿ç¨‹è¢«releaseæ‰äº†\n\n\n\n- **æ·»åŠ ç¼“å­˜**\n\n```\n// è¿™è¾¹ä»memoryä¸­å–æ•°æ®æ—¶ï¼Œæ ¹æ®LRUåŸåˆ™ï¼Œå°†æœ€æ–°å–å‡ºçš„objectæ”¾åˆ°æ ˆå¤´\n- (id)objectForKey:(id)key {\n    if (!key) return nil;\n    pthread_mutex_lock(&_lock);\n    _YYLinkedMapNode *node = CFDictionaryGetValue(_lru->_dic, (__bridge const void *)(key));\n    if (node) {\n        node->_time = CACurrentMediaTime();\n        [_lru bringNodeToHead:node];\n    }\n    pthread_mutex_unlock(&_lock);\n    return node ? node->_value : nil;\n}\n\n```\n\n## YYKVStorage\n\nè¯¥æ–‡ä»¶ä¸»è¦ä»¥ä¸¤ç§æ–¹å¼æ¥å®ç°ç£ç›˜å­˜å‚¨ï¼šSQLiteã€Fileï¼Œä½¿ç”¨ä¸¤ç§æ–¹å¼æ··åˆè¿›è¡Œå­˜å‚¨ä¸»è¦ä¸ºäº†æé«˜è¯»å†™æ•ˆç‡ã€‚å†™å…¥æ•°æ®æ—¶ï¼ŒSQLiteè¦æ¯”æ–‡ä»¶çš„æ–¹å¼æ›´å¿«ï¼›è¯»å–æ•°æ®çš„é€Ÿåº¦ä¸»è¦å–å†³äºæ–‡ä»¶çš„å¤§å°ã€‚æ®æµ‹è¯•ï¼Œåœ¨iPhone6ä¸­ï¼Œå½“æ–‡ä»¶å¤§å°è¶…è¿‡20kbæ—¶ï¼ŒFileè¦æ¯”SQLiteå¿«çš„å¤šã€‚æ‰€ä»¥å½“å¤§æ–‡ä»¶å­˜å‚¨æ—¶å»ºè®®ç”¨Fileçš„æ–¹å¼ï¼Œå°æ–‡ä»¶æ›´é€‚åˆç”¨SQLiteã€‚<p>\nä¸‹è¾¹åˆ†åˆ«å¯¹Saveã€Removeã€Getåˆ†åˆ«è¿›è¡Œåˆ†æ\n\n\n- **Save**\n\n```\n- (BOOL)saveItemWithKey:(NSString *)key value:(NSData *)value filename:(NSString *)filename extendedData:(NSData *)extendedData {\n    // æ¡ä»¶ä¸ç¬¦åˆ\n    if (key.length == 0 || value.length == 0) return NO;\n    if (_type == YYKVStorageTypeFile && filename.length == 0) {\n        return NO;\n    }\n    \n    if (filename.length) {    // filenameå­˜åœ¨ SQLite Fileä¸¤ç§æ–¹å¼å¹¶è¡Œ\n        // ç”¨æ–‡ä»¶è¿›è¡Œå­˜å‚¨\n        if (![self _fileWriteWithName:filename data:value]) {\n            return NO;\n        }\n        // ç”¨SQLiteè¿›è¡Œå­˜å‚¨\n        if (![self _dbSaveWithKey:key value:value fileName:filename extendedData:extendedData]) {\n            // å½“ä½¿ç”¨SQLiteæ–¹å¼å­˜å‚¨å¤±è´¥æ—¶ï¼Œåˆ é™¤æœ¬åœ°æ–‡ä»¶å­˜å‚¨\n            [self _fileDeleteWithName:filename];\n            return NO;\n        }\n        return YES;\n    } else {               // filenameä¸å­˜åœ¨ SQLite\n        if (_type != YYKVStorageTypeSQLite) {\n            // è¿™è¾¹å»åˆ°filenameåï¼Œåˆ é™¤filenameå¯¹åº”çš„fileæ–‡ä»¶\n            NSString *filename = [self _dbGetFilenameWithKey:key];\n            if (filename) {\n                [self _fileDeleteWithName:filename];\n            }\n        }\n        // SQLite è¿›è¡Œå­˜å‚¨\n        return [self _dbSaveWithKey:key value:value fileName:nil extendedData:extendedData];\n    }\n}\n\n\n```\n\n- **Remove**\n\n```\n- (BOOL)removeItemForKey:(NSString *)key {\n    if (key.length == 0) return NO;\n    switch (_type) {\n        case YYKVStorageTypeSQLite: {\n            // åˆ é™¤SQLiteæ–‡ä»¶\n            return [self _dbDeleteItemWithKey:key];\n        } break;\n        case YYKVStorageTypeFile:\n        case YYKVStorageTypeMixed: {\n            // è·å–filename\n            NSString *filename = [self _dbGetFilenameWithKey:key];\n            if (filename) {\n                // åˆ é™¤filenameå¯¹çš„file\n                [self _fileDeleteWithName:filename];\n            }\n            // åˆ é™¤SQLiteæ–‡ä»¶\n            return [self _dbDeleteItemWithKey:key];\n        } break;\n        default: return NO;\n    }\n}\n\n```\n\n- **Get**\n\n```\n- (NSData *)getItemValueForKey:(NSString *)key {\n    if (key.length == 0) return nil;\n    NSData *value = nil;\n    switch (_type) {\n        case YYKVStorageTypeFile: { //File\n            NSString *filename = [self _dbGetFilenameWithKey:key];\n            if (filename) {\n                // æ ¹æ®filenameè·å–File\n                value = [self _fileReadWithName:filename];\n                if (!value) {\n                    // å½“valueä¸å­˜åœ¨ï¼Œç”¨å¯¹åº”çš„keyåˆ é™¤SQLiteæ–‡ä»¶\n                    [self _dbDeleteItemWithKey:key];\n                    value = nil;\n                }\n            }\n        } break;\n        case YYKVStorageTypeSQLite: {\n            // SQLite æ–¹å¼è·å–\n            value = [self _dbGetValueWithKey:key];\n        } break;\n        case YYKVStorageTypeMixed: {\n            NSString *filename = [self _dbGetFilenameWithKey:key];\n            // filename å­˜åœ¨æ–‡ä»¶è·å–ï¼Œä¸å­˜åœ¨SQLiteæ–¹å¼è·å–\n            if (filename) {\n                value = [self _fileReadWithName:filename];\n                if (!value) {\n                    [self _dbDeleteItemWithKey:key];\n                    value = nil;\n                }\n            } else {\n                value = [self _dbGetValueWithKey:key];\n            }\n        } break;\n    }\n    if (value) {\n        // æ›´æ–°æ–‡ä»¶æ“ä½œæ—¶é—´\n        [self _dbUpdateAccessTimeWithKey:key];\n    }\n    return value;\n}\n\n```\n\nFileæ–¹å¼ä¸»è¦ä½¿ç”¨çš„writeToFileè¿›è¡Œå­˜å‚¨ï¼ŒSQLteç›´æ¥ä½¿ç”¨çš„sqlite3æ¥å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œå…·ä½“æ•°æ®åº“ç›¸å…³çš„æ“ä½œè¿™è¾¹å°±ä¸åœ¨è¿›è¡Œåˆ†æäº†ï¼Œæ„Ÿå…´è¶£çš„è‡ªå·±å¯ä»¥é˜…è¯»ä¸‹\n\n## YYDiskCache\n\nYYDiskCacheæ˜¯å¯¹YYKVStorageè¿›è¡Œçš„ä¸€æ¬¡å°è£…ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™è¾¹ä½¿ç”¨çš„æ˜¯dispatch_semaphore_signalæ¥ç¡®ä¿çº¿ç¨‹çš„å®‰å…¨ã€‚å¦å¤–ä»–ç»“åˆLRUç®—æ³•ï¼Œæ ¹æ®æ–‡ä»¶çš„å¤§å°è‡ªåŠ¨é€‰æ‹©å­˜å‚¨æ–¹å¼æ¥è¾¾åˆ°æ›´å¥½çš„æ€§èƒ½ã€‚\n\n```\n- (instancetype)initWithPath:(NSString *)path\n             inlineThreshold:(NSUInteger)threshold {\n    self = [super init];\n    if (!self) return nil;\n    \n    // è·å–ç¼“å­˜çš„ YYDiskCache\n    YYDiskCache *globalCache = _YYDiskCacheGetGlobal(path);\n    if (globalCache) return globalCache;\n    \n    // ç¡®å®šå­˜å‚¨çš„æ–¹å¼\n    YYKVStorageType type;\n    if (threshold == 0) {\n        type = YYKVStorageTypeFile;\n    } else if (threshold == NSUIntegerMax) {\n        type = YYKVStorageTypeSQLite;\n    } else {\n        type = YYKVStorageTypeMixed;\n    }\n    \n    // åˆå§‹åŒ– YYKVStorage\n    YYKVStorage *kv = [[YYKVStorage alloc] initWithPath:path type:type];\n    if (!kv) return nil;\n    \n    // åˆå§‹åŒ–æ•°æ®\n    _kv = kv;\n    _path = path;\n    _lock = dispatch_semaphore_create(1);\n    _queue = dispatch_queue_create(\"com.ibireme.cache.disk\", DISPATCH_QUEUE_CONCURRENT);\n    _inlineThreshold = threshold;\n    _countLimit = NSUIntegerMax;\n    _costLimit = NSUIntegerMax;\n    _ageLimit = DBL_MAX;\n    _freeDiskSpaceLimit = 0;\n    _autoTrimInterval = 60;\n    \n    // é€’å½’çš„å»æ•´ç†æ–‡ä»¶\n    [self _trimRecursively];\n    // å¯¹å½“å‰å¯¹è±¡è¿›è¡Œç¼“å­˜\n    _YYDiskCacheSetGlobal(self);\n    \n    // é€šçŸ¥ APPå³å°†è¢«æ€æ­»æ—¶\n    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(_appWillBeTerminated) name:UIApplicationWillTerminateNotification object:nil];\n    return self;\n}\n\n```\n\nå…¶ä»–çš„ä¸€äº›æ“ä½œåŸºæœ¬ä¸Šéƒ½æ˜¯å¯¹YYKVStorageçš„ä¸€äº›å°è£…ï¼Œè¿™è¾¹å°±ä¸ä¸€ä¸€åˆ†æäº†ã€‚\n\n## å‚è€ƒæ–‡çŒ®\n\n1. http://blog.ibireme.com/2015/10/26/yycache/\n2. http://blog.csdn.net/yunhua_lee/article/details/7599671\n","source":"_posts/YYCache-analyzing.md","raw":"---\ntitle: YYKitæºç åˆ†æ---YYCache\ndate: 2016-07-18 22:47:35\ncategories: iOS\ntags: [YYKit, YYCache]\n---\n[YYCache](https://github.com/ibireme/YYCache)æ˜¯ç”¨äºObjective-Cä¸­ç”¨äºç¼“å­˜çš„ç¬¬ä¸‰æ–¹æ¡†æ¶ã€‚æ­¤æ–‡ä¸»è¦ç”¨æ¥è®²è§£è¯¥æ¡†æ¶çš„å®ç°ç»†èŠ‚ï¼Œæ€§èƒ½åˆ†æã€è®¾è®¡æ€è·¯ibiremeå·²ç»è®²å¾—å¾ˆæ¸…æ¥šäº†ï¼Œæˆ‘è¿™è¾¹å°±ä¸åœ¨åˆ†æäº†ã€‚\n\n<!--more-->\n\n## æ–‡ä»¶ç»“æ„\n![](http://7xq5ax.com1.z0.glb.clouddn.com/yycache-tree.png)\n1. YYCacheï¼šåŒæ—¶å®ç°å†…å­˜ç¼“å­˜å’Œç£ç›˜ç¼“å­˜ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„\n2. YYMemoryCacheï¼šå®ç°å†…å­˜ç¼“å­˜ï¼Œæ‰€æœ‰çš„APIéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸å…¶ä»–ç¼“å­˜æ–¹å¼æ¯”è¾ƒä¸åŒçš„æ˜¯å†…éƒ¨åˆ©ç”¨LRUæ·˜æ±°ç®—æ³•ï¼ˆåé¢ä¼šä»‹ç»ï¼‰æ¥æé«˜æ€§èƒ½\n3. YYDiskCacheï¼šå®ç°ç£ç›˜ç¼“å­˜ï¼Œæ‰€æœ‰çš„APIéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå†…éƒ¨ä¹Ÿé‡‡ç”¨äº†LRUæ·˜æ±°ç®—æ³•ï¼Œä¸»è¦SQLiteå’Œæ–‡ä»¶å­˜å‚¨ä¸¤ç§æ–¹å¼\n4. YYKVStorageï¼šå®ç°ç£ç›˜å­˜å‚¨ï¼Œä¸æ¨èç›´æ¥ä½¿ç”¨è¯¥ç±»ï¼Œè¯¥ç±»ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„\n\n## LRU\nLRU(Least recently usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨)ç®—æ³•ï¼Œæ ¹æ®è®¿é—®çš„å†å²è®°å½•æ¥å¯¹æ•°æ®è¿›è¡Œæ·˜æ±°\n<p>\n![](http://7xq5ax.com1.z0.glb.clouddn.com/lru.png)\n<p>\nç®€å•çš„æ¥è¯´3ç‚¹ï¼š\n\n1. æœ‰æ–°æ•°æ®åŠ å…¥æ—¶æ·»åŠ åˆ°é“¾è¡¨çš„å¤´éƒ¨\n2. æ¯å½“ç¼“å­˜å‘½ä¸­ï¼ˆå³ç¼“å­˜æ•°æ®è¢«è®¿é—®ï¼‰ï¼Œåˆ™å°†æ•°æ®ç§»åˆ°é“¾è¡¨å¤´éƒ¨\n3. å½“é“¾è¡¨æ»¡çš„æ—¶å€™ï¼Œå°†é“¾è¡¨å°¾éƒ¨çš„æ•°æ®ä¸¢å¼ƒ\n\n**åœ¨YYMemoryCacheä¸­ä½¿ç”¨æ¥åŒå‘é“¾è¡¨å’ŒNSDictionaryå®ç°äº†LRUæ·˜æ±°ç®—æ³•ï¼Œåé¢ä¼šä»‹ç»**\n\n## å…³äºé”\nYYCache ä½¿ç”¨åˆ°ä¸¤ç§é”\n\n1. OSSpinLock ï¼šè‡ªæ—‹é”ï¼Œä¸Šä¸€ç¯‡åšå®¢ä¹ŸæåŠåˆ°[pthread_mutex](http://iipanda.com/2016/06/21/YYKit-pthread/) \n2. dispatch_semaphoreï¼šä¿¡å·é‡ï¼Œå½“ä¿¡å·é‡ä¸º1çš„æ—¶å€™å……å½“é”æ¥ç”¨\n\n**å†…å­˜ç¼“å­˜ç”¨çš„pthread_mutexï¼šç”±äºpthread_mutexç›¸å½“äºdo whileå¿™ç­‰ï¼Œç­‰å¾…æ—¶ä¼šæ¶ˆè€—å¤§é‡çš„CPUèµ„æº<br>ç£ç›˜ç¼“å­˜ä½¿ç”¨çš„dispatch_semaphoreï¼šä¼˜åŠ¿åœ¨äºç­‰å¾…æ—¶ä¸ä¼šæ¶ˆè€—CPUèµ„æº**\n> ç®€å•çš„ç§‘æ™®å°±åˆ°è¿™ï¼Œç°åœ¨æ¥å¼€å§‹æºç çš„æ¢ç´¢\n\n## _YYLinkedMap\n```\n@interface _YYLinkedMapNode : NSObject {\n    @package\n    __unsafe_unretained _YYLinkedMapNode *_prev; // retained by dic\n    __unsafe_unretained _YYLinkedMapNode *_next; // retained by dic\n    id _key;\n    id _value;\n    NSUInteger _cost;\n    NSTimeInterval _time;\n}\n@end\n```\n**_YYLinkedMapNode**ï¼šé“¾è¡¨çš„èŠ‚ç‚¹<br>\n\\_prevã€\\_nextï¼šåˆ†åˆ«è¡¨ç¤ºæŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹ã€ä¸‹ä¸€ä¸ªèŠ‚ç‚¹<br>\n\\_keyï¼šç¼“å­˜çš„key<br>\n\\_valueï¼šç¼“å­˜å¯¹è±¡<br>\n\\_costï¼šå†…å­˜æ¶ˆè€—<br>\n\\_timeï¼šç¼“å­˜æ—¶é—´<br>\n\n```\n@interface _YYLinkedMap : NSObject {\n    @package\n    CFMutableDictionaryRef _dic; // do not set object directly\n    NSUInteger _totalCost;\n    NSUInteger _totalCount;\n    _YYLinkedMapNode *_head; // MRUï¼ˆæœ€è¿‘æœ€å¸¸ä½¿ç”¨ç®—æ³•ï¼‰, do not change it directly\n    _YYLinkedMapNode *_tail; // LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•-æ¸…é™¤è¾ƒä¸å¸¸ä½¿ç”¨æ•°æ®ï¼‰, do not change it directly\n    BOOL _releaseOnMainThread;\n    BOOL _releaseAsynchronously;\n}\n\n```\n**_YYLinkedMap**ï¼šé“¾è¡¨<br>\n\\_dicï¼šç”¨æ¥ä¿å­˜èŠ‚ç‚¹<br>\n\\_totalCostï¼šæ€»ç¼“å­˜å¼€é”€<br>\n\\_headã€\\_tailï¼šå¤´èŠ‚ç‚¹ã€å°¾èŠ‚ç‚¹<br>\n\\_releaseOnMainThreadï¼šæ˜¯å¦åœ¨ä¸»çº¿ç¨‹é‡Šæ”¾\\_YYLinkedMapNode<br>\n\\_releaseAsynchronouslyï¼šæ˜¯å¦å¼‚æ­¥é‡Šæ”¾\\_YYLinkedMapNode<br>\n\n\n**åŒå‘é“¾è¡¨**<br>\n![](http://7xq5ax.com1.z0.glb.clouddn.com/LinkedMap@1x.png)\n\n1. æ’å…¥èŠ‚ç‚¹åˆ°å¤´éƒ¨\n2. å°†é™¤ä¸¤è¾¹çš„èŠ‚ç‚¹ç§»åˆ°å¤´éƒ¨\n3. ç§»é™¤é™¤ä¸¤è¾¹çš„èŠ‚ç‚¹\n4. ç§»é™¤å°¾éƒ¨èŠ‚ç‚¹\n5. ç§»é™¤æ‰€æœ‰èŠ‚ç‚¹\n\nçœ‹ä¸‹ç§»é™¤æ‰€æœ‰èŠ‚ç‚¹çš„ä»£ç ï¼š\n\n```\n- (void)removeAll {\n    _totalCost = 0;\n    _totalCount = 0;\n    _head = nil;\n    _tail = nil;\n    if (CFDictionaryGetCount(_dic) > 0) {\n        CFMutableDictionaryRef holder = _dic;\n        _dic = CFDictionaryCreateMutable(CFAllocatorGetDefault(), 0, &kCFTypeDictionaryKeyCallBacks, &kCFTypeDictionaryValueCallBacks);\n        \n        if (_releaseAsynchronously) {\n            dispatch_queue_t queue = _releaseOnMainThread ? dispatch_get_main_queue() : YYMemoryCacheGetReleaseQueue();\n            dispatch_async(queue, ^{\n                CFRelease(holder); // hold and release in specified queue\n            });\n        } else if (_releaseOnMainThread && !pthread_main_np()) {\n            dispatch_async(dispatch_get_main_queue(), ^{\n                CFRelease(holder); // hold and release in specified queue\n            });\n        } else {\n            CFRelease(holder);\n        }\n    }\n}\n\n\n```\n\n\n\nè¿™è¾¹é€šè¿‡åŒå‘é“¾è¡¨æ¥å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œå’ŒNSDictionaryå®ç°äº†LRUæ·˜æ±°ç®—æ³•ã€‚æ—¶é—´å¤æ‚åº¦0ï¼ˆ1ï¼‰ï¼Œ5ç§æ“ä½œåŸºæœ¬ä¸Šéƒ½æ˜¯å¯¹å¤´å°¾èŠ‚ç‚¹å’Œé“¾è¡¨èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹å’Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œæ“ä½œã€‚\n\n\n## YYMemoryCache\nè¿™è¾¹ä»‹ç»ä¸¤ä¸ªä¸»è¦çš„æ“ä½œï¼šæ·»åŠ ç¼“å­˜ï¼ŒæŸ¥æ‰¾ç¼“å­˜<p>\n\n- **æ·»åŠ ç¼“å­˜**\n\n```\n- (void)setObject:(id)object forKey:(id)key withCost:(NSUInteger)cost {\n    if (!key) return;\n    if (!object) {\n        // ç¼“å­˜å¯¹è±¡ä¸ºnilï¼Œç›´æ¥ç§»é™¤\n        [self removeObjectForKey:key];\n        return;\n    }\n    // ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ•°æ®æ“ä½œå‰è¿›è¡ŒåŠ é”\n    pthread_mutex_lock(&_lock);\n    // æŸ¥æ‰¾ç¼“å­˜\n    _YYLinkedMapNode *node = CFDictionaryGetValue(_lru->_dic, (__bridge const void *)(key));\n    // å½“å‰æ—¶é—´\n    NSTimeInterval now = CACurrentMediaTime();\n    if (node) {\n        // ç¼“å­˜å¯¹è±¡å·²å­˜åœ¨ï¼Œæ›´æ–°æ•°æ®ï¼Œå¹¶ç§»åˆ°æ ˆé¡¶\n        _lru->_totalCost -= node->_cost;\n        _lru->_totalCost += cost;\n        node->_cost = cost;\n        node->_time = now;\n        node->_value = object;\n        [_lru bringNodeToHead:node];\n    } else {\n        // ç¼“å­˜å¯¹è±¡ä¸å­˜åœ¨ï¼Œæ·»åŠ æ•°æ®ï¼Œå¹¶ç§»åˆ°æ ˆé¡¶\n        node = [_YYLinkedMapNode new];\n        node->_cost = cost;\n        node->_time = now;\n        node->_key = key;\n        node->_value = object;\n        [_lru insertNodeAtHead:node];\n    }\n    // åˆ¤æ–­å½“å‰çš„ç¼“å­˜è¿›è¡Œæ˜¯å¦è¶…å‡ºäº†è®¾å®šå€¼ï¼Œè‹¥è¶…å‡ºåˆ™è¿›è¡Œæ•´ç†\n    if (_lru->_totalCost > _costLimit) {\n        dispatch_async(_queue, ^{\n            [self trimToCost:_costLimit];\n        });\n    }\n    \n    // æ¯æ¬¡æ·»åŠ æ•°æ®ä»…æœ‰ä¸€ä¸ªï¼Œæ•°é‡ä¸Šè¶…å‡ºæ—¶ï¼Œç›´æ¥ç§»é™¤å°¾éƒ¨é‚£ä¸ªobjectå³å¯\n    if (_lru->_totalCount > _countLimit) {\n        _YYLinkedMapNode *node = [_lru removeTailNode];\n        if (_lru->_releaseAsynchronously) {\n            dispatch_queue_t queue = _lru->_releaseOnMainThread ? dispatch_get_main_queue() : YYMemoryCacheGetReleaseQueue();\n            dispatch_async(queue, ^{\n                [node class]; //hold and release in queue\n            });\n        } else if (_lru->_releaseOnMainThread && !pthread_main_np()) {\n            dispatch_async(dispatch_get_main_queue(), ^{\n                [node class]; //hold and release in queue\n            });\n        }\n    }\n    // æ“ä½œç»“æŸï¼Œè§£é”\n    pthread_mutex_unlock(&_lock);\n}\n\n```\n\n- **å¼‚æ­¥çº¿ç¨‹é‡Šæ”¾**\n![](http://7xq5ax.com1.z0.glb.clouddn.com/%E5%BC%82%E6%AD%A5%E9%87%8A%E6%94%BE.png)\né‡Œé¢å¾ˆå¤šéƒ½ç”¨åˆ°ç±»ä¼¼çš„æ–¹æ³•ï¼Œå°†ä¸€ä¸ªå¯¹è±¡åœ¨å¼‚æ­¥çº¿ç¨‹ä¸­é‡Šæ”¾ï¼Œæ¥åˆ†æä¸‹ï¼š<br>\n\n\n\t\t- p\n\t\t1. é¦–å…ˆé€šè¿‡nodeæ¥å¯¹å…¶è¿›è¡ŒæŒæœ‰ï¼Œä»¥è‡³äºä¸ä¼šåœ¨æ–¹æ³•è°ƒç”¨ç»“æŸçš„æ—¶å€™è¢«é”€æ¯\n\t\t2. æˆ‘è¦è¦åœ¨å…¶ä»–çº¿ç¨‹ä¸­è¿›è¡Œé”€æ¯ï¼Œæ‰€ä»¥å°†é”€æ¯æ“ä½œæ”¾åœ¨blockä¸­ï¼Œblockå°±ä¼šå¯¹å…¶è¿›è¡ŒæŒæœ‰\n\t\t3. è¿™è¾¹åœ¨blockä¸­éšä¾¿è°ƒç”¨äº†ä¸ªæ–¹æ³•ï¼Œä¿è¯ç¼–è¯‘å™¨ä¸ä¼šä¼˜åŒ–æ‰è¿™ä¸ªæ“ä½œ\n\t\t4. å½“blockç»“æŸåï¼Œnodeæ²¡æœ‰è¢«æŒæœ‰çš„æ—¶å€™ï¼Œå°±ä¼šåœ¨å½“å‰çº¿ç¨‹è¢«releaseæ‰äº†\n\n\n\n- **æ·»åŠ ç¼“å­˜**\n\n```\n// è¿™è¾¹ä»memoryä¸­å–æ•°æ®æ—¶ï¼Œæ ¹æ®LRUåŸåˆ™ï¼Œå°†æœ€æ–°å–å‡ºçš„objectæ”¾åˆ°æ ˆå¤´\n- (id)objectForKey:(id)key {\n    if (!key) return nil;\n    pthread_mutex_lock(&_lock);\n    _YYLinkedMapNode *node = CFDictionaryGetValue(_lru->_dic, (__bridge const void *)(key));\n    if (node) {\n        node->_time = CACurrentMediaTime();\n        [_lru bringNodeToHead:node];\n    }\n    pthread_mutex_unlock(&_lock);\n    return node ? node->_value : nil;\n}\n\n```\n\n## YYKVStorage\n\nè¯¥æ–‡ä»¶ä¸»è¦ä»¥ä¸¤ç§æ–¹å¼æ¥å®ç°ç£ç›˜å­˜å‚¨ï¼šSQLiteã€Fileï¼Œä½¿ç”¨ä¸¤ç§æ–¹å¼æ··åˆè¿›è¡Œå­˜å‚¨ä¸»è¦ä¸ºäº†æé«˜è¯»å†™æ•ˆç‡ã€‚å†™å…¥æ•°æ®æ—¶ï¼ŒSQLiteè¦æ¯”æ–‡ä»¶çš„æ–¹å¼æ›´å¿«ï¼›è¯»å–æ•°æ®çš„é€Ÿåº¦ä¸»è¦å–å†³äºæ–‡ä»¶çš„å¤§å°ã€‚æ®æµ‹è¯•ï¼Œåœ¨iPhone6ä¸­ï¼Œå½“æ–‡ä»¶å¤§å°è¶…è¿‡20kbæ—¶ï¼ŒFileè¦æ¯”SQLiteå¿«çš„å¤šã€‚æ‰€ä»¥å½“å¤§æ–‡ä»¶å­˜å‚¨æ—¶å»ºè®®ç”¨Fileçš„æ–¹å¼ï¼Œå°æ–‡ä»¶æ›´é€‚åˆç”¨SQLiteã€‚<p>\nä¸‹è¾¹åˆ†åˆ«å¯¹Saveã€Removeã€Getåˆ†åˆ«è¿›è¡Œåˆ†æ\n\n\n- **Save**\n\n```\n- (BOOL)saveItemWithKey:(NSString *)key value:(NSData *)value filename:(NSString *)filename extendedData:(NSData *)extendedData {\n    // æ¡ä»¶ä¸ç¬¦åˆ\n    if (key.length == 0 || value.length == 0) return NO;\n    if (_type == YYKVStorageTypeFile && filename.length == 0) {\n        return NO;\n    }\n    \n    if (filename.length) {    // filenameå­˜åœ¨ SQLite Fileä¸¤ç§æ–¹å¼å¹¶è¡Œ\n        // ç”¨æ–‡ä»¶è¿›è¡Œå­˜å‚¨\n        if (![self _fileWriteWithName:filename data:value]) {\n            return NO;\n        }\n        // ç”¨SQLiteè¿›è¡Œå­˜å‚¨\n        if (![self _dbSaveWithKey:key value:value fileName:filename extendedData:extendedData]) {\n            // å½“ä½¿ç”¨SQLiteæ–¹å¼å­˜å‚¨å¤±è´¥æ—¶ï¼Œåˆ é™¤æœ¬åœ°æ–‡ä»¶å­˜å‚¨\n            [self _fileDeleteWithName:filename];\n            return NO;\n        }\n        return YES;\n    } else {               // filenameä¸å­˜åœ¨ SQLite\n        if (_type != YYKVStorageTypeSQLite) {\n            // è¿™è¾¹å»åˆ°filenameåï¼Œåˆ é™¤filenameå¯¹åº”çš„fileæ–‡ä»¶\n            NSString *filename = [self _dbGetFilenameWithKey:key];\n            if (filename) {\n                [self _fileDeleteWithName:filename];\n            }\n        }\n        // SQLite è¿›è¡Œå­˜å‚¨\n        return [self _dbSaveWithKey:key value:value fileName:nil extendedData:extendedData];\n    }\n}\n\n\n```\n\n- **Remove**\n\n```\n- (BOOL)removeItemForKey:(NSString *)key {\n    if (key.length == 0) return NO;\n    switch (_type) {\n        case YYKVStorageTypeSQLite: {\n            // åˆ é™¤SQLiteæ–‡ä»¶\n            return [self _dbDeleteItemWithKey:key];\n        } break;\n        case YYKVStorageTypeFile:\n        case YYKVStorageTypeMixed: {\n            // è·å–filename\n            NSString *filename = [self _dbGetFilenameWithKey:key];\n            if (filename) {\n                // åˆ é™¤filenameå¯¹çš„file\n                [self _fileDeleteWithName:filename];\n            }\n            // åˆ é™¤SQLiteæ–‡ä»¶\n            return [self _dbDeleteItemWithKey:key];\n        } break;\n        default: return NO;\n    }\n}\n\n```\n\n- **Get**\n\n```\n- (NSData *)getItemValueForKey:(NSString *)key {\n    if (key.length == 0) return nil;\n    NSData *value = nil;\n    switch (_type) {\n        case YYKVStorageTypeFile: { //File\n            NSString *filename = [self _dbGetFilenameWithKey:key];\n            if (filename) {\n                // æ ¹æ®filenameè·å–File\n                value = [self _fileReadWithName:filename];\n                if (!value) {\n                    // å½“valueä¸å­˜åœ¨ï¼Œç”¨å¯¹åº”çš„keyåˆ é™¤SQLiteæ–‡ä»¶\n                    [self _dbDeleteItemWithKey:key];\n                    value = nil;\n                }\n            }\n        } break;\n        case YYKVStorageTypeSQLite: {\n            // SQLite æ–¹å¼è·å–\n            value = [self _dbGetValueWithKey:key];\n        } break;\n        case YYKVStorageTypeMixed: {\n            NSString *filename = [self _dbGetFilenameWithKey:key];\n            // filename å­˜åœ¨æ–‡ä»¶è·å–ï¼Œä¸å­˜åœ¨SQLiteæ–¹å¼è·å–\n            if (filename) {\n                value = [self _fileReadWithName:filename];\n                if (!value) {\n                    [self _dbDeleteItemWithKey:key];\n                    value = nil;\n                }\n            } else {\n                value = [self _dbGetValueWithKey:key];\n            }\n        } break;\n    }\n    if (value) {\n        // æ›´æ–°æ–‡ä»¶æ“ä½œæ—¶é—´\n        [self _dbUpdateAccessTimeWithKey:key];\n    }\n    return value;\n}\n\n```\n\nFileæ–¹å¼ä¸»è¦ä½¿ç”¨çš„writeToFileè¿›è¡Œå­˜å‚¨ï¼ŒSQLteç›´æ¥ä½¿ç”¨çš„sqlite3æ¥å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œå…·ä½“æ•°æ®åº“ç›¸å…³çš„æ“ä½œè¿™è¾¹å°±ä¸åœ¨è¿›è¡Œåˆ†æäº†ï¼Œæ„Ÿå…´è¶£çš„è‡ªå·±å¯ä»¥é˜…è¯»ä¸‹\n\n## YYDiskCache\n\nYYDiskCacheæ˜¯å¯¹YYKVStorageè¿›è¡Œçš„ä¸€æ¬¡å°è£…ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™è¾¹ä½¿ç”¨çš„æ˜¯dispatch_semaphore_signalæ¥ç¡®ä¿çº¿ç¨‹çš„å®‰å…¨ã€‚å¦å¤–ä»–ç»“åˆLRUç®—æ³•ï¼Œæ ¹æ®æ–‡ä»¶çš„å¤§å°è‡ªåŠ¨é€‰æ‹©å­˜å‚¨æ–¹å¼æ¥è¾¾åˆ°æ›´å¥½çš„æ€§èƒ½ã€‚\n\n```\n- (instancetype)initWithPath:(NSString *)path\n             inlineThreshold:(NSUInteger)threshold {\n    self = [super init];\n    if (!self) return nil;\n    \n    // è·å–ç¼“å­˜çš„ YYDiskCache\n    YYDiskCache *globalCache = _YYDiskCacheGetGlobal(path);\n    if (globalCache) return globalCache;\n    \n    // ç¡®å®šå­˜å‚¨çš„æ–¹å¼\n    YYKVStorageType type;\n    if (threshold == 0) {\n        type = YYKVStorageTypeFile;\n    } else if (threshold == NSUIntegerMax) {\n        type = YYKVStorageTypeSQLite;\n    } else {\n        type = YYKVStorageTypeMixed;\n    }\n    \n    // åˆå§‹åŒ– YYKVStorage\n    YYKVStorage *kv = [[YYKVStorage alloc] initWithPath:path type:type];\n    if (!kv) return nil;\n    \n    // åˆå§‹åŒ–æ•°æ®\n    _kv = kv;\n    _path = path;\n    _lock = dispatch_semaphore_create(1);\n    _queue = dispatch_queue_create(\"com.ibireme.cache.disk\", DISPATCH_QUEUE_CONCURRENT);\n    _inlineThreshold = threshold;\n    _countLimit = NSUIntegerMax;\n    _costLimit = NSUIntegerMax;\n    _ageLimit = DBL_MAX;\n    _freeDiskSpaceLimit = 0;\n    _autoTrimInterval = 60;\n    \n    // é€’å½’çš„å»æ•´ç†æ–‡ä»¶\n    [self _trimRecursively];\n    // å¯¹å½“å‰å¯¹è±¡è¿›è¡Œç¼“å­˜\n    _YYDiskCacheSetGlobal(self);\n    \n    // é€šçŸ¥ APPå³å°†è¢«æ€æ­»æ—¶\n    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(_appWillBeTerminated) name:UIApplicationWillTerminateNotification object:nil];\n    return self;\n}\n\n```\n\nå…¶ä»–çš„ä¸€äº›æ“ä½œåŸºæœ¬ä¸Šéƒ½æ˜¯å¯¹YYKVStorageçš„ä¸€äº›å°è£…ï¼Œè¿™è¾¹å°±ä¸ä¸€ä¸€åˆ†æäº†ã€‚\n\n## å‚è€ƒæ–‡çŒ®\n\n1. http://blog.ibireme.com/2015/10/26/yycache/\n2. http://blog.csdn.net/yunhua_lee/article/details/7599671\n","slug":"YYCache-analyzing","published":1,"updated":"2017-01-03T04:28:56.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjiitluf3000r55cg8i2v3k13"},{"title":"æµ…è°ˆSocketå­¦ä¹ ä¸­çš„é‚£äº›äº‹","date":"2016-01-16T13:17:20.000Z","_content":"\nSocketæ˜¯ä¸ºç½‘ç»œæœåŠ¡æä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œå¸Œæœ›ç»è¿‡æ­¤æ¬¡çš„å­¦ä¹ ï¼Œèƒ½å¤Ÿæ­å¼€Socketç¥ç§˜é¢çº±ã€‚åœ¨æ­¤ä»…æƒ³è®°å½•è‡ªå·±çš„å­¦ä¹ å†ç¨‹å’Œä¸€äº›å­¦ä¹ å¿ƒå¾—ã€‚\n<!--more-->\n\n# OSIã€TCP\\IPå‚è€ƒæ¨¡å‹\n<p>\n\n![](http://7xq5ax.com1.z0.glb.clouddn.com/OSI%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B.png)\n<p>\n\n## ç®€å•è§£é‡Š\n\n1. ç‰©ç†å±‚ï¼šä¸»è¦å®šä¹‰ç‰©ç†è®¾å¤‡æ ‡å‡†ï¼Œå¦‚ç½‘çº¿çš„æ¥å£ç±»å‹ã€å„ç§ä¼ è¾“ä»‹è´¨çš„ä¼ è¾“é€Ÿç‡ç­‰ã€‚2. \n\n2. æ•°æ®é“¾è·¯å±‚ï¼šä¸»è¦å°†ä»ç‰©ç†å±‚æ¥æ”¶çš„æ•°æ®è¿›è¡ŒMACåœ°å€çš„å°è£…ä¸è§£å°è£…ã€‚\n\n3. ç½‘ç»œå±‚ï¼šé€‰æ‹©åˆé€‚çš„ç½‘é—´è·¯ç”±å’Œäº¤æ¢ç»“ç‚¹ï¼Œç¡®ä¿æ•°æ®åŠæ—¶ä¼ é€ï¼Œå°†ä»ä¸‹å±‚æ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡ŒIPåœ°å€çš„å°è£…ä¸è§£å°è£…ã€‚\n\n4. ä¼ è¾“å±‚ï¼šå®šä¹‰äº†ä¸€äº›ä¼ è¾“æ•°æ®çš„åè®®å’Œç«¯å£ï¼Œå¦‚TCPã€UDPåè®®ï¼Œä¸»è¦å°†ä»ä¸‹å±‚æ¥æ”¶çš„æ•°æ®è¿›è¡Œåˆ†æ®µå’Œä¼ è¾“ï¼Œåˆ°è¾¾ç›®çš„åœ°å€åå†è¿›è¡Œé‡ç»„ï¼Œä»¥å¾€æŠŠè¿™ä¸€å±‚æ•°æ®å«åšæ®µã€‚\n\n5. ä¼šè¯å±‚ï¼šé€šè¿‡ä¼ è¾“å±‚å»ºç«‹æ•°æ®ä¼ è¾“é€šè·¯ã€‚\n\n6. è¡¨ç¤ºå±‚ï¼šä¸»è¦æ˜¯è¿›è¡Œå¯¹æ¥æ”¶çš„æ•°æ®è¿›è¡Œè§£é‡Šã€å‹ç¼©ä¸è§£å‹ç¼©ç­‰ï¼Œå³æŠŠè®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„ä¸œè¥¿è½¬åŒ–æˆäººèƒ½å¤Ÿè¯†åˆ«çš„ä¸œè¥¿ï¼ˆå¦‚å›¾ç‰‡ã€å£°éŸ³ç­‰ï¼‰ã€‚\n\n7. åº”ç”¨å±‚ï¼šä¸»è¦æ˜¯ä¸€äº›ç»ˆç«¯çš„åº”ç”¨ï¼Œæ¯”å¦‚è¯´FTPï¼ˆå„ç§æ–‡ä»¶ä¸‹è½½ï¼‰ã€æµè§ˆå™¨ã€QQç­‰ï¼Œå¯ä»¥å°†å…¶ç†è§£ä¸ºåœ¨ç”µè„‘å±å¹•ä¸Šå¯ä»¥çœ‹åˆ°çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯ç»ˆç«¯åº”ç”¨ã€‚<p>\n\n## ç½‘ç»œé€šè®¯è¦ç´ \n\n**IPåœ°å€**ï¼šç½‘ç»œä¸­è®¾å¤‡çš„æ ‡ç¤º\n\n**ç«¯å£å·**ï¼šç”¨æ¥æ ‡ç¤ºè¿›ç¨‹çš„é€»è¾‘åœ°å€ï¼Œä¸åŒè¿›ç¨‹çš„æ ‡ç¤º\n\n**ä¼ è¾“åè®®**ï¼šç”¨ä»€ä¹ˆæ ·çš„æ–¹å¼è¿›è¡Œäº¤äº’ï¼Œå¸¸è§åè®®TCP/UDP\n\n# TCP/UDP\n\n**TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰**\n\n1. å»ºç«‹è¿æ¥ï¼Œå½¢æˆæ•°æ®ä¼ è¾“çš„é€šé“\n\n2. åœ¨è¿æ¥ä¸­å¯è¿›è¡Œå¤§æ•°æ®ä¼ è¾“ï¼ˆæ•°æ®çš„å¤§å°ä¸å—é™åˆ¶ï¼‰\n\n3. é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼Œå¯é åè®®ï¼Œå®‰å…¨é€è¾¾\n\n4. å…ˆå»ºç«‹è¿æ¥ï¼Œæ•ˆç‡è¾ƒä½<p>\n\n**UDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰**\n\n1. ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œå°†æ•°æ®å°è£…åœ¨æ•°æ®åŒ…ä¸­\n\n2. æ¯ä¸ªæ•°æ®åŒ…å¾—å¤§å°é™åˆ¶åœ¨64kä¹‹å†…\n\n3. æ— éœ€è¿æ¥ï¼Œæ˜¯ä¸å¯é åè®®\n\n4. ä¸éœ€è¦è¿æ¥ï¼Œé€Ÿåº¦è¾ƒå¿«\n\n\n# Socket\n\n## ç®€å•è§£é‡Š\n\n1. ç½‘ç»œæä¾›æœåŠ¡çš„ä¸€ç§æœºåˆ¶\n \n2. é€šä¿¡çš„ä¸¤ç«¯éƒ½æ˜¯socket\n\n3. ç½‘ç»œé€šä¿¡å…¶å®å°±æ˜¯socketé—´çš„é€šä¿¡\n\n4. æ•°æ®åœ¨ä¸¤ä¸ªsocketé—´é€šè¿‡IOä¼ è¾“\n\n![](http://7xq5ax.com1.z0.glb.clouddn.com/%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%B5%81.png)\n\n## iOSä¸­å¸¸ç”¨çš„ä¸¤ç§Socketç±»å‹\n\n**æµå¼Socketï¼ˆSOCK_STREAMï¼‰**ï¼šæµå¼æ˜¯ä¸€ç§é¢å‘è¿æ¥çš„Socketï¼Œé’ˆå¯¹äºé¢å‘è¿æ¥çš„TCPæœåŠ¡åº”ç”¨\n\n**æ•°æ®æŠ¥å¼Socketï¼ˆSOCK_DGRAMï¼‰**ï¼šæ•°æ®æŠ¥å¼Socketæ˜¯ä¸€ç§æ— è¿æ¥çš„Socketï¼Œå¯¹åº”äºæ— è¿æ¥çš„UDPæœåŠ¡åº”ç”¨\n\n## Httpä¸Socketçš„åŒºåˆ«\n\n1. Httpæ˜¯åŸºäºSocketçš„å®ç°ï¼›Httpåº”ç”¨å±‚åè®®ï¼Œä¸»è¦è§£å†³å¦‚ä½•åŒ…è£…æ•°æ®\n\n2. Httpä¼ è¾“çš„æ•°æ®æ ¼å¼æ˜¯è§„å®šå¥½çš„ï¼ŒSocketå®ç°æ•°æ®ä¼ è¾“æ˜¯æœ€åŸå§‹ï¼ŒSocketå®ç°çš„æ•°æ®ä¼ è¾“æ ¼å¼å¯è‡ªå®šä¹‰\n\n3. Httpå»ºç«‹çš„è¿æ¥ç§°ä¸ºçŸ­è¿æ¥ï¼ŒSocketå»ºç«‹çš„è¿æ¥ä¸ºé•¿è¿æ¥\n\n4. Socketæ˜¯å¯¹TCP/IPåè®®çš„å°è£…ï¼ŒSocketæœ¬èº«å¹¶ä¸æ˜¯åè®®ï¼Œè€Œæ˜¯ä¸€ä¸ªè°ƒç”¨æ¥å£(API),é€šè¿‡Socketæˆ‘ä»¬æ‰èƒ½ä½¿ç”¨TCP/IPåè®®\n\n# æœ€å\n<p>\nåœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ä¼šæ¨¡ä»¿å¾®ä¿¡åšç±»ä¼¼çš„demoï¼Œæ¶‰åŠåˆ°çš„ä¸€äº›ç›¸å…³åœ°å€å¦‚ä¸‹ï¼š\n\n1. iOS XMPPæ¡†æ¶ï¼šhttps://github.com/robbiehanson/XMPPFramework\n\n2. Serverï¼šhttp://www.igniterealtime.org/downloads/index.jsp\n\n3. æ•°æ®åº“ï¼šhttp://dev.mysql.com/downloads/mysql/\n\n\n\n\n\n\n\n\n","source":"_posts/Socket.md","raw":"---\ntitle: æµ…è°ˆSocketå­¦ä¹ ä¸­çš„é‚£äº›äº‹\ndate: 2016-01-16 21:17:20\ncategories: iOS\ntags: [SOCKET, HTTP, TCP, UDP]\n---\n\nSocketæ˜¯ä¸ºç½‘ç»œæœåŠ¡æä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œå¸Œæœ›ç»è¿‡æ­¤æ¬¡çš„å­¦ä¹ ï¼Œèƒ½å¤Ÿæ­å¼€Socketç¥ç§˜é¢çº±ã€‚åœ¨æ­¤ä»…æƒ³è®°å½•è‡ªå·±çš„å­¦ä¹ å†ç¨‹å’Œä¸€äº›å­¦ä¹ å¿ƒå¾—ã€‚\n<!--more-->\n\n# OSIã€TCP\\IPå‚è€ƒæ¨¡å‹\n<p>\n\n![](http://7xq5ax.com1.z0.glb.clouddn.com/OSI%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B.png)\n<p>\n\n## ç®€å•è§£é‡Š\n\n1. ç‰©ç†å±‚ï¼šä¸»è¦å®šä¹‰ç‰©ç†è®¾å¤‡æ ‡å‡†ï¼Œå¦‚ç½‘çº¿çš„æ¥å£ç±»å‹ã€å„ç§ä¼ è¾“ä»‹è´¨çš„ä¼ è¾“é€Ÿç‡ç­‰ã€‚2. \n\n2. æ•°æ®é“¾è·¯å±‚ï¼šä¸»è¦å°†ä»ç‰©ç†å±‚æ¥æ”¶çš„æ•°æ®è¿›è¡ŒMACåœ°å€çš„å°è£…ä¸è§£å°è£…ã€‚\n\n3. ç½‘ç»œå±‚ï¼šé€‰æ‹©åˆé€‚çš„ç½‘é—´è·¯ç”±å’Œäº¤æ¢ç»“ç‚¹ï¼Œç¡®ä¿æ•°æ®åŠæ—¶ä¼ é€ï¼Œå°†ä»ä¸‹å±‚æ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡ŒIPåœ°å€çš„å°è£…ä¸è§£å°è£…ã€‚\n\n4. ä¼ è¾“å±‚ï¼šå®šä¹‰äº†ä¸€äº›ä¼ è¾“æ•°æ®çš„åè®®å’Œç«¯å£ï¼Œå¦‚TCPã€UDPåè®®ï¼Œä¸»è¦å°†ä»ä¸‹å±‚æ¥æ”¶çš„æ•°æ®è¿›è¡Œåˆ†æ®µå’Œä¼ è¾“ï¼Œåˆ°è¾¾ç›®çš„åœ°å€åå†è¿›è¡Œé‡ç»„ï¼Œä»¥å¾€æŠŠè¿™ä¸€å±‚æ•°æ®å«åšæ®µã€‚\n\n5. ä¼šè¯å±‚ï¼šé€šè¿‡ä¼ è¾“å±‚å»ºç«‹æ•°æ®ä¼ è¾“é€šè·¯ã€‚\n\n6. è¡¨ç¤ºå±‚ï¼šä¸»è¦æ˜¯è¿›è¡Œå¯¹æ¥æ”¶çš„æ•°æ®è¿›è¡Œè§£é‡Šã€å‹ç¼©ä¸è§£å‹ç¼©ç­‰ï¼Œå³æŠŠè®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„ä¸œè¥¿è½¬åŒ–æˆäººèƒ½å¤Ÿè¯†åˆ«çš„ä¸œè¥¿ï¼ˆå¦‚å›¾ç‰‡ã€å£°éŸ³ç­‰ï¼‰ã€‚\n\n7. åº”ç”¨å±‚ï¼šä¸»è¦æ˜¯ä¸€äº›ç»ˆç«¯çš„åº”ç”¨ï¼Œæ¯”å¦‚è¯´FTPï¼ˆå„ç§æ–‡ä»¶ä¸‹è½½ï¼‰ã€æµè§ˆå™¨ã€QQç­‰ï¼Œå¯ä»¥å°†å…¶ç†è§£ä¸ºåœ¨ç”µè„‘å±å¹•ä¸Šå¯ä»¥çœ‹åˆ°çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯ç»ˆç«¯åº”ç”¨ã€‚<p>\n\n## ç½‘ç»œé€šè®¯è¦ç´ \n\n**IPåœ°å€**ï¼šç½‘ç»œä¸­è®¾å¤‡çš„æ ‡ç¤º\n\n**ç«¯å£å·**ï¼šç”¨æ¥æ ‡ç¤ºè¿›ç¨‹çš„é€»è¾‘åœ°å€ï¼Œä¸åŒè¿›ç¨‹çš„æ ‡ç¤º\n\n**ä¼ è¾“åè®®**ï¼šç”¨ä»€ä¹ˆæ ·çš„æ–¹å¼è¿›è¡Œäº¤äº’ï¼Œå¸¸è§åè®®TCP/UDP\n\n# TCP/UDP\n\n**TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰**\n\n1. å»ºç«‹è¿æ¥ï¼Œå½¢æˆæ•°æ®ä¼ è¾“çš„é€šé“\n\n2. åœ¨è¿æ¥ä¸­å¯è¿›è¡Œå¤§æ•°æ®ä¼ è¾“ï¼ˆæ•°æ®çš„å¤§å°ä¸å—é™åˆ¶ï¼‰\n\n3. é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼Œå¯é åè®®ï¼Œå®‰å…¨é€è¾¾\n\n4. å…ˆå»ºç«‹è¿æ¥ï¼Œæ•ˆç‡è¾ƒä½<p>\n\n**UDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰**\n\n1. ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œå°†æ•°æ®å°è£…åœ¨æ•°æ®åŒ…ä¸­\n\n2. æ¯ä¸ªæ•°æ®åŒ…å¾—å¤§å°é™åˆ¶åœ¨64kä¹‹å†…\n\n3. æ— éœ€è¿æ¥ï¼Œæ˜¯ä¸å¯é åè®®\n\n4. ä¸éœ€è¦è¿æ¥ï¼Œé€Ÿåº¦è¾ƒå¿«\n\n\n# Socket\n\n## ç®€å•è§£é‡Š\n\n1. ç½‘ç»œæä¾›æœåŠ¡çš„ä¸€ç§æœºåˆ¶\n \n2. é€šä¿¡çš„ä¸¤ç«¯éƒ½æ˜¯socket\n\n3. ç½‘ç»œé€šä¿¡å…¶å®å°±æ˜¯socketé—´çš„é€šä¿¡\n\n4. æ•°æ®åœ¨ä¸¤ä¸ªsocketé—´é€šè¿‡IOä¼ è¾“\n\n![](http://7xq5ax.com1.z0.glb.clouddn.com/%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%B5%81.png)\n\n## iOSä¸­å¸¸ç”¨çš„ä¸¤ç§Socketç±»å‹\n\n**æµå¼Socketï¼ˆSOCK_STREAMï¼‰**ï¼šæµå¼æ˜¯ä¸€ç§é¢å‘è¿æ¥çš„Socketï¼Œé’ˆå¯¹äºé¢å‘è¿æ¥çš„TCPæœåŠ¡åº”ç”¨\n\n**æ•°æ®æŠ¥å¼Socketï¼ˆSOCK_DGRAMï¼‰**ï¼šæ•°æ®æŠ¥å¼Socketæ˜¯ä¸€ç§æ— è¿æ¥çš„Socketï¼Œå¯¹åº”äºæ— è¿æ¥çš„UDPæœåŠ¡åº”ç”¨\n\n## Httpä¸Socketçš„åŒºåˆ«\n\n1. Httpæ˜¯åŸºäºSocketçš„å®ç°ï¼›Httpåº”ç”¨å±‚åè®®ï¼Œä¸»è¦è§£å†³å¦‚ä½•åŒ…è£…æ•°æ®\n\n2. Httpä¼ è¾“çš„æ•°æ®æ ¼å¼æ˜¯è§„å®šå¥½çš„ï¼ŒSocketå®ç°æ•°æ®ä¼ è¾“æ˜¯æœ€åŸå§‹ï¼ŒSocketå®ç°çš„æ•°æ®ä¼ è¾“æ ¼å¼å¯è‡ªå®šä¹‰\n\n3. Httpå»ºç«‹çš„è¿æ¥ç§°ä¸ºçŸ­è¿æ¥ï¼ŒSocketå»ºç«‹çš„è¿æ¥ä¸ºé•¿è¿æ¥\n\n4. Socketæ˜¯å¯¹TCP/IPåè®®çš„å°è£…ï¼ŒSocketæœ¬èº«å¹¶ä¸æ˜¯åè®®ï¼Œè€Œæ˜¯ä¸€ä¸ªè°ƒç”¨æ¥å£(API),é€šè¿‡Socketæˆ‘ä»¬æ‰èƒ½ä½¿ç”¨TCP/IPåè®®\n\n# æœ€å\n<p>\nåœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ä¼šæ¨¡ä»¿å¾®ä¿¡åšç±»ä¼¼çš„demoï¼Œæ¶‰åŠåˆ°çš„ä¸€äº›ç›¸å…³åœ°å€å¦‚ä¸‹ï¼š\n\n1. iOS XMPPæ¡†æ¶ï¼šhttps://github.com/robbiehanson/XMPPFramework\n\n2. Serverï¼šhttp://www.igniterealtime.org/downloads/index.jsp\n\n3. æ•°æ®åº“ï¼šhttp://dev.mysql.com/downloads/mysql/\n\n\n\n\n\n\n\n\n","slug":"Socket","published":1,"updated":"2017-01-03T04:28:56.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjiitluf6000w55cgm4ggevrh"},{"title":"Runtimeå®æˆ˜ä¹‹å®šåˆ¶TabBarItemå¤§å°","date":"2016-05-11T14:17:26.000Z","_content":"æœ¬ç¯‡blogä¸»è¦è®²è§£å¦‚ä½•å®šåˆ¶TabBarItemçš„å¤§å°ï¼Œæœ€ç»ˆå®ç°AppStoreå„å¤§ä¸»æµAPP TabBarItemè¶…å‡ºTabBarçš„æ•ˆæœã€‚\n<!--more-->\n\n# æ–¹æ¡ˆä¸€ï¼šUIEdgeInsets\n**é€‚ç”¨åœºæ™¯ï¼š** <br>\n\n- é€‚åˆAPPçš„TabBarItemImageçš„å›¾ç‰‡èµ„æºæ”¾åœ¨æœ¬åœ°\n- å›¾ç‰‡è¶…å‡ºtabbarçš„é«˜åº¦ï¼Œéœ€ç§»åŠ¨å…¶ä½ç½®ï¼Œæ¥è¿›è¡Œé€‚åº”\n\n**å¼Šç«¯ï¼š** <br>\n\nè‹¥åœ¨æœ¬åœ°é…ç½®å¥½åï¼Œtabbarçš„å›¾ç‰‡å°±ä¸èƒ½æ”¹åŠ¨äº†ï¼Œè‹¥tabbarçš„å›¾ç‰‡æ¥è‡ªæœåŠ¡ç«¯ï¼Œä¸”ä¸åœçš„åˆ‡æ¢å›¾ç‰‡çš„å¤§å°ï¼Œä»¥ä¸Šåˆ™å¾ˆéš¾æ»¡è¶³ã€‚è‹¥æœ‰æ­¤æ–¹é¢çš„éœ€æ±‚è¯·çœ‹æ–¹æ¡ˆäºŒã€‚\n\n**å®ç°ï¼š** <br>\n\n` [tabbarItem setImageInsets:UIEdgeInsetsMake(<#CGFloat top#>, <#CGFloat left#>, <#CGFloat bottom#>, <#CGFloat right#>)]` \n\næ³¨ï¼šå›¾ç‰‡å¤ªå¤§è¶…å‡ºtabbaræ—¶ï¼Œç³»ç»Ÿå¹¶ä¸ä¼šè°ƒæ•´imageå’Œtitleçš„ä½ç½®ï¼Œä½ éœ€è¦æ ¹æ®å›¾ç‰‡çš„é«˜åº¦ï¼Œè®¡ç®—å‡ºéœ€è¦å¾€ä¸Šç§»åŠ¨çš„é«˜åº¦ï¼Œç„¶åè®¾ç½®topå’Œbottomå±æ€§å³å¯ã€‚åˆ‡è®°top = - bottomï¼Œå¦åˆ™imageå°†ä¼šè¢«æ‹‰ä¼¸æˆ–è€…è¢«å‹ç¼©ã€‚\n\n\n# æ–¹æ¡ˆäºŒï¼šRuntime\nåˆ©ç”¨runtimeçš„è¯ç›¸å¯¹æ–¹æ¡ˆä¸€æ¥è¯´è¦æ¯”è¾ƒå¤æ‚ä¸€ç‚¹ï¼Œä½†å…¶çµæ´»åº¦æ¯”è¾ƒé«˜ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ ¹æ®æœåŠ¡ç«¯æ‰€ç»™çš„imageæ¥åŠ¨æ€çš„å˜åŒ–TabBarItemçš„å¤§å°ï¼Œç±»ä¼¼åƒæ·˜å®ã€äº¬ä¸œæ´»åŠ¨æ—¶ã€‚æ€æƒ³ï¼šä¸»è¦æ˜¯åˆ©ç”¨runtimeå¯¹UITabBarçš„layoutSubviewsè¿›è¡Œé‡å†™ï¼Œç„¶åè°ƒæ•´UITabBarItemçš„ä½ç½®ã€‚å¦å¤–ï¼Œå½“æ—¶åœ¨åšçš„APPå·²ç»æœ‰4-5å¹´çš„å†å²äº†ï¼Œä¸€å¼€å§‹æ‰“ç®—è‡ªå·²å®šåˆ¶tabbarï¼Œå‘ç°è¦æ”¹åŠ¨çš„è¿˜æ˜¯æŒºå¤šçš„ï¼Œäºæ˜¯å°±æ”¾å¼ƒäº†ã€‚åšä¹‹å‰ä¹Ÿçœ‹äº†å‰è¾ˆiOSç¨‹åºçŠ­è¢çš„[CYLTabBarController](https://github.com/ChenYilong/CYLTabBarController)ï¼Œä»ä¸­ä¹Ÿå­¦åˆ°äº†ä¸å°‘æ€è·¯ã€‚\n\n\n**å®ç°ï¼š** <br>\n1. é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨runtime method swizzlingäº¤æ¢ç³»ç»Ÿçš„`- (void)layoutSubviews;` <br>\n2. ä½¿ç”¨KVCå¯¹ç³»ç»Ÿçš„UITabBarButtonã€UITabBarSwappableImageViewã€UITabBarButtonLabelã€_UIBadgeViewè¿›è¡Œæ•è· <br> \n3. æ‹¿åˆ°æ§ä»¶åæˆ‘ä»¬å¯¹å…¶çš„frameè¿›è¡Œè®¡ç®—ï¼Œåˆ¤æ–­å½“å‰æœ‰æ²¡æœ‰è¶…å‡ºtabbarçš„é«˜åº¦ï¼Œè‹¥è¶…å‡ºåˆ™è¿›è¡Œå¤„ç† <br>\n4. å†æ¬¡åˆ©ç”¨runtime method swizzlingäº¤æ¢ç³»ç»Ÿçš„`- (nullable UIView *)hitTest:(CGPoint)point withEvent:(nullable UIEvent *)event;`ä½¿å›¾ç‰‡è¶…è¿‡åä¹Ÿèƒ½æ¥å—ç‚¹å‡» <br>\n\n**ä»£ç ï¼š** <br>\n\n- method swizzlingï¼š\n\n```\nstatic void ExchangedMethod(SEL originalSelector, SEL swizzledSelector, Class class) {\n    \n    Method originalMethod = class_getInstanceMethod(class, originalSelector);\n    Method swizzledMethod = class_getInstanceMethod(class, swizzledSelector);\n    \n    BOOL didAddMethod =\n    class_addMethod(class,\n                    originalSelector,\n                    method_getImplementation(swizzledMethod),\n                    method_getTypeEncoding(swizzledMethod));\n    \n    if (didAddMethod) {\n        class_replaceMethod(class,\n                            swizzledSelector,\n                            method_getImplementation(originalMethod),\n                            method_getTypeEncoding(originalMethod));\n    }\n    else {\n        method_exchangeImplementations(originalMethod, swizzledMethod);\n    }\n}\n\n```\n- è®¡ç®—frameï¼Œå¹¶å¯¹å…¶é‡æ–°å¸ƒå±€\n\n```\nUIView *tabBarImageView, *tabBarButtonLabel, *tabBarBadgeView;\n        for (UIView *sTabBarItem in childView.subviews) {\n            if ([sTabBarItem isKindOfClass:NSClassFromString(@\"UITabBarSwappableImageView\")]) {\n                tabBarImageView = sTabBarItem;\n            }\n            else if ([sTabBarItem isKindOfClass:NSClassFromString(@\"UITabBarButtonLabel\")]) {\n                tabBarButtonLabel = sTabBarItem;\n            }\n            else if ([sTabBarItem isKindOfClass:NSClassFromString(@\"_UIBadgeView\")]) {\n                tabBarBadgeView = sTabBarItem;\n            }\n        }\n\n        NSString *tabBarButtonLabelText = ((UILabel *)tabBarButtonLabel).text;\n  \n        CGFloat y = CGRectGetHeight(self.bounds) - (CGRectGetHeight(tabBarButtonLabel.bounds) + CGRectGetHeight(tabBarImageView.bounds));\n        if (y < 3) {\n            if (!tabBarButtonLabelText.length) {\n                space -= tabBarButtonLabelHeight;\n            }\n            \n            childView.frame = CGRectMake(childView.frame.origin.x,\n                                         y - space,\n                                         childView.frame.size.width,\n                                         childView.frame.size.height - y + space\n                                         );\n        }\n\n```\n\n- è®©å›¾ç‰‡è¶…å‡ºéƒ¨åˆ†ä¹Ÿèƒ½å“åº”ç‚¹å‡»äº‹ä»¶\n\n```\n- (UIView *)s_hitTest:(CGPoint)point withEvent:(UIEvent *)event {\n    if (!self.clipsToBounds && !self.hidden && self.alpha > 0) {\n        UIView *result = [super hitTest:point withEvent:event];\n        if (result) {\n            return result;\n        }\n        else {\n            for (UIView *subview in self.subviews.reverseObjectEnumerator) {\n                CGPoint subPoint = [subview convertPoint:point fromView:self];\n                result = [subview hitTest:subPoint withEvent:event];\n                if (result) {\n                    return result;\n                }\n            }\n        }\n    }\n    return nil;\n}\n\n```\n# æ³¨æ„äº‹é¡¹\n\n- åœ¨ç»™tabbarè®¾ç½®å›¾ç‰‡çš„æ—¶å€™ä¸€å®šè¦è®¾ç½®å›¾ç‰‡çš„`renderingMode`ï¼Œå¦åˆ™å°±ä¼šå‡ºç°ä¸‹å›¾ä¸­å›¾ç‰‡ä¸¢å¤±çš„ç°è±¡\n- UITabBarButtonè¢«ä¿®æ”¹frameä¹‹åï¼Œä»…æœ‰UITabBarSwappableImageViewèƒ½å¤Ÿå“åº”ç‚¹å‡»äº‹ä»¶ï¼Œä¸è¿‡æˆ‘ä»¬èƒ½å¤Ÿåœ¨UITabBarçš„`- (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(nullable UIEvent *)event;`æ–¹æ³•ä¸­æ•è·åˆ°\n- å½“é€‚é…å›¾ç‰‡åä¸è¦å¿˜è®°é€‚é…`_UIBadgeView`çš„frame\n\n\n# æ•ˆæœå›¾\n- æ­£å¸¸ä¸­é—´è¶…å‡º <br>\n![éƒ¨åˆ†è¶…å‡º](http://7xq5ax.com1.z0.glb.clouddn.com/tabbar_image_render.png)<br>\n- åšæ´»åŠ¨æ—¶å…¨éƒ¨è¶…å‡º <br>\n![å…¨éƒ¨è¶…å‡º](http://7xq5ax.com1.z0.glb.clouddn.com/tabbar_more_all.png)<br>\n- å›¾ç‰‡ä¸¢å¤± <br>\n![å›¾ç‰‡ä¸¢å¤±](http://7xq5ax.com1.z0.glb.clouddn.com/tabbar_more.png)<br>\n- UIBadgeView <br>\n![](http://7xq5ax.com1.z0.glb.clouddn.com/badgevalue.png)\n\n> æ„Ÿè°¢å¤§å®¶èŠ±è´¹æ—¶é—´æ¥æŸ¥çœ‹è¿™ç¯‡blogï¼Œéœ€è¦ä¸‹è½½demoçš„åŒå­¦è¯·çŒ›æˆ³[Git](https://github.com/PanXianyue/BlogDemo)ã€‚","source":"_posts/Runtime-tabBarItem.md","raw":"---\ntitle: Runtimeå®æˆ˜ä¹‹å®šåˆ¶TabBarItemå¤§å°\ndate: 2016-05-11 22:17:26\ncategories: iOS\ntags:\n---\næœ¬ç¯‡blogä¸»è¦è®²è§£å¦‚ä½•å®šåˆ¶TabBarItemçš„å¤§å°ï¼Œæœ€ç»ˆå®ç°AppStoreå„å¤§ä¸»æµAPP TabBarItemè¶…å‡ºTabBarçš„æ•ˆæœã€‚\n<!--more-->\n\n# æ–¹æ¡ˆä¸€ï¼šUIEdgeInsets\n**é€‚ç”¨åœºæ™¯ï¼š** <br>\n\n- é€‚åˆAPPçš„TabBarItemImageçš„å›¾ç‰‡èµ„æºæ”¾åœ¨æœ¬åœ°\n- å›¾ç‰‡è¶…å‡ºtabbarçš„é«˜åº¦ï¼Œéœ€ç§»åŠ¨å…¶ä½ç½®ï¼Œæ¥è¿›è¡Œé€‚åº”\n\n**å¼Šç«¯ï¼š** <br>\n\nè‹¥åœ¨æœ¬åœ°é…ç½®å¥½åï¼Œtabbarçš„å›¾ç‰‡å°±ä¸èƒ½æ”¹åŠ¨äº†ï¼Œè‹¥tabbarçš„å›¾ç‰‡æ¥è‡ªæœåŠ¡ç«¯ï¼Œä¸”ä¸åœçš„åˆ‡æ¢å›¾ç‰‡çš„å¤§å°ï¼Œä»¥ä¸Šåˆ™å¾ˆéš¾æ»¡è¶³ã€‚è‹¥æœ‰æ­¤æ–¹é¢çš„éœ€æ±‚è¯·çœ‹æ–¹æ¡ˆäºŒã€‚\n\n**å®ç°ï¼š** <br>\n\n` [tabbarItem setImageInsets:UIEdgeInsetsMake(<#CGFloat top#>, <#CGFloat left#>, <#CGFloat bottom#>, <#CGFloat right#>)]` \n\næ³¨ï¼šå›¾ç‰‡å¤ªå¤§è¶…å‡ºtabbaræ—¶ï¼Œç³»ç»Ÿå¹¶ä¸ä¼šè°ƒæ•´imageå’Œtitleçš„ä½ç½®ï¼Œä½ éœ€è¦æ ¹æ®å›¾ç‰‡çš„é«˜åº¦ï¼Œè®¡ç®—å‡ºéœ€è¦å¾€ä¸Šç§»åŠ¨çš„é«˜åº¦ï¼Œç„¶åè®¾ç½®topå’Œbottomå±æ€§å³å¯ã€‚åˆ‡è®°top = - bottomï¼Œå¦åˆ™imageå°†ä¼šè¢«æ‹‰ä¼¸æˆ–è€…è¢«å‹ç¼©ã€‚\n\n\n# æ–¹æ¡ˆäºŒï¼šRuntime\nåˆ©ç”¨runtimeçš„è¯ç›¸å¯¹æ–¹æ¡ˆä¸€æ¥è¯´è¦æ¯”è¾ƒå¤æ‚ä¸€ç‚¹ï¼Œä½†å…¶çµæ´»åº¦æ¯”è¾ƒé«˜ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ ¹æ®æœåŠ¡ç«¯æ‰€ç»™çš„imageæ¥åŠ¨æ€çš„å˜åŒ–TabBarItemçš„å¤§å°ï¼Œç±»ä¼¼åƒæ·˜å®ã€äº¬ä¸œæ´»åŠ¨æ—¶ã€‚æ€æƒ³ï¼šä¸»è¦æ˜¯åˆ©ç”¨runtimeå¯¹UITabBarçš„layoutSubviewsè¿›è¡Œé‡å†™ï¼Œç„¶åè°ƒæ•´UITabBarItemçš„ä½ç½®ã€‚å¦å¤–ï¼Œå½“æ—¶åœ¨åšçš„APPå·²ç»æœ‰4-5å¹´çš„å†å²äº†ï¼Œä¸€å¼€å§‹æ‰“ç®—è‡ªå·²å®šåˆ¶tabbarï¼Œå‘ç°è¦æ”¹åŠ¨çš„è¿˜æ˜¯æŒºå¤šçš„ï¼Œäºæ˜¯å°±æ”¾å¼ƒäº†ã€‚åšä¹‹å‰ä¹Ÿçœ‹äº†å‰è¾ˆiOSç¨‹åºçŠ­è¢çš„[CYLTabBarController](https://github.com/ChenYilong/CYLTabBarController)ï¼Œä»ä¸­ä¹Ÿå­¦åˆ°äº†ä¸å°‘æ€è·¯ã€‚\n\n\n**å®ç°ï¼š** <br>\n1. é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨runtime method swizzlingäº¤æ¢ç³»ç»Ÿçš„`- (void)layoutSubviews;` <br>\n2. ä½¿ç”¨KVCå¯¹ç³»ç»Ÿçš„UITabBarButtonã€UITabBarSwappableImageViewã€UITabBarButtonLabelã€_UIBadgeViewè¿›è¡Œæ•è· <br> \n3. æ‹¿åˆ°æ§ä»¶åæˆ‘ä»¬å¯¹å…¶çš„frameè¿›è¡Œè®¡ç®—ï¼Œåˆ¤æ–­å½“å‰æœ‰æ²¡æœ‰è¶…å‡ºtabbarçš„é«˜åº¦ï¼Œè‹¥è¶…å‡ºåˆ™è¿›è¡Œå¤„ç† <br>\n4. å†æ¬¡åˆ©ç”¨runtime method swizzlingäº¤æ¢ç³»ç»Ÿçš„`- (nullable UIView *)hitTest:(CGPoint)point withEvent:(nullable UIEvent *)event;`ä½¿å›¾ç‰‡è¶…è¿‡åä¹Ÿèƒ½æ¥å—ç‚¹å‡» <br>\n\n**ä»£ç ï¼š** <br>\n\n- method swizzlingï¼š\n\n```\nstatic void ExchangedMethod(SEL originalSelector, SEL swizzledSelector, Class class) {\n    \n    Method originalMethod = class_getInstanceMethod(class, originalSelector);\n    Method swizzledMethod = class_getInstanceMethod(class, swizzledSelector);\n    \n    BOOL didAddMethod =\n    class_addMethod(class,\n                    originalSelector,\n                    method_getImplementation(swizzledMethod),\n                    method_getTypeEncoding(swizzledMethod));\n    \n    if (didAddMethod) {\n        class_replaceMethod(class,\n                            swizzledSelector,\n                            method_getImplementation(originalMethod),\n                            method_getTypeEncoding(originalMethod));\n    }\n    else {\n        method_exchangeImplementations(originalMethod, swizzledMethod);\n    }\n}\n\n```\n- è®¡ç®—frameï¼Œå¹¶å¯¹å…¶é‡æ–°å¸ƒå±€\n\n```\nUIView *tabBarImageView, *tabBarButtonLabel, *tabBarBadgeView;\n        for (UIView *sTabBarItem in childView.subviews) {\n            if ([sTabBarItem isKindOfClass:NSClassFromString(@\"UITabBarSwappableImageView\")]) {\n                tabBarImageView = sTabBarItem;\n            }\n            else if ([sTabBarItem isKindOfClass:NSClassFromString(@\"UITabBarButtonLabel\")]) {\n                tabBarButtonLabel = sTabBarItem;\n            }\n            else if ([sTabBarItem isKindOfClass:NSClassFromString(@\"_UIBadgeView\")]) {\n                tabBarBadgeView = sTabBarItem;\n            }\n        }\n\n        NSString *tabBarButtonLabelText = ((UILabel *)tabBarButtonLabel).text;\n  \n        CGFloat y = CGRectGetHeight(self.bounds) - (CGRectGetHeight(tabBarButtonLabel.bounds) + CGRectGetHeight(tabBarImageView.bounds));\n        if (y < 3) {\n            if (!tabBarButtonLabelText.length) {\n                space -= tabBarButtonLabelHeight;\n            }\n            \n            childView.frame = CGRectMake(childView.frame.origin.x,\n                                         y - space,\n                                         childView.frame.size.width,\n                                         childView.frame.size.height - y + space\n                                         );\n        }\n\n```\n\n- è®©å›¾ç‰‡è¶…å‡ºéƒ¨åˆ†ä¹Ÿèƒ½å“åº”ç‚¹å‡»äº‹ä»¶\n\n```\n- (UIView *)s_hitTest:(CGPoint)point withEvent:(UIEvent *)event {\n    if (!self.clipsToBounds && !self.hidden && self.alpha > 0) {\n        UIView *result = [super hitTest:point withEvent:event];\n        if (result) {\n            return result;\n        }\n        else {\n            for (UIView *subview in self.subviews.reverseObjectEnumerator) {\n                CGPoint subPoint = [subview convertPoint:point fromView:self];\n                result = [subview hitTest:subPoint withEvent:event];\n                if (result) {\n                    return result;\n                }\n            }\n        }\n    }\n    return nil;\n}\n\n```\n# æ³¨æ„äº‹é¡¹\n\n- åœ¨ç»™tabbarè®¾ç½®å›¾ç‰‡çš„æ—¶å€™ä¸€å®šè¦è®¾ç½®å›¾ç‰‡çš„`renderingMode`ï¼Œå¦åˆ™å°±ä¼šå‡ºç°ä¸‹å›¾ä¸­å›¾ç‰‡ä¸¢å¤±çš„ç°è±¡\n- UITabBarButtonè¢«ä¿®æ”¹frameä¹‹åï¼Œä»…æœ‰UITabBarSwappableImageViewèƒ½å¤Ÿå“åº”ç‚¹å‡»äº‹ä»¶ï¼Œä¸è¿‡æˆ‘ä»¬èƒ½å¤Ÿåœ¨UITabBarçš„`- (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(nullable UIEvent *)event;`æ–¹æ³•ä¸­æ•è·åˆ°\n- å½“é€‚é…å›¾ç‰‡åä¸è¦å¿˜è®°é€‚é…`_UIBadgeView`çš„frame\n\n\n# æ•ˆæœå›¾\n- æ­£å¸¸ä¸­é—´è¶…å‡º <br>\n![éƒ¨åˆ†è¶…å‡º](http://7xq5ax.com1.z0.glb.clouddn.com/tabbar_image_render.png)<br>\n- åšæ´»åŠ¨æ—¶å…¨éƒ¨è¶…å‡º <br>\n![å…¨éƒ¨è¶…å‡º](http://7xq5ax.com1.z0.glb.clouddn.com/tabbar_more_all.png)<br>\n- å›¾ç‰‡ä¸¢å¤± <br>\n![å›¾ç‰‡ä¸¢å¤±](http://7xq5ax.com1.z0.glb.clouddn.com/tabbar_more.png)<br>\n- UIBadgeView <br>\n![](http://7xq5ax.com1.z0.glb.clouddn.com/badgevalue.png)\n\n> æ„Ÿè°¢å¤§å®¶èŠ±è´¹æ—¶é—´æ¥æŸ¥çœ‹è¿™ç¯‡blogï¼Œéœ€è¦ä¸‹è½½demoçš„åŒå­¦è¯·çŒ›æˆ³[Git](https://github.com/PanXianyue/BlogDemo)ã€‚","slug":"Runtime-tabBarItem","published":1,"updated":"2017-01-03T04:28:56.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjiitlufa001655cgcp8a6urt"},{"title":"ä¸€ç¯‡æå®šRSAåŠ å¯†ä¸SHAç­¾å","date":"2016-01-12T09:19:25.000Z","_content":"\nçœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„åŒå­¦å¯å¹¸ç¦äº†ï¼Œå½“æ—¶åœ¨åšRSAåŠ å¯†ä¸ç­¾åçš„æ—¶å€™ç½‘ä¸Šçš„èµ„æ–™ç®€ç›´ä¸è¦å¤ªè€ï¼Œåšå®Œåå®åœ¨æ˜¯å¿å—ä¸ä¸‹å»äº†ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä¼šè¯¦ç»†è®²è§£iOSå¦‚ä½•å®ç°RSAåŠ å¯†ä¸ç­¾åï¼Œå¹¶ä¸”ä¸Javaå®Œå…¨åŒæ­¥ã€‚\n<!--more-->\n\n# åŸºç¡€çŸ¥è¯† \n\n <p>\n\n1. **ä»€ä¹ˆæ˜¯RSAï¼Ÿ**<p>\nç­”ï¼šRSAæ˜¯ä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå¸¸ç”¨æ¥å¯¹ä¼ è¾“æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œé…åˆä¸Šæ•°å­—æ‘˜è¦ç®—æ³•ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œæ–‡å­—ç­¾åã€‚\n\n2. **RSAåŠ å¯†ä¸­paddingï¼Ÿ**<p>\nç­”ï¼špaddingå³å¡«å……æ–¹å¼ï¼Œç”±äºRSAåŠ å¯†ç®—æ³•ä¸­è¦åŠ å¯†çš„æ˜æ–‡æ˜¯è¦æ¯”æ¨¡æ•°å°çš„ï¼Œpaddingå°±æ˜¯é€šè¿‡ä¸€äº›å¡«å……æ–¹å¼æ¥é™åˆ¶æ˜æ–‡çš„é•¿åº¦ã€‚åé¢ä¼šè¯¦ç»†ä»‹ç»paddingçš„å‡ ç§æ¨¡å¼ä»¥åŠåˆ†æ®µåŠ å¯†ã€‚\n\n3. **åŠ å¯†å’ŒåŠ ç­¾æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**<p>\nç­”ï¼šåŠ å¯†ï¼šå…¬é’¥æ”¾åœ¨å®¢æˆ·ç«¯ï¼Œå¹¶ä½¿ç”¨å…¬é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼ŒæœåŠ¡ç«¯æ‹¿åˆ°æ•°æ®åç”¨ç§é’¥è¿›è¡Œè§£å¯†ï¼›Â \n Â  Â  Â åŠ ç­¾ï¼šç§é’¥æ”¾åœ¨å®¢æˆ·ç«¯ï¼Œå¹¶ä½¿ç”¨ç§é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ ç­¾ï¼ŒæœåŠ¡ç«¯æ‹¿åˆ°æ•°æ®åç”¨å…¬é’¥è¿›è¡ŒéªŒç­¾ã€‚Â  Â  Â  Â \nå‰è€…å®Œå…¨ä¸ºäº†åŠ å¯†ï¼›åè€…ä¸»è¦æ˜¯ä¸ºäº†é˜²æ¶æ„æ”»å‡»ï¼Œé˜²æ­¢åˆ«äººæ¨¡æ‹Ÿæˆ‘ä»¬çš„å®¢æˆ·ç«¯å¯¹æˆ‘ä»¬çš„æœåŠ¡å™¨è¿›è¡Œæ”»å‡»ï¼Œå¯¼è‡´æœåŠ¡å™¨ç˜«ç—ªã€‚\n\n# åŸºæœ¬åŸç†<p>\n\nRSAä½¿ç”¨â€œå¯†é’¥å¯¹â€å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†è§£å¯†ï¼Œåœ¨åŠ å¯†è§£å¯†å‰éœ€è¦å…ˆç”Ÿå­˜å…¬é’¥ï¼ˆPublic Keyï¼‰å’Œç§é’¥ï¼ˆPrivate Keyï¼‰ã€‚<p>\n**å…¬é’¥(Public key):**Â ç”¨äºåŠ å¯†æ•°æ®. ç”¨äºå…¬å¼€, ä¸€èˆ¬å­˜æ”¾åœ¨æ•°æ®æä¾›æ–¹, ä¾‹å¦‚iOSå®¢æˆ·ç«¯ã€‚<p>\n**ç§é’¥(Private key):**Â ç”¨äºè§£å¯†æ•°æ®. å¿…é¡»ä¿å¯†, ç§é’¥æ³„éœ²ä¼šé€ æˆå®‰å…¨é—®é¢˜ã€‚<p>\niOSä¸­çš„Security.frameworkæä¾›äº†å¯¹RSAç®—æ³•çš„æ”¯æŒï¼Œè¿™ç§æ–¹å¼éœ€è¦å¯¹å¯†åŒ™å¯¹è¿›è¡Œå¤„ç†, æ ¹æ®public keyç”Ÿæˆè¯ä¹¦, é€šè¿‡private keyç”Ÿæˆp12æ ¼å¼çš„å¯†åŒ™ã€‚æƒ³æƒ³javeç›´æ¥ç”¨å­—ç¬¦ä¸²è¿›è¡ŒåŠ å¯†è§£å¯†ç®€å•å¤šäº†ã€‚(âŠ™oâŠ™)â€¦\n\n# å®æˆ˜\n<p>\n## è¯ä¹¦ç”Ÿæˆ\nRSAåŠ å¯†è¿™å—å…¬é’¥ã€ç§é’¥å¿…ä¸å¯å°‘çš„ã€‚**Appleæ˜¯ä¸æ”¯æŒç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²è¿›è¡ŒåŠ å¯†è§£å¯†çš„ï¼Œæ¨èä½¿ç”¨p12æ–‡ä»¶**ã€‚è¿™è¾¹æ•™å¤§å®¶å»ç”Ÿæˆåœ¨åŠ å¯†ä¸­ä½¿ç”¨åˆ°çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶æä¾›ç»™Javaä½¿ç”¨ï¼Œæƒ³å½“å¹´è¿™ä¸ªå…¬é’¥ç§é’¥æäº†åŠå¤©äº†ã€‚ %>_<%\n\n>* ç”Ÿæˆæ¨¡é•¿ä¸º1024bitçš„ç§é’¥\nopenssl genrsa -out private_key.pem 1024\n* ç”Ÿæˆcertification require file\nopensslÂ reqÂ -newÂ -keyÂ private_key.pemÂ -outÂ rsaCertReq.csrÂ \n* ç”Ÿæˆcertification å¹¶æŒ‡å®šè¿‡æœŸæ—¶é—´\nopenssl x509 -req -days3650-in rsaCertReq.csr -signkey private_key.pem -out rsaCert.crt\n* ç”Ÿæˆå…¬é’¥ä¾›iOSä½¿ç”¨\nopenssl x509 -outform der -in rsaCert.crt -out public_key.der\n* ç”Ÿæˆç§é’¥ä¾›iOSä½¿ç”¨ è¿™è¾¹ä¼šè®©ä½ è¾“å…¥å¯†ç ï¼ŒåæœŸç”¨åˆ°åœ¨ç”ŸæˆsecKeyRefçš„æ—¶å€™ä¼šç”¨åˆ°è¿™ä¸ªå¯†ç \nopenssl pkcs12 -export -out private_key.p12 -inkey private_key.pem -in rsaCert.crt\n* ç”Ÿæˆpemç»“å°¾çš„å…¬é’¥ä¾›Javaä½¿ç”¨\nopenssl rsa -in private_key.pem -out rsa_public_key.pem -pubout\n* ç”Ÿæˆpemç»“å°¾çš„ç§é’¥ä¾›Javaä½¿ç”¨openssl pkcs8 -topk8 -in private_key.pem -out pkcs8_private_key.pem -nocrypt\n\n**ä»¥ä¸Šæ‰€æœ‰çš„æ­¥éª¤éƒ½æ˜¯åœ¨ç»ˆç«¯ä¸‹å®Œæˆçš„å“¦ Â (*^__^*)**\n\n## ç”Ÿæˆå…¬é’¥å’Œç§é’¥çš„secKeyRef<p>\n   ```\n   //æ ¹æ®ä½ çš„p12æ–‡ä»¶ç”Ÿæˆç§é’¥å¯¹åº”çš„SecKeyRef è¿™è¾¹è¿”å›è‹¥æ˜¯nil è¯·æ£€æŸ¥ä½ p12æ–‡ä»¶çš„ç”Ÿæˆæ­¥éª¤\n- (SecKeyRef)getPrivateKeyRefrenceFromData:(NSData*)p12Data password:(NSString*)password {\n\nSecKeyRef privateKeyRef = NULL;\nNSMutableDictionary * options = [[NSMutableDictionary alloc] init];\n[options setObject: password forKey:(__bridge id)kSecImportExportPassphrase];\nCFArrayRef items = CFArrayCreate(NULL, 0, 0, NULL);\nOSStatus securityError = SecPKCS12Import((__bridge CFDataRef) p12Data, (__bridge CFDictionaryRef)options, &items);\nif (securityError == noErr && CFArrayGetCount(items) > 0) {\n    CFDictionaryRef identityDict = CFArrayGetValueAtIndex(items, 0);\n    SecIdentityRef identityApp = (SecIdentityRef)CFDictionaryGetValue(identityDict, kSecImportItemIdentity);\n    securityError = SecIdentityCopyPrivateKey(identityApp, &privateKeyRef);\n    if (securityError != noErr) {\n        privateKeyRef = NULL;\n    }\n}\nCFRelease(items);\n\nreturn privateKeyRef;\n}  \n   ```\n   \n   \n   ```\n    //æ ¹æ®ä½ çš„deræ–‡ä»¶å…¬é’¥å¯¹åº”çš„SecKeyRef\n - (SecKeyRef)getPublicKeyRefrenceFromeData:    (NSData*)derData {\n\nSecCertificateRef myCertificate = SecCertificateCreateWithData(kCFAllocatorDefault, (__bridge CFDataRef)derData);\nSecPolicyRef myPolicy = SecPolicyCreateBasicX509();\nSecTrustRef myTrust;\nOSStatus status = SecTrustCreateWithCertificates(myCertificate,myPolicy,&myTrust);\nSecTrustResultType trustResult;\nif (status == noErr) {\n    status = SecTrustEvaluate(myTrust, &trustResult);\n}\nSecKeyRef securityKey = SecTrustCopyPublicKey(myTrust);\nCFRelease(myCertificate);\nCFRelease(myPolicy);\nCFRelease(myTrust);\n\nreturn securityKey;\n}\n   ```\n   \n## åŠ å¯†ä¸è§£å¯†Â <p>\n \n ```\n - (NSData*)rsaEncryptData:(NSData*)data {\n    SecKeyRef key = [self getPublicKey];\n    size_t cipherBufferSize = SecKeyGetBlockSize(key);\n    uint8_t *cipherBuffer = malloc(cipherBufferSize * sizeof(uint8_t));\n    size_t blockSize = cipherBufferSize - 11;\n      size_t blockCount = (size_t)ceil([data length] / (double)blockSize);\n      NSMutableData *encryptedData = [[NSMutableData alloc] init];\n    for (int i=0; i<blockCount; i++) {\n    unsigned long bufferSize = MIN(blockSize , [data length] - i * blockSize);\n    NSData *buffer = [data subdataWithRange:NSMakeRange(i * blockSize, bufferSize)];\n    OSStatus status = SecKeyEncrypt(key, kSecPaddingPKCS1, (const uint8_t *)[buffer bytes], [buffer length], cipherBuffer, &cipherBufferSize);\n\n    if (status != noErr) {\n        return nil;\n    }\n\n    NSData *encryptedBytes = [[NSData alloc] initWithBytes:(const void *)cipherBuffer length:cipherBufferSize];\n    [encryptedData appendData:encryptedBytes];\n    }\n\n  if (cipherBuffer){\n    free(cipherBuffer);\n  }\n\n  return encryptedData;\n  }\n ```\n \n ```\n - (NSData*)rsaDecryptData:(NSData*)data {\nSecKeyRef key = [self getPrivatKey];\n\nsize_t cipherBufferSize = SecKeyGetBlockSize(key);\nsize_t blockSize = cipherBufferSize;\nsize_t blockCount = (size_t)ceil([data length] / (double)blockSize);\n\nNSMutableData *decryptedData = [[NSMutableData alloc] init];\n\nfor (int i = 0; i < blockCount; i++) {\n    unsigned long bufferSize = MIN(blockSize , [data length] - i * blockSize);\n    NSData *buffer = [data subdataWithRange:NSMakeRange(i * blockSize, bufferSize)];\n\n    size_t cipherLen = [buffer length];\n    void *cipher = malloc(cipherLen);\n    [buffer getBytes:cipher length:cipherLen];\n    size_t plainLen = SecKeyGetBlockSize(key);\n    void *plain = malloc(plainLen);\n\n    OSStatus status = SecKeyDecrypt(key, kSecPaddingPKCS1, cipher, cipherLen, plain, &plainLen);\n\n    if (status != noErr) {\n        return nil;\n    }\n\n    NSData *decryptedBytes = [[NSData alloc] initWithBytes:(const void *)plain length:plainLen];\n    [decryptedData appendData:decryptedBytes];\n}\n\nreturn decryptedData;\n}\n ```\n \n### RSAåŠ å¯†ä¸­çš„Padding \n\n* RSA_PKCS1_PADDING å¡«å……æ¨¡å¼ï¼Œæœ€å¸¸ç”¨çš„æ¨¡å¼<p>\nè¦æ±‚: è¾“å…¥ï¼šå¿…é¡» æ¯” RSA é’¥æ¨¡é•¿(modulus) çŸ­è‡³å°‘11ä¸ªå­—èŠ‚, ä¹Ÿå°±æ˜¯ã€€RSA_size(rsa) â€“ 11 å¦‚æœè¾“å…¥çš„æ˜æ–‡è¿‡é•¿ï¼Œå¿…é¡»åˆ‡å‰²ï¼Œç„¶åå¡«å……ã€‚<p>\nè¾“å‡ºï¼šå’Œmodulusä¸€æ ·é•¿<p>\næ ¹æ®è¿™ä¸ªè¦æ±‚ï¼Œå¯¹äº1024bitçš„å¯†é’¥ï¼Œblock length = 1024/8 â€“ 11 = 117 å­—èŠ‚<p>\n\n* RSA_PKCS1_OAEP_PADDING<p>\nè¾“å…¥ï¼šRSA_size(rsa) â€“ 41<p>\nè¾“å‡ºï¼šå’Œmodulusä¸€æ ·é•¿<p>\n\n* RSA_NO_PADDINGã€€ã€€ä¸å¡«å……<p>\nè¾“å…¥ï¼šå¯ä»¥å’ŒRSAé’¥æ¨¡é•¿ä¸€æ ·é•¿ï¼Œå¦‚æœè¾“å…¥çš„æ˜æ–‡è¿‡é•¿ï¼Œå¿…é¡»åˆ‡å‰²ï¼Œã€€ç„¶åå¡«å……<p>\nè¾“å‡ºï¼šå’Œmodulusä¸€æ ·é•¿<p>\n\n## ç­¾åä¸éªŒè¯\n\n```\n //å¯¹æ•°æ®è¿›è¡Œsha256ç­¾å\n- (NSData *)rsaSHA256SignData:(NSData *)plainData {\nÂ     Â SecKeyRef key = [self getPrivatKey];\nÂ Â  Â \nÂ  Â    size_t signedHashBytesSize = SecKeyGetBlockSize(key);\nÂ  Â    uint8_t* signedHashBytes = malloc(signedHashBytesSize);\nÂ  Â    memset(signedHashBytes, 0x0, signedHashBytesSize);\nÂ Â  Â \nÂ  Â    size_t hashBytesSize = CC_SHA256_DIGEST_LENGTH;\nÂ  Â    uint8_t* hashBytes = malloc(hashBytesSize);\nÂ  Â    if (!CC_SHA256([plainData bytes], (CC_LONG)[plainData length], hashBytes)) {\nÂ  Â  Â  Â  return nil;\nÂ  Â  }\nÂ Â  Â \nÂ  Â         SecKeyRawSign(key,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  kSecPaddingPKCS1SHA256,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  hashBytes,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  hashBytesSize,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  signedHashBytes,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  &signedHashBytesSize);\nÂ Â  Â \nÂ  Â      NSData* signedHash = [NSData dataWithBytes:signedHashBytes\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  length:(NSUInteger)signedHashBytesSize];\nÂ Â  Â \nÂ  Â      if (hashBytes)\nÂ  Â  Â  Â  free(hashBytes);\nÂ  Â  if (signedHashBytes)\nÂ  Â  Â  Â  free(signedHashBytes);\nÂ Â  Â \nÂ  Â      return signedHash;\n}\n        \n```\n\n\n```\n\n//è¿™è¾¹å¯¹ç­¾åçš„æ•°æ®è¿›è¡ŒéªŒè¯ éªŒç­¾æˆåŠŸï¼Œåˆ™è¿”å›YES\n- (BOOL)rsaSHA256VerifyData:(NSData *)plainData     withSignature:(NSData *)signature {\nÂ  Â      SecKeyRef key = [self getPublicKey];\n  \nÂ      Â  size_t signedHashBytesSize = SecKeyGetBlockSize(key);\nÂ  Â      const void* signedHashBytes = [signature bytes];\nÂ Â  Â \nÂ  Â      size_t hashBytesSize = CC_SHA256_DIGEST_LENGTH;\nÂ  Â      uint8_t* hashBytes = malloc(hashBytesSize);\nÂ      Â  if (!CC_SHA256([plainData bytes], (CC_LONG)[plainData length], hashBytes)) {\nÂ  Â  Â  Â     return NO;\nÂ  Â      }\nÂ Â  Â \nÂ  Â        OSStatus status = SecKeyRawVerify(key,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  kSecPaddingPKCS1SHA256,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hashBytes,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hashBytesSize,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  signedHashBytes,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  signedHashBytesSize);\nÂ Â  Â \nÂ  Â      return status == errSecSuccess;\n}\n```\n<p>\n**æ–‡ç« åˆ°æ­¤å°±ç»“æŸäº†ï¼Œå¸Œæœ›å¤§å®¶èƒ½å¤Ÿå–œæ¬¢ã€‚è¯·ç‚¹å‡»[Git](https://github.com/PanXianyue/XYCryption)è·å–ç›¸å…³demo**","source":"_posts/RSA-SHA.md","raw":"---\ntitle: ä¸€ç¯‡æå®šRSAåŠ å¯†ä¸SHAç­¾å\ndate: 2016-01-12 17:19:25\ncategories: iOS\ntags: [RSAåŠ å¯†, SHAç­¾å]\n---\n\nçœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„åŒå­¦å¯å¹¸ç¦äº†ï¼Œå½“æ—¶åœ¨åšRSAåŠ å¯†ä¸ç­¾åçš„æ—¶å€™ç½‘ä¸Šçš„èµ„æ–™ç®€ç›´ä¸è¦å¤ªè€ï¼Œåšå®Œåå®åœ¨æ˜¯å¿å—ä¸ä¸‹å»äº†ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä¼šè¯¦ç»†è®²è§£iOSå¦‚ä½•å®ç°RSAåŠ å¯†ä¸ç­¾åï¼Œå¹¶ä¸”ä¸Javaå®Œå…¨åŒæ­¥ã€‚\n<!--more-->\n\n# åŸºç¡€çŸ¥è¯† \n\n <p>\n\n1. **ä»€ä¹ˆæ˜¯RSAï¼Ÿ**<p>\nç­”ï¼šRSAæ˜¯ä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå¸¸ç”¨æ¥å¯¹ä¼ è¾“æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œé…åˆä¸Šæ•°å­—æ‘˜è¦ç®—æ³•ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œæ–‡å­—ç­¾åã€‚\n\n2. **RSAåŠ å¯†ä¸­paddingï¼Ÿ**<p>\nç­”ï¼špaddingå³å¡«å……æ–¹å¼ï¼Œç”±äºRSAåŠ å¯†ç®—æ³•ä¸­è¦åŠ å¯†çš„æ˜æ–‡æ˜¯è¦æ¯”æ¨¡æ•°å°çš„ï¼Œpaddingå°±æ˜¯é€šè¿‡ä¸€äº›å¡«å……æ–¹å¼æ¥é™åˆ¶æ˜æ–‡çš„é•¿åº¦ã€‚åé¢ä¼šè¯¦ç»†ä»‹ç»paddingçš„å‡ ç§æ¨¡å¼ä»¥åŠåˆ†æ®µåŠ å¯†ã€‚\n\n3. **åŠ å¯†å’ŒåŠ ç­¾æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**<p>\nç­”ï¼šåŠ å¯†ï¼šå…¬é’¥æ”¾åœ¨å®¢æˆ·ç«¯ï¼Œå¹¶ä½¿ç”¨å…¬é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼ŒæœåŠ¡ç«¯æ‹¿åˆ°æ•°æ®åç”¨ç§é’¥è¿›è¡Œè§£å¯†ï¼›Â \n Â  Â  Â åŠ ç­¾ï¼šç§é’¥æ”¾åœ¨å®¢æˆ·ç«¯ï¼Œå¹¶ä½¿ç”¨ç§é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ ç­¾ï¼ŒæœåŠ¡ç«¯æ‹¿åˆ°æ•°æ®åç”¨å…¬é’¥è¿›è¡ŒéªŒç­¾ã€‚Â  Â  Â  Â \nå‰è€…å®Œå…¨ä¸ºäº†åŠ å¯†ï¼›åè€…ä¸»è¦æ˜¯ä¸ºäº†é˜²æ¶æ„æ”»å‡»ï¼Œé˜²æ­¢åˆ«äººæ¨¡æ‹Ÿæˆ‘ä»¬çš„å®¢æˆ·ç«¯å¯¹æˆ‘ä»¬çš„æœåŠ¡å™¨è¿›è¡Œæ”»å‡»ï¼Œå¯¼è‡´æœåŠ¡å™¨ç˜«ç—ªã€‚\n\n# åŸºæœ¬åŸç†<p>\n\nRSAä½¿ç”¨â€œå¯†é’¥å¯¹â€å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†è§£å¯†ï¼Œåœ¨åŠ å¯†è§£å¯†å‰éœ€è¦å…ˆç”Ÿå­˜å…¬é’¥ï¼ˆPublic Keyï¼‰å’Œç§é’¥ï¼ˆPrivate Keyï¼‰ã€‚<p>\n**å…¬é’¥(Public key):**Â ç”¨äºåŠ å¯†æ•°æ®. ç”¨äºå…¬å¼€, ä¸€èˆ¬å­˜æ”¾åœ¨æ•°æ®æä¾›æ–¹, ä¾‹å¦‚iOSå®¢æˆ·ç«¯ã€‚<p>\n**ç§é’¥(Private key):**Â ç”¨äºè§£å¯†æ•°æ®. å¿…é¡»ä¿å¯†, ç§é’¥æ³„éœ²ä¼šé€ æˆå®‰å…¨é—®é¢˜ã€‚<p>\niOSä¸­çš„Security.frameworkæä¾›äº†å¯¹RSAç®—æ³•çš„æ”¯æŒï¼Œè¿™ç§æ–¹å¼éœ€è¦å¯¹å¯†åŒ™å¯¹è¿›è¡Œå¤„ç†, æ ¹æ®public keyç”Ÿæˆè¯ä¹¦, é€šè¿‡private keyç”Ÿæˆp12æ ¼å¼çš„å¯†åŒ™ã€‚æƒ³æƒ³javeç›´æ¥ç”¨å­—ç¬¦ä¸²è¿›è¡ŒåŠ å¯†è§£å¯†ç®€å•å¤šäº†ã€‚(âŠ™oâŠ™)â€¦\n\n# å®æˆ˜\n<p>\n## è¯ä¹¦ç”Ÿæˆ\nRSAåŠ å¯†è¿™å—å…¬é’¥ã€ç§é’¥å¿…ä¸å¯å°‘çš„ã€‚**Appleæ˜¯ä¸æ”¯æŒç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²è¿›è¡ŒåŠ å¯†è§£å¯†çš„ï¼Œæ¨èä½¿ç”¨p12æ–‡ä»¶**ã€‚è¿™è¾¹æ•™å¤§å®¶å»ç”Ÿæˆåœ¨åŠ å¯†ä¸­ä½¿ç”¨åˆ°çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶æä¾›ç»™Javaä½¿ç”¨ï¼Œæƒ³å½“å¹´è¿™ä¸ªå…¬é’¥ç§é’¥æäº†åŠå¤©äº†ã€‚ %>_<%\n\n>* ç”Ÿæˆæ¨¡é•¿ä¸º1024bitçš„ç§é’¥\nopenssl genrsa -out private_key.pem 1024\n* ç”Ÿæˆcertification require file\nopensslÂ reqÂ -newÂ -keyÂ private_key.pemÂ -outÂ rsaCertReq.csrÂ \n* ç”Ÿæˆcertification å¹¶æŒ‡å®šè¿‡æœŸæ—¶é—´\nopenssl x509 -req -days3650-in rsaCertReq.csr -signkey private_key.pem -out rsaCert.crt\n* ç”Ÿæˆå…¬é’¥ä¾›iOSä½¿ç”¨\nopenssl x509 -outform der -in rsaCert.crt -out public_key.der\n* ç”Ÿæˆç§é’¥ä¾›iOSä½¿ç”¨ è¿™è¾¹ä¼šè®©ä½ è¾“å…¥å¯†ç ï¼ŒåæœŸç”¨åˆ°åœ¨ç”ŸæˆsecKeyRefçš„æ—¶å€™ä¼šç”¨åˆ°è¿™ä¸ªå¯†ç \nopenssl pkcs12 -export -out private_key.p12 -inkey private_key.pem -in rsaCert.crt\n* ç”Ÿæˆpemç»“å°¾çš„å…¬é’¥ä¾›Javaä½¿ç”¨\nopenssl rsa -in private_key.pem -out rsa_public_key.pem -pubout\n* ç”Ÿæˆpemç»“å°¾çš„ç§é’¥ä¾›Javaä½¿ç”¨openssl pkcs8 -topk8 -in private_key.pem -out pkcs8_private_key.pem -nocrypt\n\n**ä»¥ä¸Šæ‰€æœ‰çš„æ­¥éª¤éƒ½æ˜¯åœ¨ç»ˆç«¯ä¸‹å®Œæˆçš„å“¦ Â (*^__^*)**\n\n## ç”Ÿæˆå…¬é’¥å’Œç§é’¥çš„secKeyRef<p>\n   ```\n   //æ ¹æ®ä½ çš„p12æ–‡ä»¶ç”Ÿæˆç§é’¥å¯¹åº”çš„SecKeyRef è¿™è¾¹è¿”å›è‹¥æ˜¯nil è¯·æ£€æŸ¥ä½ p12æ–‡ä»¶çš„ç”Ÿæˆæ­¥éª¤\n- (SecKeyRef)getPrivateKeyRefrenceFromData:(NSData*)p12Data password:(NSString*)password {\n\nSecKeyRef privateKeyRef = NULL;\nNSMutableDictionary * options = [[NSMutableDictionary alloc] init];\n[options setObject: password forKey:(__bridge id)kSecImportExportPassphrase];\nCFArrayRef items = CFArrayCreate(NULL, 0, 0, NULL);\nOSStatus securityError = SecPKCS12Import((__bridge CFDataRef) p12Data, (__bridge CFDictionaryRef)options, &items);\nif (securityError == noErr && CFArrayGetCount(items) > 0) {\n    CFDictionaryRef identityDict = CFArrayGetValueAtIndex(items, 0);\n    SecIdentityRef identityApp = (SecIdentityRef)CFDictionaryGetValue(identityDict, kSecImportItemIdentity);\n    securityError = SecIdentityCopyPrivateKey(identityApp, &privateKeyRef);\n    if (securityError != noErr) {\n        privateKeyRef = NULL;\n    }\n}\nCFRelease(items);\n\nreturn privateKeyRef;\n}  \n   ```\n   \n   \n   ```\n    //æ ¹æ®ä½ çš„deræ–‡ä»¶å…¬é’¥å¯¹åº”çš„SecKeyRef\n - (SecKeyRef)getPublicKeyRefrenceFromeData:    (NSData*)derData {\n\nSecCertificateRef myCertificate = SecCertificateCreateWithData(kCFAllocatorDefault, (__bridge CFDataRef)derData);\nSecPolicyRef myPolicy = SecPolicyCreateBasicX509();\nSecTrustRef myTrust;\nOSStatus status = SecTrustCreateWithCertificates(myCertificate,myPolicy,&myTrust);\nSecTrustResultType trustResult;\nif (status == noErr) {\n    status = SecTrustEvaluate(myTrust, &trustResult);\n}\nSecKeyRef securityKey = SecTrustCopyPublicKey(myTrust);\nCFRelease(myCertificate);\nCFRelease(myPolicy);\nCFRelease(myTrust);\n\nreturn securityKey;\n}\n   ```\n   \n## åŠ å¯†ä¸è§£å¯†Â <p>\n \n ```\n - (NSData*)rsaEncryptData:(NSData*)data {\n    SecKeyRef key = [self getPublicKey];\n    size_t cipherBufferSize = SecKeyGetBlockSize(key);\n    uint8_t *cipherBuffer = malloc(cipherBufferSize * sizeof(uint8_t));\n    size_t blockSize = cipherBufferSize - 11;\n      size_t blockCount = (size_t)ceil([data length] / (double)blockSize);\n      NSMutableData *encryptedData = [[NSMutableData alloc] init];\n    for (int i=0; i<blockCount; i++) {\n    unsigned long bufferSize = MIN(blockSize , [data length] - i * blockSize);\n    NSData *buffer = [data subdataWithRange:NSMakeRange(i * blockSize, bufferSize)];\n    OSStatus status = SecKeyEncrypt(key, kSecPaddingPKCS1, (const uint8_t *)[buffer bytes], [buffer length], cipherBuffer, &cipherBufferSize);\n\n    if (status != noErr) {\n        return nil;\n    }\n\n    NSData *encryptedBytes = [[NSData alloc] initWithBytes:(const void *)cipherBuffer length:cipherBufferSize];\n    [encryptedData appendData:encryptedBytes];\n    }\n\n  if (cipherBuffer){\n    free(cipherBuffer);\n  }\n\n  return encryptedData;\n  }\n ```\n \n ```\n - (NSData*)rsaDecryptData:(NSData*)data {\nSecKeyRef key = [self getPrivatKey];\n\nsize_t cipherBufferSize = SecKeyGetBlockSize(key);\nsize_t blockSize = cipherBufferSize;\nsize_t blockCount = (size_t)ceil([data length] / (double)blockSize);\n\nNSMutableData *decryptedData = [[NSMutableData alloc] init];\n\nfor (int i = 0; i < blockCount; i++) {\n    unsigned long bufferSize = MIN(blockSize , [data length] - i * blockSize);\n    NSData *buffer = [data subdataWithRange:NSMakeRange(i * blockSize, bufferSize)];\n\n    size_t cipherLen = [buffer length];\n    void *cipher = malloc(cipherLen);\n    [buffer getBytes:cipher length:cipherLen];\n    size_t plainLen = SecKeyGetBlockSize(key);\n    void *plain = malloc(plainLen);\n\n    OSStatus status = SecKeyDecrypt(key, kSecPaddingPKCS1, cipher, cipherLen, plain, &plainLen);\n\n    if (status != noErr) {\n        return nil;\n    }\n\n    NSData *decryptedBytes = [[NSData alloc] initWithBytes:(const void *)plain length:plainLen];\n    [decryptedData appendData:decryptedBytes];\n}\n\nreturn decryptedData;\n}\n ```\n \n### RSAåŠ å¯†ä¸­çš„Padding \n\n* RSA_PKCS1_PADDING å¡«å……æ¨¡å¼ï¼Œæœ€å¸¸ç”¨çš„æ¨¡å¼<p>\nè¦æ±‚: è¾“å…¥ï¼šå¿…é¡» æ¯” RSA é’¥æ¨¡é•¿(modulus) çŸ­è‡³å°‘11ä¸ªå­—èŠ‚, ä¹Ÿå°±æ˜¯ã€€RSA_size(rsa) â€“ 11 å¦‚æœè¾“å…¥çš„æ˜æ–‡è¿‡é•¿ï¼Œå¿…é¡»åˆ‡å‰²ï¼Œç„¶åå¡«å……ã€‚<p>\nè¾“å‡ºï¼šå’Œmodulusä¸€æ ·é•¿<p>\næ ¹æ®è¿™ä¸ªè¦æ±‚ï¼Œå¯¹äº1024bitçš„å¯†é’¥ï¼Œblock length = 1024/8 â€“ 11 = 117 å­—èŠ‚<p>\n\n* RSA_PKCS1_OAEP_PADDING<p>\nè¾“å…¥ï¼šRSA_size(rsa) â€“ 41<p>\nè¾“å‡ºï¼šå’Œmodulusä¸€æ ·é•¿<p>\n\n* RSA_NO_PADDINGã€€ã€€ä¸å¡«å……<p>\nè¾“å…¥ï¼šå¯ä»¥å’ŒRSAé’¥æ¨¡é•¿ä¸€æ ·é•¿ï¼Œå¦‚æœè¾“å…¥çš„æ˜æ–‡è¿‡é•¿ï¼Œå¿…é¡»åˆ‡å‰²ï¼Œã€€ç„¶åå¡«å……<p>\nè¾“å‡ºï¼šå’Œmodulusä¸€æ ·é•¿<p>\n\n## ç­¾åä¸éªŒè¯\n\n```\n //å¯¹æ•°æ®è¿›è¡Œsha256ç­¾å\n- (NSData *)rsaSHA256SignData:(NSData *)plainData {\nÂ     Â SecKeyRef key = [self getPrivatKey];\nÂ Â  Â \nÂ  Â    size_t signedHashBytesSize = SecKeyGetBlockSize(key);\nÂ  Â    uint8_t* signedHashBytes = malloc(signedHashBytesSize);\nÂ  Â    memset(signedHashBytes, 0x0, signedHashBytesSize);\nÂ Â  Â \nÂ  Â    size_t hashBytesSize = CC_SHA256_DIGEST_LENGTH;\nÂ  Â    uint8_t* hashBytes = malloc(hashBytesSize);\nÂ  Â    if (!CC_SHA256([plainData bytes], (CC_LONG)[plainData length], hashBytes)) {\nÂ  Â  Â  Â  return nil;\nÂ  Â  }\nÂ Â  Â \nÂ  Â         SecKeyRawSign(key,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  kSecPaddingPKCS1SHA256,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  hashBytes,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  hashBytesSize,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  signedHashBytes,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  &signedHashBytesSize);\nÂ Â  Â \nÂ  Â      NSData* signedHash = [NSData dataWithBytes:signedHashBytes\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  length:(NSUInteger)signedHashBytesSize];\nÂ Â  Â \nÂ  Â      if (hashBytes)\nÂ  Â  Â  Â  free(hashBytes);\nÂ  Â  if (signedHashBytes)\nÂ  Â  Â  Â  free(signedHashBytes);\nÂ Â  Â \nÂ  Â      return signedHash;\n}\n        \n```\n\n\n```\n\n//è¿™è¾¹å¯¹ç­¾åçš„æ•°æ®è¿›è¡ŒéªŒè¯ éªŒç­¾æˆåŠŸï¼Œåˆ™è¿”å›YES\n- (BOOL)rsaSHA256VerifyData:(NSData *)plainData     withSignature:(NSData *)signature {\nÂ  Â      SecKeyRef key = [self getPublicKey];\n  \nÂ      Â  size_t signedHashBytesSize = SecKeyGetBlockSize(key);\nÂ  Â      const void* signedHashBytes = [signature bytes];\nÂ Â  Â \nÂ  Â      size_t hashBytesSize = CC_SHA256_DIGEST_LENGTH;\nÂ  Â      uint8_t* hashBytes = malloc(hashBytesSize);\nÂ      Â  if (!CC_SHA256([plainData bytes], (CC_LONG)[plainData length], hashBytes)) {\nÂ  Â  Â  Â     return NO;\nÂ  Â      }\nÂ Â  Â \nÂ  Â        OSStatus status = SecKeyRawVerify(key,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  kSecPaddingPKCS1SHA256,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hashBytes,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hashBytesSize,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  signedHashBytes,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  signedHashBytesSize);\nÂ Â  Â \nÂ  Â      return status == errSecSuccess;\n}\n```\n<p>\n**æ–‡ç« åˆ°æ­¤å°±ç»“æŸäº†ï¼Œå¸Œæœ›å¤§å®¶èƒ½å¤Ÿå–œæ¬¢ã€‚è¯·ç‚¹å‡»[Git](https://github.com/PanXianyue/XYCryption)è·å–ç›¸å…³demo**","slug":"RSA-SHA","published":1,"updated":"2017-01-03T04:28:56.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjiitlufe001855cgjtc5v9b3"},{"title":"Building Faster in Xcode","date":"2018-06-17T12:09:54.000Z","_content":"\nSession 408 \n<!--more-->\n\n![Building Faster in Xcode_](/images/Building%20Faster%20in%20Xcode_.png)\n\n### Parallelizing Your Build\n###### Xcodeâ€™s Targets and Dependencies\n\n* Target specifies a product to build\n\t* iOS App \n\t* Framework\n\t* Unit Tests\n* Target dependency requires another target\n\t* Explicit via Target Dependencies \n\t* Implicit via Link Binary with Libraries\n\n###### Game Dependency Graph\n![QQ20180617-164649@2x][image-1]\n\n* List of all targets to build \n* Dependency between targets\n* Build order can be derived\n\n![QQ20180617-165008@2x][image-2]\n\n![QQ20180617-165142@2x][image-3]\n\n* Amount of work did not change \n* Time to build decreased \n* Increased hardware utilization\n\n###### How do we get there?\n* edit scheme\n* build\n* build option\n\t1. Parallelize build\n\t2. Find implicit Dependencies\n\n\n###### Parallelized Target Build Process\n* Compile sources can start earlier\n* Waits only for what it needs \n* Must wait for Run Script phases\n\n### Run Script Phases (Reducing the work on rebuilds)\n> Allows you to customize your build process for your exact needs.\n\n![QQ20180617-174124@2x][image-4]\n\n###### File Lists  \n![QQ20180617-173229@2x][image-5]\n\n* Newline separated\n* Support for build setting variables \n* Cannot be generated during the build\n\n### Measuring Build Time\n###### Build With Timing Summary\n![][image-6]\n\n![][image-7]\n\n\n### Source-Level Improvements\n* Dealing with complex expressions\n* Understanding dependencies in Swift\n* Limiting your Objective-C/Swift interface\n\n###### Turn off Whole Module Mode For Debug Builds\n\n ![][image-8]\n\n###### Use Explicit Types for Complex Properties\n![][image-9]\n\n###### Provide Types in Complex Closures\n\n![][image-10]\n\n###### Break Apart Complex Expressions\n\n![][image-11]\n\n###### Use AnyObject Methods and Properties Sparingly\n\n![][image-12]\n\nè°ƒç”¨ `AnyObject` çš„æ–¹æ³•æ—¶, ä¼šå»æ‰€æœ‰çš„æ–‡ä»¶ä¸­å»æŸ¥æ‰¾è¯¥æ–¹æ³•, ç¼–è¯‘æ•ˆç‡ä½\n\nè§£å†³æ–¹æ¡ˆ:\n![][image-13]\né€šè¿‡å®šä¹‰ `protocol`, ç„¶åæŸ¥æ‰¾æ–¹æ³•å°±ä¼šå»æ­¤ `protocol` çš„å£°æ˜é‡Œé¢ç›´æ¥å»æ‰¾\n\n\n### Understanding Dependencies in Swift\n###### Incremental Builds Are File-Based\n![][image-14]\n\n![][image-15]\n\nå¢åŠ æ–¹æ³•æ­¤æ—¶ä¼šé‡æ–°ç¼–è¯‘\n\n![][image-16]\n\næ”¹å˜æ–¹æ³•çš„ bodies ä¸ä¼šå½±å“åˆ°å…¶ä»–çš„æ–‡ä»¶\n\n![][image-17]\n\nä¸å…³è”çš„æ”¹å˜åœ¨æ–¹æ³•å¤–éƒ¨ä¹Ÿä¼šå¯¼è‡´é‡æ–°ç¼–è¯‘\n\n###### Dependencies Within a Target Are Per-File (ç›®æ ‡æ–‡ä»¶çš„ä¾èµ–å…³ç³»)\n\n![][image-18]\n\n###### Cross-Target Dependencies Are Coarse-Grained\n\n![][image-19]\n\n\n###### Swift Dependency Rules\n* Compiler must be conservative\n* Changes in function bodies do not affect the fileâ€™s interface  \n* Dependencies within a module are per-file\n* Dependencies across targets are for the whole target\n\n###### Mixed-Source App Targets\n\n![][image-20]\n\n###### Keep Your Generated Header Minimal\n* Use private when possible\n\n\t```\n\t`@objc private func keyboardWillShow(_: Notification) { // Important keyboard setup code here.\n\t}.\n\t// ...\n\tNotificationCenter.default.addObserver(self, selector: #selector(keyboardWillShow(_:)), ...)\n\t```\n\t* Use block-based APIs\n\n\t```\n\t`self.observer = NotificationCenter.default.addObserver( forName: UIKeyboardWillShow, object: nil, queue: nil) {\n\t// Important keyboard setup code here.\n\t}.\n\t```\n\t* Turn off â€œSwift 3 @objc Inferenceâ€\n\t![][image-21]\n* Keep Your Bridging Header Minimal\n\t* Use categories to break up your interface\n---- \n![][image-22]\n\n### More Information\n> https://developer.apple.com/wwdc18/408\n\n\n\n\n[image-1]:\t/images/QQ20180617-164649@2x.png\n[image-2]:\t/images/QQ20180617-165008@2x.png\n[image-3]:\t/images/QQ20180617-165142@2x.png\n[image-4]:\t/images/QQ20180617-174124@2x.png\n[image-5]:\t/images/QQ20180617-173229@2x.png\n[image-6]:\t/images/15292293472562.jpg\n[image-7]:\t/images/15292295109399.jpg\n[image-8]:\t/images/15292297716350.jpg\n[image-9]:\t/images/15292304002286.jpg\n[image-10]:\t/images/15292304507458.jpg\n[image-11]:\t/images/15292305166448.jpg\n[image-12]:\t/images/15292305743843.jpg\n[image-13]:\t/images/15292308090026.jpg\n[image-14]:\t/images/15292312274443.jpg\n[image-15]:\t/images/15292312680309.jpg\n[image-16]:\t/images/15292313035255.jpg\n[image-17]:\t/images/15292313838157.jpg\n[image-18]:\t/images/15292346436023.jpg\n[image-19]:\t/images/15292346898606.jpg\n[image-20]:\t/images/15292351447821.jpg\n[image-21]:\t/images/15292355397528.jpg\n[image-22]:\t/images/15292356504822.jpg\n\n","source":"_posts/408-building-faster-in-xcode.md","raw":"---\ntitle: Building Faster in Xcode\ndate: 2018-06-17 20:09:54\ntags : [WWDC]\n---\n\nSession 408 \n<!--more-->\n\n![Building Faster in Xcode_](/images/Building%20Faster%20in%20Xcode_.png)\n\n### Parallelizing Your Build\n###### Xcodeâ€™s Targets and Dependencies\n\n* Target specifies a product to build\n\t* iOS App \n\t* Framework\n\t* Unit Tests\n* Target dependency requires another target\n\t* Explicit via Target Dependencies \n\t* Implicit via Link Binary with Libraries\n\n###### Game Dependency Graph\n![QQ20180617-164649@2x][image-1]\n\n* List of all targets to build \n* Dependency between targets\n* Build order can be derived\n\n![QQ20180617-165008@2x][image-2]\n\n![QQ20180617-165142@2x][image-3]\n\n* Amount of work did not change \n* Time to build decreased \n* Increased hardware utilization\n\n###### How do we get there?\n* edit scheme\n* build\n* build option\n\t1. Parallelize build\n\t2. Find implicit Dependencies\n\n\n###### Parallelized Target Build Process\n* Compile sources can start earlier\n* Waits only for what it needs \n* Must wait for Run Script phases\n\n### Run Script Phases (Reducing the work on rebuilds)\n> Allows you to customize your build process for your exact needs.\n\n![QQ20180617-174124@2x][image-4]\n\n###### File Lists  \n![QQ20180617-173229@2x][image-5]\n\n* Newline separated\n* Support for build setting variables \n* Cannot be generated during the build\n\n### Measuring Build Time\n###### Build With Timing Summary\n![][image-6]\n\n![][image-7]\n\n\n### Source-Level Improvements\n* Dealing with complex expressions\n* Understanding dependencies in Swift\n* Limiting your Objective-C/Swift interface\n\n###### Turn off Whole Module Mode For Debug Builds\n\n ![][image-8]\n\n###### Use Explicit Types for Complex Properties\n![][image-9]\n\n###### Provide Types in Complex Closures\n\n![][image-10]\n\n###### Break Apart Complex Expressions\n\n![][image-11]\n\n###### Use AnyObject Methods and Properties Sparingly\n\n![][image-12]\n\nè°ƒç”¨ `AnyObject` çš„æ–¹æ³•æ—¶, ä¼šå»æ‰€æœ‰çš„æ–‡ä»¶ä¸­å»æŸ¥æ‰¾è¯¥æ–¹æ³•, ç¼–è¯‘æ•ˆç‡ä½\n\nè§£å†³æ–¹æ¡ˆ:\n![][image-13]\né€šè¿‡å®šä¹‰ `protocol`, ç„¶åæŸ¥æ‰¾æ–¹æ³•å°±ä¼šå»æ­¤ `protocol` çš„å£°æ˜é‡Œé¢ç›´æ¥å»æ‰¾\n\n\n### Understanding Dependencies in Swift\n###### Incremental Builds Are File-Based\n![][image-14]\n\n![][image-15]\n\nå¢åŠ æ–¹æ³•æ­¤æ—¶ä¼šé‡æ–°ç¼–è¯‘\n\n![][image-16]\n\næ”¹å˜æ–¹æ³•çš„ bodies ä¸ä¼šå½±å“åˆ°å…¶ä»–çš„æ–‡ä»¶\n\n![][image-17]\n\nä¸å…³è”çš„æ”¹å˜åœ¨æ–¹æ³•å¤–éƒ¨ä¹Ÿä¼šå¯¼è‡´é‡æ–°ç¼–è¯‘\n\n###### Dependencies Within a Target Are Per-File (ç›®æ ‡æ–‡ä»¶çš„ä¾èµ–å…³ç³»)\n\n![][image-18]\n\n###### Cross-Target Dependencies Are Coarse-Grained\n\n![][image-19]\n\n\n###### Swift Dependency Rules\n* Compiler must be conservative\n* Changes in function bodies do not affect the fileâ€™s interface  \n* Dependencies within a module are per-file\n* Dependencies across targets are for the whole target\n\n###### Mixed-Source App Targets\n\n![][image-20]\n\n###### Keep Your Generated Header Minimal\n* Use private when possible\n\n\t```\n\t`@objc private func keyboardWillShow(_: Notification) { // Important keyboard setup code here.\n\t}.\n\t// ...\n\tNotificationCenter.default.addObserver(self, selector: #selector(keyboardWillShow(_:)), ...)\n\t```\n\t* Use block-based APIs\n\n\t```\n\t`self.observer = NotificationCenter.default.addObserver( forName: UIKeyboardWillShow, object: nil, queue: nil) {\n\t// Important keyboard setup code here.\n\t}.\n\t```\n\t* Turn off â€œSwift 3 @objc Inferenceâ€\n\t![][image-21]\n* Keep Your Bridging Header Minimal\n\t* Use categories to break up your interface\n---- \n![][image-22]\n\n### More Information\n> https://developer.apple.com/wwdc18/408\n\n\n\n\n[image-1]:\t/images/QQ20180617-164649@2x.png\n[image-2]:\t/images/QQ20180617-165008@2x.png\n[image-3]:\t/images/QQ20180617-165142@2x.png\n[image-4]:\t/images/QQ20180617-174124@2x.png\n[image-5]:\t/images/QQ20180617-173229@2x.png\n[image-6]:\t/images/15292293472562.jpg\n[image-7]:\t/images/15292295109399.jpg\n[image-8]:\t/images/15292297716350.jpg\n[image-9]:\t/images/15292304002286.jpg\n[image-10]:\t/images/15292304507458.jpg\n[image-11]:\t/images/15292305166448.jpg\n[image-12]:\t/images/15292305743843.jpg\n[image-13]:\t/images/15292308090026.jpg\n[image-14]:\t/images/15292312274443.jpg\n[image-15]:\t/images/15292312680309.jpg\n[image-16]:\t/images/15292313035255.jpg\n[image-17]:\t/images/15292313838157.jpg\n[image-18]:\t/images/15292346436023.jpg\n[image-19]:\t/images/15292346898606.jpg\n[image-20]:\t/images/15292351447821.jpg\n[image-21]:\t/images/15292355397528.jpg\n[image-22]:\t/images/15292356504822.jpg\n\n","slug":"408-building-faster-in-xcode","published":1,"updated":"2018-06-17T12:31:29.059Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjiitlufh001e55cg5o9beff4"}],"PostAsset":[],"PostCategory":[{"post_id":"cjiitluei000555cg5w1v96dh","category_id":"cjiitluek000655cg4rjufc52","_id":"cjiitluen000955cgeezw8avy"},{"post_id":"cjiitluey000l55cg71u0ckei","category_id":"cjiitluek000655cg4rjufc52","_id":"cjiitluf0000m55cgvqvwvfj1"},{"post_id":"cjiitluf3000r55cg8i2v3k13","category_id":"cjiitluek000655cg4rjufc52","_id":"cjiitluf4000s55cg5ystc4im"},{"post_id":"cjiitluf6000w55cgm4ggevrh","category_id":"cjiitluek000655cg4rjufc52","_id":"cjiitluf7000x55cglznwk0q2"},{"post_id":"cjiitlufa001655cgcp8a6urt","category_id":"cjiitluek000655cg4rjufc52","_id":"cjiitlufc001755cgzscjkywq"},{"post_id":"cjiitlufe001855cgjtc5v9b3","category_id":"cjiitluek000655cg4rjufc52","_id":"cjiitluff001955cgcm3xq5z7"}],"PostTag":[{"post_id":"cjiitluei000555cg5w1v96dh","tag_id":"cjiitluek000755cg9vdby8o0","_id":"cjiitlueo000b55cgytnnu0x3"},{"post_id":"cjiitluei000555cg5w1v96dh","tag_id":"cjiitluen000855cgvn5tbeql","_id":"cjiitlueo000c55cgtvd1hh78"},{"post_id":"cjiitluei000555cg5w1v96dh","tag_id":"cjiitlueo000a55cg7nwshbxh","_id":"cjiitlueo000d55cglciooukv"},{"post_id":"cjiitlues000f55cg9a2ws6i4","tag_id":"cjiitluet000g55cgsmhe8ebj","_id":"cjiitluet000h55cgwzu26h2e"},{"post_id":"cjiitluev000i55cghs04ml91","tag_id":"cjiitluev000j55cg06b7xna6","_id":"cjiitluew000k55cgeka9uu1v"},{"post_id":"cjiitluey000l55cg71u0ckei","tag_id":"cjiitluf0000n55cg3pmg75nh","_id":"cjiitluf1000p55cge9xbume6"},{"post_id":"cjiitluey000l55cg71u0ckei","tag_id":"cjiitluf1000o55cg8lzahwq3","_id":"cjiitluf1000q55cgg5gmgvjj"},{"post_id":"cjiitluf3000r55cg8i2v3k13","tag_id":"cjiitluf0000n55cg3pmg75nh","_id":"cjiitluf5000u55cg86aqe0s3"},{"post_id":"cjiitluf3000r55cg8i2v3k13","tag_id":"cjiitluf4000t55cgohpgevg3","_id":"cjiitluf5000v55cgeb6uff3n"},{"post_id":"cjiitluf6000w55cgm4ggevrh","tag_id":"cjiitluf8000y55cgrp7sfbw4","_id":"cjiitluf9001255cgtb15mss4"},{"post_id":"cjiitluf6000w55cgm4ggevrh","tag_id":"cjiitluf8000z55cg5bxu48fi","_id":"cjiitluf9001355cgwu5lbxre"},{"post_id":"cjiitluf6000w55cgm4ggevrh","tag_id":"cjiitluf8001055cgmugv3sly","_id":"cjiitluf9001455cg2k7eojpm"},{"post_id":"cjiitluf6000w55cgm4ggevrh","tag_id":"cjiitluf8001155cgobp8ppnu","_id":"cjiitluf9001555cg4kayumyg"},{"post_id":"cjiitlufe001855cgjtc5v9b3","tag_id":"cjiitluff001a55cgp11cb45b","_id":"cjiitlufg001c55cgobmnlm3o"},{"post_id":"cjiitlufe001855cgjtc5v9b3","tag_id":"cjiitluff001b55cgvyiq21kj","_id":"cjiitlufg001d55cg699s0ego"},{"post_id":"cjiitlufh001e55cg5o9beff4","tag_id":"cjiitlufh001f55cgypmuyofx","_id":"cjiitlufi001g55cgm0bl27hz"}],"Tag":[{"name":"XCTOOL","_id":"cjiitluek000755cg9vdby8o0"},{"name":"SHELL","_id":"cjiitluen000855cgvn5tbeql"},{"name":"LINUXå‘½ä»¤","_id":"cjiitlueo000a55cg7nwshbxh"},{"name":"GIT","_id":"cjiitluet000g55cgsmhe8ebj"},{"name":"Tool","_id":"cjiitluev000j55cg06b7xna6"},{"name":"YYKit","_id":"cjiitluf0000n55cg3pmg75nh"},{"name":"pthread","_id":"cjiitluf1000o55cg8lzahwq3"},{"name":"YYCache","_id":"cjiitluf4000t55cgohpgevg3"},{"name":"SOCKET","_id":"cjiitluf8000y55cgrp7sfbw4"},{"name":"HTTP","_id":"cjiitluf8000z55cg5bxu48fi"},{"name":"TCP","_id":"cjiitluf8001055cgmugv3sly"},{"name":"UDP","_id":"cjiitluf8001155cgobp8ppnu"},{"name":"RSAåŠ å¯†","_id":"cjiitluff001a55cgp11cb45b"},{"name":"SHAç­¾å","_id":"cjiitluff001b55cgvyiq21kj"},{"name":"WWDC","_id":"cjiitlufh001f55cgypmuyofx"}]}}